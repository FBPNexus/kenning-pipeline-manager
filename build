#!/bin/bash

# Copyright (c) 2022-2023 Antmicro <www.antmicro.com>
#
# SPDX-License-Identifier: Apache-2.0

BASE_DIR=$(dirname "$0")

display_help() {
    echo "Invalid parameters. Supported build options are:"
    echo
    echo "./build static-html [<specification-path> [<dataflow-path>]] - build as a static application that can run without any backend server, with optional default specification and optional default dataflow."
    echo "./build server-app  - build the application to run with a backend server and an external application"
}

if ! [[ $# -ge 1 && $# -le 3 ]]; then
    display_help
    exit 1
fi

if [ "$1" = "static-html" ]; then
    if [ "$#" -ge 2 ]; then
        echo VUE_APP_SPECIFICATION_PATH=$(realpath $2) > $BASE_DIR/pipeline_manager/frontend/.env.static.local
        if [ "$#" -eq 3 ]; then
            echo VUE_APP_DATAFLOW_PATH=$(realpath $3) >> $BASE_DIR/pipeline_manager/frontend/.env.static.local
        fi
    fi
    cd $BASE_DIR/pipeline_manager/frontend && npm install
    npm run build-static-html
elif [ "$1" = "server-app" ]; then
    cd $BASE_DIR/pipeline_manager/frontend && npm install
    npm run build-server-app
else
    display_help
    exit 1
fi
