(self.webpackChunkpipeline_manager=self.webpackChunkpipeline_manager||[]).push([[257],{58365:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var o=n(50953),i=n(20641),a=n(63491),s=n(45825);function r(e,t=void 0,n=void 0){const{graph:r}=(0,a.uU)(),{viewModel:l}=(0,a.if)(),d=null!=t?t:(0,s.i)((0,o.KR)(1)),c=(0,i.EW)((()=>l.value.settings.background.gridSize)),u=(0,s.i)(c),p={x:(0,s.Q)("x"),y:(0,s.Q)("y")},h=(0,o.KR)(null),v=(0,o.KR)(null),g=(0,o.KR)(!0),f=(0,i.EW)((()=>!(!h.value||!v.value||v.value.x===e.value.x&&v.value.y===e.value.y))),y=(e,t,o=!1,i=!1)=>{if(o&&void 0!==n){const o=p[t](e,n,r.value.selectedNodes.map((e=>e.id)));if(void 0!==o)return o}return i?u(e):g.value?d(e):e};return e.value&&(e.value.x=y(e.value.x,"x"),e.value.y=y(e.value.y,"y")),{dragging:f,onPointerDown:t=>{g.value=!t.shiftKey,h.value={x:t.pageX,y:t.pageY},v.value={x:e.value.x,y:e.value.y}},onPointerMove:t=>{g.value=!t.shiftKey;const n=t.ctrlKey,o=t.shiftKey;if(h.value&&v.value){const i=t.pageX-h.value.x,a=t.pageY-h.value.y;e.value.x=y(v.value.x+i/r.value.scaling,"x",n,o),e.value.y=y(v.value.y+a/r.value.scaling,"y",n,o)}},onPointerUp:()=>{h.value=null,v.value=null,g.value=!0}}}},81023:(e,t,n)=>{"use strict";n.d(t,{A:()=>v});var o=n(20641),i=n(90033),a=n(53751);const s=["id"],r={key:2};var l=n(50953),d=n(63491),c=n(45788),u=n(41426),p=n(14121);const h=(0,o.pM)({extends:d.XF.NodeInterface,props:{highlighted:Boolean,picked:Boolean,switchSides:{},toggleGroup:{default:()=>{},required:!1},updateDynamicInterfaces:{default:()=>{},required:!1},tabindexValue:{default:-1,required:!1}},components:{Arrow:c.A},setup(e){const{el:t,isConnected:n,showComponent:i,startHover:a,endHover:s,openSidebar:r}=d.XF.NodeInterface.setup(e),{viewModel:c}=(0,d.if)(),{graph:h}=(0,d.uU)();e.intf.events.beforeSetValue.unsubscribe(e.intf),e.intf.events.beforeSetValue.subscribe(e.intf,((t,n)=>{c.value.editor.readonly&&n(),(void 0!==e.intf.min&&t<e.intf.min||void 0!==e.intf.max&&t>e.intf.max)&&n()})),e.intf.group&&(e.toggleGroup(e.intf),e.intf.events.setValue.unsubscribe(e.intf),e.intf.events.setValue.subscribe(e.intf,(()=>e.toggleGroup(e.intf)))),e.intf.name.endsWith(p.Yg)&&(e.updateDynamicInterfaces(e.intf),e.intf.events.setValue.unsubscribe(e.intf),e.intf.events.setValue.subscribe(e.intf,(()=>e.updateDynamicInterfaces(e.intf))));const v=(0,l.KR)(!1),g=(0,u.A)(700,(()=>{c.value.editor.readonly||(e.switchSides(e.intf),s())})),f=e.intf.port&&"inout"!==e.intf.direction,y=(0,o.EW)((()=>{if("input"===e.intf.direction){if("left"===e.intf.side)return"right";if("right"===e.intf.side)return"down"}if("output"===e.intf.direction){if("left"===e.intf.side)return"down";if("right"===e.intf.side)return"right"}return"down"})),m=(0,o.EW)((()=>({"--input":"left"===e.intf.side,"--output":"right"===e.intf.side,"--connected":n.value,__readonly:c.value.editor.readonly}))),b=(0,o.EW)((()=>void 0!==e.intf.externalName));new d.lo("External name",e.intf.externalName).setPort(!1).componentName="TextInterface";const E=(0,l.KR)(!1),w=(0,l.KR)(!1),C=(0,l.KR)(null),_=[],k=(0,l.KR)(e.intf.externalName);return{arrowRotation:y,displayArrow:f,editExternalName:E,el:t,enableExternalNameEdit:t=>{_.splice(0,_.length),_.push(...h.value.obtainExposedNames()),_.splice(_.indexOf(e.intf.externalName),1),E.value=!0,t.preventDefault(),(0,o.dY)().then((()=>{C.value.focus(),C.value.select(),w.value=h.value.isIncorrectExternalName(e.intf.externalName,_)}))},endHover:s,endHoverWrapper:()=>{v.value=!1,c.value.editor.readonly||s()},externalNameInput:C,externalNameInputIncorrect:w,externalNameInputCallback:e=>{w.value=h.value.isIncorrectExternalName(e.target.value,_)},externalNameFocusOutCallback:()=>{E.value=!1,w.value=!1;const t=h.value.resolveNewExposedName(k.value);k.value=t,c.value.editor.exposeInterface(h.value.id,e.intf,t)},hovered:v,isConnected:n,inputExternalName:k,newClasses:m,onMouseDown:g,openSidebar:r,showComponent:i,isExposed:b,startHover:a,startHoverWrapper:()=>{v.value=!0,c.value.editor.readonly||a()}}}}),v=(0,n(66262).A)(h,[["render",function(e,t,n,l,d,c){const u=(0,o.g2)("Arrow");return(0,o.uX)(),(0,o.CE)("div",{id:e.intf.id,ref:"el",class:(0,i.C4)(["baklava-node-interface",e.newClasses])},[e.intf.port?((0,o.uX)(),(0,o.CE)("div",{key:0,class:(0,i.C4)(["__port",{greyedout_arrow:e.highlighted,picked:e.picked,__square:e.isExposed}]),onMouseenter:t[8]||(t[8]=(...t)=>e.startHoverWrapper&&e.startHoverWrapper(...t)),onMouseleave:t[9]||(t[9]=(...t)=>e.endHoverWrapper&&e.endHoverWrapper(...t)),onPointerdown:t[10]||(t[10]=(0,a.D$)(((...t)=>e.onMouseDown&&e.onMouseDown(...t)),["left"]))},[e.isExposed&&(e.hovered||e.editExternalName)?((0,o.uX)(),(0,o.CE)("div",{key:0,class:(0,i.C4)({__port_name_left:"left"===e.intf.side,__port_name_right:"right"===e.intf.side})},[e.editExternalName?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:0,"onUpdate:modelValue":t[0]||(t[0]=t=>e.inputExternalName=t),ref:"externalNameInput",type:"text",spellcheck:"false",autocomplete:"off",class:(0,i.C4)(["__port_input",{__error:e.externalNameInputIncorrect}]),placeholder:"External name",onFocusout:t[1]||(t[1]=(...t)=>e.externalNameFocusOutCallback&&e.externalNameFocusOutCallback(...t)),onKeydown:[t[2]||(t[2]=(0,a.jR)((0,a.D$)((e=>{e.target.blur()}),["exact","stop"]),["enter"])),t[5]||(t[5]=(0,a.D$)((e=>e.stopPropagation()),["ctrl","stop"]))],onInput:t[3]||(t[3]=(...t)=>e.externalNameInputCallback&&e.externalNameInputCallback(...t)),onPointerdown:t[4]||(t[4]=(0,a.D$)((e=>e.stopPropagation()),["left","stop"]))},null,34)),[[a.Jo,e.inputExternalName]]):((0,o.uX)(),(0,o.CE)("span",{key:1,onPointerdown:t[6]||(t[6]=(0,a.D$)(((...t)=>e.enableExternalNameEdit&&e.enableExternalNameEdit(...t)),["left","stop"])),onKeydown:t[7]||(t[7]=(0,a.D$)((()=>{}),["stop"]))},(0,i.v_)(e.intf.externalName),33))],2)):(0,o.Q3)("",!0),e.displayArrow?((0,o.uX)(),(0,o.Wv)(u,{key:1,noninteractable:!0,color:"black",scale:"big",rotate:e.arrowRotation},null,8,["rotate"])):(0,o.Q3)("",!0)],34)):(0,o.Q3)("",!0),e.showComponent?((0,o.uX)(),(0,o.Wv)((0,o.$y)(e.intf.component),{key:1,modelValue:e.intf.value,"onUpdate:modelValue":t[11]||(t[11]=t=>e.intf.value=t),node:e.node,intf:e.intf,onKeydown:t[12]||(t[12]=(0,a.D$)((()=>{}),["stop"])),tabindex:e.tabindexValue},null,40,["modelValue","node","intf","tabindex"])):((0,o.uX)(),(0,o.CE)("span",r,(0,i.v_)(e.intf.name),1))],10,s)}]])},73510:(e,t,n)=>{"use strict";n.d(t,{A:()=>Q});var o=n(20641),i=n(53751),a=n(90033);const s=e=>((0,o.Qi)("data-v-1d7e5d1e"),e=e(),(0,o.jt)(),e),r={key:0,class:"__content"},l={class:"__header"},d=["src"],c={class:"__node-name"},u=["href","onPointerover"],p=["src","alt"],h={class:"__category"},v=s((()=>(0,o.Lk)("div",{class:"__title"},"Category",-1))),g={class:"__category-name"},f={key:0,class:"__replace"},y={key:0,class:"__replace_entry"},m=s((()=>(0,o.Lk)("div",{class:"__replace_title"},"Generalize:",-1))),b={key:1,class:"__replace_entry"},E=s((()=>(0,o.Lk)("div",{class:"__replace_title"},"Specialize:",-1))),w={key:2,class:"__replace_entry"},C=s((()=>(0,o.Lk)("div",{class:"__replace_title"},"Choose other type:",-1))),_={key:1,class:"__properties"},k=s((()=>(0,o.Lk)("div",{class:"__title"},"Properties",-1))),x={class:"__property-name"},N=s((()=>(0,o.Lk)("div",{class:"__title"}," Description ",-1))),P={class:"__markdown-content"},A=["innerHTML"],I={key:2,class:"__interface_groups"},L=s((()=>(0,o.Lk)("div",{class:"__title"},"Interface Groups",-1))),T={class:"__group-assign"},S={class:"__error_outputs"},M=s((()=>(0,o.Lk)("div",{class:"__title"},"Conflicts:",-1)));var W=n(50953),D=n(46171),O=n(63491),R=n(41552),X=n.n(R),$=n(42838),j=n.n($),K=n(81023),H=n(72409),U=n(73218),F=n(6565),G=n(14121),B=n(96422);const V=(0,o.pM)({components:{Cross:H.A,CustomInterface:K.A,CheckboxInterface:O.b,Tooltip:U.A},emits:["sidebar-open"],setup(e,{emit:t}){const n=F.Ay.getEditorManagerInstance(),i=(0,o.EW)((()=>n.baklavaView)),a=(0,o.EW)((()=>i.value.displayedGraph)),s=new(X().Converter)({smartIndentationFix:!0,simpleLineBreaks:!0}),r=(0,W.KR)(300),l=(0,o.EW)((()=>{const e=a.value.sidebar.nodeId;return a.value.nodes.find((t=>t.id===e))})),d=(0,o.EW)((()=>a.value.editor.nodeTypes.get(l.value.type).category)),c=(0,o.EW)((()=>`${d.value.split("/").join(" / ")}`)),u=(0,o.EW)((()=>{let e=s.makeHtml(l.value?.description??"");return e.match(/<a href="[a-zA-Z0-9-$_.+!*'()/&?=:%]+">/gm)?.forEach((t=>{const n=t.split('"'),o=` tabindex="-1" target="_blank"${n[2]}`,i=[n[0],n[1],o].join('"');e=e.replace(t,i)})),j().sanitize(e)})),p=(0,o.EW)((()=>i.value.editor.getNodeIconPath(l.value?.type))),h=(0,o.EW)((()=>i.value.editor.getNodeURLs(l.value?.type))),v=e=>i.value.cache[`./${e}`]??e,g=(0,o.EW)((()=>v(p.value))),f=(0,o.EW)((()=>a.value.sidebar.visible));(0,o.wB)(l,(()=>{void 0===l.value&&(a.value.sidebar.visible=!1)})),(0,o.wB)(f,(e=>{e&&t("sidebar-open")}));const y=(0,W.KR)(null),m=(0,W.KR)(null),b=(0,W.KR)(null);m.value={top:0,left:0,visible:!1,text:""};const E=(0,o.EW)((()=>({width:`${r.value}px`}))),w=e=>{e.preventDefault(),r.value-=e.movementX},C=(0,o.EW)((()=>Object.values(l.value.inputs).filter((e=>!e.hidden)))),_=(0,o.EW)((()=>Object.values(C.value).filter((e=>!e.port)))),k=(0,o.EW)((()=>Object.values({...l.value.inputs,...l.value.outputs}).filter((e=>void 0!==e.interfaces)))),x=(0,W.KR)(""),N=(0,o.EW)((()=>({"--disabled":""!==x.value}))),P=(0,o.EW)((()=>{const e=(0,W.KR)([]);return a.value.sidebar.visible,k.value.forEach((t=>{const n=new O.b(t.name,!t.hidden).setPort(!1);n.events.setValue.subscribe(this,(()=>{const e=(0,G.Sb)(A.value,l.value.inputs,l.value.outputs);e.length?x.value=e.map((([e,t,n])=>`Reused ${t} - ${e} for interface group ${n}`)):x.value=""})),n.componentName="CheckboxInterface",n.intfG=t,e.value.push(n)})),e.value})),A=(0,o.EW)((()=>{const e=[];return P.value.forEach((t=>{t.value&&e.push(`${t.intfG.direction}_${t.intfG.name}`)})),e})),I=(0,o.EW)((()=>{const e=new O.aw("Assign",(()=>{P.value.forEach((e=>{l.value.toggleInterfaceGroup(e.intfG,e.value)})),x.value=""}));return e.componentName="ButtonInterface",e})),L=e=>{const t=(0,W.KR)([]);return(e??[]).forEach((e=>{const n=new O.aw(e,(()=>{const t=a.value.replaceNode(l.value,e);a.value.sidebar.nodeId=t.id}));n.componentName="ButtonInterface",t.value.push(n)})),t.value},T=(0,o.EW)((()=>L(l.value.extends))),S=(0,o.EW)((()=>L(l.value.extending))),M=(0,o.EW)((()=>L(l.value.siblings))),R=(0,o.EW)((()=>""===l.value.title||void 0===l.value.title?l.value.type.startsWith(D.cO)?l.value.type.slice(D.cO.length):l.value.type:l.value.title));return{graph:a,node:l,styles:E,startResize:()=>{r.value=b.value.offsetWidth,window.addEventListener("mousemove",w),window.addEventListener("mouseup",(e=>{e.preventDefault(),window.removeEventListener("mousemove",w)}),{once:!0})},close:()=>{a.value.sidebar.visible=!1},displayedProperties:_,interfaceGroups:k,interfaceGroupsCheckboxes:P,interfaceGroupsButton:I,interfaceGroupsOutput:x,interfaceGroupsButtonClasses:N,nodeIconPath:g,nodeURLs:h,getIconPath:v,desc:u,tooltip:m,onPointerOver:(e,t)=>{m.value.text=e,m.value.visible=!0,(0,o.dY)().then((()=>{const e=t.clientX-t.offsetX+t.currentTarget.offsetWidth/2+y.value.$el.clientWidth;m.value.top=t.clientY-t.offsetY+t.currentTarget.offsetHeight,e>window.innerWidth?m.value.left=t.clientX-t.offsetX+t.currentTarget.offsetWidth/2-y.value.$el.clientWidth/2:m.value.left=t.clientX-t.offsetX+t.currentTarget.offsetWidth/2}))},onPointerLeave:()=>{m.value.visible=!1},tooltipRef:y,sidebarRef:b,toggleGroup:e=>{e.group.forEach((t=>{l.value.inputs[t].hidden=e.value}))},getOptionName:B.BW,prettyCategory:c,replacementParents:T,replacementChildren:S,replacementSiblings:M,editorManager:n,displayedName:R,updateDynamicInterfaces:e=>{l.value.updateDynamicInterfaces(e)}}}}),Q=(0,n(66262).A)(V,[["render",function(e,t,n,s,W,D){const O=(0,o.g2)("Tooltip"),R=(0,o.g2)("Cross"),X=(0,o.g2)("CustomInterface");return(0,o.uX)(),(0,o.CE)(o.FK,null,[(0,o.bo)((0,o.bF)(O,{ref:"tooltipRef",left:e.tooltip.left,top:e.tooltip.top,text:e.tooltip.text},null,8,["left","top","text"]),[[i.aG,e.tooltip.visible]]),(0,o.Lk)("div",{class:(0,a.C4)(["baklava-sidebar prevent-select",{"--open":e.graph.sidebar.visible,"--hidehud":e.editorManager.editor.hideHud,"--preview":e.editorManager.editor.preview,"hidden-navbar":e.$isMobile}]),ref:"sidebarRef",style:(0,a.Tr)(e.styles)},[(0,o.Lk)("div",{class:"__resizer",onMousedown:t[0]||(t[0]=(...t)=>e.startResize&&e.startResize(...t))},null,32),e.node?((0,o.uX)(),(0,o.CE)("div",r,[(0,o.Lk)("div",l,[(0,o.bF)(R,{tabindex:"-1",class:"__close",onClick:e.close},null,8,["onClick"]),void 0!==e.nodeIconPath?((0,o.uX)(),(0,o.CE)("img",{key:0,class:"__node-icon",src:e.nodeIconPath},null,8,d)):(0,o.Q3)("",!0),(0,o.Lk)("div",c,(0,a.v_)(e.displayedName),1),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.nodeURLs,(n=>((0,o.uX)(),(0,o.CE)("a",{key:n.name,href:n.url,class:"__url",target:"_blank",draggable:"false",onPointerover:t=>e.onPointerOver(n.name,t),onPointerleave:t[1]||(t[1]=(...t)=>e.onPointerLeave&&e.onPointerLeave(...t)),tabindex:"-1"},[void 0!==n.icon?((0,o.uX)(),(0,o.CE)("img",{key:0,src:e.getIconPath(n.icon),alt:n.name,draggable:"false"},null,8,p)):(0,o.Q3)("",!0)],40,u)))),128))]),(0,o.Lk)("div",h,[v,(0,o.Lk)("div",g,(0,a.v_)(e.prettyCategory),1)]),e.editorManager.editor.readonly?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("div",f,[e.replacementParents.length?((0,o.uX)(),(0,o.CE)("div",y,[m,((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.replacementParents,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e,class:"__replace_button"},[((0,o.uX)(),(0,o.Wv)((0,o.$y)(e.component),{intf:e,tabindex:"-1"},null,8,["intf"]))])))),128))])):(0,o.Q3)("",!0),e.replacementChildren.length?((0,o.uX)(),(0,o.CE)("div",b,[E,((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.replacementChildren,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e,class:"__replace_button"},[((0,o.uX)(),(0,o.Wv)((0,o.$y)(e.component),{intf:e,tabindex:"-1"},null,8,["intf"]))])))),128))])):(0,o.Q3)("",!0),e.replacementSiblings.length?((0,o.uX)(),(0,o.CE)("div",w,[C,((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.replacementSiblings,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e,class:"__replace_button"},[((0,o.uX)(),(0,o.Wv)((0,o.$y)(e.component),{intf:e,tabindex:"-1"},null,8,["intf"]))])))),128))])):(0,o.Q3)("",!0)])),e.displayedProperties.length?((0,o.uX)(),(0,o.CE)("div",_,[k,((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.displayedProperties,(t=>((0,o.uX)(),(0,o.CE)("div",{key:t.id,class:"__property"},[(0,o.Lk)("div",x,(0,a.v_)(e.getOptionName(t.componentName)?`${t.name}:`:""),1),(0,o.bF)(X,{node:e.node,intf:t,toggleGroup:e.toggleGroup,updateDynamicInterfaces:e.updateDynamicInterfaces,tabindex:"-1"},null,8,["node","intf","toggleGroup","updateDynamicInterfaces"])])))),128))])):(0,o.Q3)("",!0),(0,o.bo)((0,o.Lk)("div",null,[N,(0,o.Lk)("div",P,[(0,o.Lk)("span",{innerHTML:e.desc,class:"node_description"},null,8,A)])],512),[[i.aG,e.desc]]),e.interfaceGroupsCheckboxes.length>0&&!e.editorManager.editor.readonly?((0,o.uX)(),(0,o.CE)("div",I,[L,((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.interfaceGroupsCheckboxes,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:"__group"},[((0,o.uX)(),(0,o.Wv)((0,o.$y)(e.component),{intf:e},null,8,["intf"]))])))),128)),(0,o.Lk)("div",T,[((0,o.uX)(),(0,o.Wv)((0,o.$y)(e.interfaceGroupsButton.component),{intf:e.interfaceGroupsButton,class:(0,a.C4)(e.interfaceGroupsButtonClasses),tabindex:"-1"},null,8,["intf","class"]))])])):(0,o.Q3)("",!0),(0,o.bo)((0,o.Lk)("div",S,[M,((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.interfaceGroupsOutput,(e=>((0,o.uX)(),(0,o.CE)("p",null,(0,a.v_)(e),1)))),256))],512),[[i.aG,e.interfaceGroupsOutput.length]])])):(0,o.Q3)("",!0)],6)],64)}],["__scopeId","data-v-1d7e5d1e"]])},89401:(e,t,n)=>{"use strict";n.d(t,{A:()=>gt});var o=n(20641),i=n(90033),a=n(53751);const s={class:"selection-container"};var r=n(46171),l=n(63491),d=n(50953),c=n(15531),u=n.n(c),p=n(58365),h=n(42838),v=n.n(h),g=n(81023);const f={key:0,class:"readonly item",style:{cursor:"default"}},y=[(0,o.Lk)("div",{class:"text"},[(0,o.Lk)("i",null,"No resources")],-1)],m=["onClick"],b={class:"icon"},E={class:"text"},w=["href","onClick"],C={class:"icon"},_=["src","alt"],k={class:"text"},x=(0,o.pM)({extends:l.XF.ContextMenu,props:{urls:{required:!1,default:[]}},emits:["update:modelValue","click"],setup(e,t){const{el:n,styles:o,classes:i,itemsWithHoverProperty:a}=l.XF.ContextMenu.setup(e,t),{viewModel:s}=(0,l.if)(),r=(0,d.KR)(!0),c=o=>{!0===e.modelValue&&(!1===r.value?(document.elementsFromPoint(o.clientX,o.clientY).includes(n.value)||(window.removeEventListener("wheel",c),window.removeEventListener("pointerdown",c),t.emit("update:modelValue",!1)),r.value=!0):r.value=!1)};return window.addEventListener("wheel",c),window.addEventListener("pointerdown",c),{el:n,styles:o,classes:i,itemsWithHoverProperty:a,onClick:e=>{t.emit("click",e.value),t.emit("update:modelValue",!1)},getIconPath:e=>s.value.cache[`./${e}`]??e}}});var N=n(66262);const P=(0,N.A)(x,[["render",function(e,t,n,s,r,l){return(0,o.uX)(),(0,o.Wv)(a.eB,{name:"slide-fade"},{default:(0,o.k6)((()=>[(0,o.bo)((0,o.Lk)("div",{ref:"el",class:(0,i.C4)(["baklava-context-menu",e.classes]),style:(0,i.Tr)(e.styles)},[0===e.itemsWithHoverProperty.length?((0,o.uX)(),(0,o.CE)("div",f,y)):(0,o.Q3)("",!0),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.itemsWithHoverProperty,((t,n)=>((0,o.uX)(),(0,o.CE)(o.FK,null,[void 0===t.url?((0,o.uX)(),(0,o.CE)("div",{key:`i-${n}`,class:(0,i.C4)(["item",{submenu:!!t.submenu,"--disabled":!!t.disabled}]),onClick:(0,a.D$)((n=>e.onClick(t)),["stop"])},[(0,o.Lk)("div",b,[void 0!==t.icon?((0,o.uX)(),(0,o.Wv)((0,o.$y)(t.icon),{key:0})):(0,o.Q3)("",!0)]),(0,o.Lk)("div",E,(0,i.v_)(t.label),1)],10,m)):((0,o.uX)(),(0,o.CE)("a",{key:t.name,href:t.url,class:"item",target:"_blank",draggable:"false",onClick:(0,a.D$)((n=>e.onClick(t)),["stop"])},[(0,o.Lk)("div",C,[void 0!==e.getIconPath(t.icon)?((0,o.uX)(),(0,o.CE)("img",{key:0,src:e.getIconPath(t.icon),alt:t.name,draggable:"false"},null,8,_)):(0,o.Q3)("",!0)]),(0,o.Lk)("div",k,(0,i.v_)(t.name),1)],8,w)),t.endSection?((0,o.uX)(),(0,o.CE)("hr",{key:`hr-${n}`})):(0,o.Q3)("",!0)],64)))),256))],6),[[a.aG,e.modelValue]])])),_:1})}]]);var A=n(45825),I=n(36429),L=n(41426),T=n(96422),S=n(41857),M=n(6565),W=n(93617),D=n(96335),O=n(40861),R=n(5892),X=n(3345),$=n(18610);const j=["id","data-node-type"],K={class:"interface-cursor"},H=["onPointerdown"],U=["src"],F=["innerHTML"],G=["onKeydown"],B=["onPointerdown"],V={class:"__properties"},Q={key:1,class:"baklava-node-interface --output"},Y={key:1,class:"baklava-node-interface --input"},z={__name:"CustomNode",props:{node:r.hZ,selected:Boolean,greyedOut:Boolean,interfaces:Array},emits:["select"],setup(e,{emit:t}){const n=e,{viewModel:s}=(0,l.if)(),{graph:c}=(0,l.uU)(),u=(0,o.EW)((()=>s.value.movementStep)),h=(0,o.EW)((()=>({"transform-origin":"0 0",transform:`scale(${1/c.value.scaling})`}))),f=(0,d.KR)(null),y=(0,d.KR)(null),m=(0,d.KR)(!1),b=(0,d.KR)(null),E=(0,d.KR)(""),w=s.value.editor.getNodeURLs(n.node.type),C=!s.value.editor.nodeURLsEmpty(),_=(0,o.EW)((()=>Object.values(n.node.inputs).filter((e=>!e.hidden)))),k=(0,o.EW)((()=>Object.values(n.node.outputs).filter((e=>!e.hidden)))),x=M.Ay.getEditorManagerInstance(),N=(0,D.A)();Object.entries(n.node.inputs).forEach((([e,t])=>{if(N.backendAvailable&&e.startsWith("property_")){let e=!0;(0,o.wB)(t,(async t=>{if(e||!x.notifyWhenChanged)return void(e=!1);const o={graph_id:n.node.graphInstance.id,node_id:n.node.id,properties:[]};o.properties.push({id:t.id,new_value:t.value}),await N.notifyAboutChange("properties_on_change",o)}))}}));const z=e=>{N.notifyAboutChange("position_on_change",{graph_id:n.node.graphInstance.id,node_id:n.node.id,position:{x:e.x,y:e.y}})},q=e=>(0,o.wB)(e,(e=>{x.notifyWhenChanged&&z(e)}));if(N.backendAvailable){let e=q(n.node.position);(0,o.wB)((()=>n.node.position),(t=>{e(),z(t),e=q(t)}))}const J=(0,d.KR)(!1),Z=(0,d.KR)(0),ee=(0,d.KR)(0),te=(0,o.EW)((()=>{const e=[];return e.push({value:"sidebar",label:"Details",icon:I.A.Sidebar}),s.value.editor.readonly||e.push({value:"rename",label:"Rename",icon:I.A.Pencil}),n.node.type.startsWith(r.cO)&&e.push({value:"editSubgraph",label:"Edit Subgraph"}),e.length>1&&(e.at(-1).endSection=!0),e.push(...w),s.value.editor.readonly||(e.length>1&&(e.at(-1).endSection=!0),e.push({value:"disconnect",label:"Disconnect",icon:I.A.Disconnect},{value:"delete",label:"Delete",icon:I.A.Bin})),e})),ne=()=>{const{sidebar:e}=s.value.displayedGraph;e.nodeId=n.node.id,e.visible=!0},oe=async e=>{switch(e){case"delete":(0,S.nb)(),c.value.selectedNodes.includes(n.node)||c.value.selectedNodes.push(n.node),c.value.selectedNodes.forEach((e=>{(0,T.bf)(e)})),(0,S.wH)();break;case"rename":E.value=n.node.title,m.value=!0,await(0,o.dY)(),b.value.focus(),b.value.select();break;case"disconnect":{(0,S.nb)();let e=[..._.value,...k.value];c.value.selectedNodes.forEach((t=>{e=e.concat(Object.entries(t.inputs).filter((([e,t])=>!t.hidden&&!e.startsWith("property_"))).map((([,e])=>e)),Object.values(t.outputs).filter((e=>!e.hidden)))})),c.value.connections.filter((t=>void 0!==e.find((e=>e===t.from||e===t.to)))).forEach((e=>{c.value.removeConnection(e)})),(0,S.wH)()}break;case"sidebar":ne();break;case"editSubgraph":{const e=s.value.editor.switchToSubgraph(n.node);Array.isArray(e)&&e.length&&W.A.terminalLog("error","Dataflow is invalid",e);break}case"unwrap":(0,S.nb)(),(0,T.bf)(n.node,!0),(0,S.wH)()}},ie=(0,o.EW)((()=>0===te.value.length&&C||te.value.length>0)),ae=(0,d.KR)(!1),se=e=>{if(ie.value&&!1===J.value&&!1===ae.value){const t=e.currentTarget;Z.value=e.offsetX,ee.value=e.offsetY+t.offsetTop+20,J.value=!0}},re=function(e,t,n){const{graph:o}=(0,l.uU)(),i=(0,p.A)(e,n,t),a=i.onPointerMove;return i.onPointerMove=n=>{const i=e.value.x,s=e.value.y;a(n);const r=e.value.x-i,l=e.value.y-s;o.value.selectedNodes.forEach((e=>{e.id!==t&&(e.position.x+=r,e.position.y+=l)}))},i}((0,d.lW)(n.node,"position"),n.node.id,(0,A.i)(u)),le=(0,o.EW)((()=>({"--selected":n.selected,"--dragging":re.dragging.value,"--two-column":!!n.node.twoColumn,"--greyed-out":n.greyedOut,__readonly:s.value.editor.readonly}))),de=(0,o.EW)((()=>({top:`${n.node.position?.y??0}px`,left:`${n.node.position?.x??0}px`,width:`${n.node.width??300}px`}))),ce=(0,o.EW)((()=>{const e=n.node.highlightedTitle??n.node.title,t=n.node.highlightedType??n.node.type;return n.node.type.startsWith(r.cO)?""===e||void 0===e?n.node.highlightedTitle===n.node.title?t.slice(r.cO.length):t:e:""===e||n.node.title===n.node.type?t:`${e} <pre class="subtitle">${t}</pre>`})),ue=e=>{t("select",e)};let pe,he;const ve=()=>{document.removeEventListener("pointermove",re.onPointerMove),document.removeEventListener("keyboard.escape",pe),document.removeEventListener("pointerup",he)};pe=()=>{ve()},he=()=>{re.onPointerUp(),ve()};const ge=()=>{c.value.findNodeById(n.node.id).title=E.value,m.value=!1},fe=()=>{f.value&&s.value.hooks.renderNode.execute({node:n.node,el:f.value})};(0,o.sV)(fe),(0,o.$u)(fe);const ye=(0,L.A)(700,(()=>{ne()})),me=()=>{const{sidebar:e}=s.value.displayedGraph;e.visible&&(e.nodeId=n.node.id),ye()},be=(0,o.EW)((()=>Object.values(_.value).filter((e=>!e.port)))),Ee=(0,o.EW)((()=>Object.values([..._.value,...k.value]).filter((e=>"left"===e.side&&e.port)).sort(((e,t)=>e.sidePosition-t.sidePosition)))),we=(0,o.EW)((()=>Object.values([..._.value,...k.value]).filter((e=>"right"===e.side&&e.port)).sort(((e,t)=>e.sidePosition-t.sidePosition)))),Ce=e=>{if(!e.length)return[];const t=Math.max(Ee.value.at(-1)?.sidePosition??0,we.value.at(-1)?.sidePosition??0);let n=0;const o=[];for(let i=0;i<=t;i+=1)e[n]?.sidePosition===i?(o.push(e[n]),n+=1):o.push(void 0);return o},_e=(0,o.EW)((()=>Ce(we.value))),ke=(0,o.EW)((()=>Ce(Ee.value)));be.value.forEach((e=>{void 0===e.component&&("InputInterface"===e.componentName?e.setComponent((0,d.IG)(O.A)):"ListInterface"===e.componentName?e.setComponent((0,d.IG)(R.A)):"SliderInterface"===e.componentName?e.setComponent((0,d.IG)(X.A)):"HexInterface"===e.componentName&&e.setComponent((0,d.IG)($.A)))}));const xe=s.value.editor.getNodeIconPath(n.node.type),Ne=s.value.cache[`./${xe}`]??xe;let Pe,Ae;const Ie=(0,d.KR)(null),Le=(0,d.KR)(null),Te=(0,d.KR)({top:"0px",left:"0px",display:"none"}),Se=(0,o.EW)((()=>s.value.editor.readonly?ie.value?{cursor:"pointer"}:{cursor:"default"}:{cursor:"drag"})),Me=e=>e===Ae,We=e=>{let t;"right"===Ae.side?t=Le.value:"left"===Ae.side&&(t=Ie.value);let n=[...t.children].findIndex((t=>t.getBoundingClientRect().bottom>e.clientY));Pe=n,-1===n&&(n=t.children.length-1,Pe=t.children.length-1);const o=t.children[n];Te.value={top:o.offsetTop+o.offsetHeight/2-2.5+"px",display:"block"},"right"===Ae.side?Te.value.right="-0.7em":"left"===Ae.side&&(Te.value.left="-0.7em")},De=()=>{(0,T.q6)(n.node,Ae,Ae.side,Pe,!0),Ae=void 0,Te.value={top:"0px",left:"0px",right:"0px",display:"none"},document.removeEventListener("pointermove",We),document.removeEventListener("pointerup",De)},Oe=(e,t)=>{Ae=e,We(t),document.addEventListener("pointermove",We),document.addEventListener("pointerup",De)},Re=(0,d.KR)(0),Xe=(0,d.KR)(0),$e=()=>{const e=[];if(void 0!==Ae){const t=void 0===Ae.externalName?{value:"SetExternalName",label:"Expose Interface"}:{value:"UnsetExternalName",label:"Privatize Interface"};e.push(t)}return e.push({value:"SpaceUp",label:"Space Up"},{value:"SpaceDown",label:"Space Down"},{value:"MoveUp",label:"Move Up"},{value:"MoveDown",label:"Move Down"}),e},je=(0,d.KR)($e()),Ke=e=>{switch(e){case"SetExternalName":s.value.editor.exposeInterface(c.value.id,Ae);break;case"UnsetExternalName":s.value.editor.privatizeInterface(c.value.id,Ae);break;case"MoveUp":if(0===Ae.sidePosition){Ae=void 0;break}Pe=Ae.sidePosition-1,De();break;case"MoveDown":Pe=Ae.sidePosition+1,De();break;case"SpaceUp":case"SpaceDown":{const t="right"===Ae.side?_e.value:ke.value,n="SpaceDown"===e?(e,t)=>e>t:(e,t)=>e>=t;Object.values(t).forEach((e=>{void 0!==e&&n(e.sidePosition,Ae.sidePosition)&&(e.sidePosition+=1)}));break}}},He=(e,t)=>{s.value.editor.readonly||!1!==ae.value||(Ae=e,je.value=$e(),"right"===Ae.side?(Re.value=t.currentTarget.offsetLeft+162.5,Xe.value=t.currentTarget.offsetTop+12.5):"left"===Ae.side&&(Re.value=t.currentTarget.offsetLeft-t.currentTarget.offsetWidth+162.5,Xe.value=t.currentTarget.offsetTop+12.5),ae.value=!0)};(0,o.wB)(ae,(()=>{!1===ae.value&&(Ae=void 0)}));const Ue=e=>{e.group.forEach((t=>{n.node.inputs[t].hidden=!e.value}))},Fe=e=>{n.node.updateDynamicInterfaces(e)},Ge=e=>{"left"===e.side?(0,T.q6)(n.node,e,"right"):(0,T.q6)(n.node,e,"left")};return(t,r)=>{const l=(0,o.gN)("click-outside"),u=(0,o.gN)("long-press"),p=(0,o.gN)("long-press-to-right");return(0,o.uX)(),(0,o.CE)("div",{id:e.node.id,ref_key:"nodeRef",ref:f,class:(0,i.C4)(["baklava-node",(0,d.R1)(le)]),style:(0,i.Tr)((0,d.R1)(de)),"data-node-type":e.node.type,onPointerdown:r[5]||(r[5]=(0,a.D$)((e=>ue(e)),["left","self"])),oncontextmenu:"return false;"},[(0,o.Lk)("div",K,[(0,o.Lk)("div",{class:"line",style:(0,i.Tr)(Te.value)},null,4)]),(0,o.bo)(((0,o.uX)(),(0,o.CE)("div",{class:"__title",ref_key:"titleRef",ref:y,style:(0,i.Tr)((0,d.R1)(Se)),onPointerdown:[(0,a.D$)(me,["left","exact"]),r[3]||(r[3]=(0,a.D$)((e=>{return t=e,void(s.value.editor.readonly||(e=>{c.value.selectedNodes.includes(n.node)||ue(e),re.onPointerDown(e),document.addEventListener("pointermove",re.onPointerMove),document.addEventListener("keyboard.escape",pe),document.addEventListener("pointerup",he)})(t));var t}),["left"])),(0,a.D$)(se,["right"])]},[void 0!==(0,d.R1)(Ne)?((0,o.uX)(),(0,o.CE)("img",{key:0,class:"__title-icon",src:(0,d.R1)(Ne)},null,8,U)):(0,o.Q3)("",!0),m.value?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:2,type:"text",class:"baklava-input","onUpdate:modelValue":r[0]||(r[0]=e=>E.value=e),placeholder:"Node Name",ref_key:"renameField",ref:b,onKeydown:(0,a.jR)(ge,["enter"])},null,40,G)),[[a.Jo,E.value],[l,ge]]):((0,o.uX)(),(0,o.CE)("div",{key:1,class:"__title-label",innerHTML:(0,d.R1)(v()).sanitize((0,d.R1)(ce))},null,8,F)),J.value?((0,o.uX)(),(0,o.Wv)(P,{key:3,modelValue:J.value,"onUpdate:modelValue":r[1]||(r[1]=e=>J.value=e),x:Z.value,y:ee.value,items:(0,d.R1)(te),urls:(0,d.R1)(w),style:(0,i.Tr)((0,d.R1)(h)),onPointerdown:r[2]||(r[2]=(0,a.D$)((()=>{}),["left","stop"])),onClick:oe},null,8,["modelValue","x","y","items","urls","style"])):(0,o.Q3)("",!0)],44,H)),[[u,se,"500"]]),(0,o.Lk)("div",{class:"__content",onPointerdown:(0,a.D$)(se,["right"])},[(0,o.Lk)("div",V,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)((0,d.R1)(be),(t=>((0,o.uX)(),(0,o.CE)("div",{key:t.id},[(0,o.eW)((0,i.v_)((0,d.R1)(T.BW)(t.componentName)?`${t.name}:`:"")+" ",1),(0,o.bF)(g.A,{node:e.node,intf:t,toggleGroup:Ue,updateDynamicInterfaces:Fe},null,8,["node","intf"])])))),128))]),(0,o.Lk)("div",{class:"__outputs",ref_key:"rightSocketsRefs",ref:Le},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)((0,d.R1)(_e),(t=>((0,o.uX)(),(0,o.CE)(o.FK,null,[t?(0,o.bo)(((0,o.uX)(),(0,o.Wv)(g.A,{key:t.id,onPointerdown:[(0,a.D$)((e=>Oe(t,e)),["left","shift"]),(0,a.D$)((e=>He(t,e)),["right","exact"])],node:e.node,intf:t,highlighted:n.interfaces.includes(t),picked:Me(t),switchSides:Ge},null,8,["onPointerdown","node","intf","highlighted","picked"])),[[p,void 0,"500"]]):((0,o.uX)(),(0,o.CE)("div",Q," "))],64)))),256))],512),(0,o.Lk)("div",{class:"__inputs",ref_key:"leftSocketsRefs",ref:Ie},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)((0,d.R1)(ke),(t=>((0,o.uX)(),(0,o.CE)(o.FK,null,[t?(0,o.bo)(((0,o.uX)(),(0,o.Wv)(g.A,{key:t.id,onPointerdown:[(0,a.D$)((e=>Oe(t,e)),["left","shift"]),(0,a.D$)((e=>He(t,e)),["right"])],node:e.node,intf:t,highlighted:n.interfaces.includes(t),picked:Me(t),switchSides:Ge},null,8,["onPointerdown","node","intf","highlighted","picked"])),[[p,void 0,"500"]]):((0,o.uX)(),(0,o.CE)("div",Y," "))],64)))),256))],512),ae.value?((0,o.uX)(),(0,o.Wv)(P,{key:0,modelValue:ae.value,"onUpdate:modelValue":r[4]||(r[4]=e=>ae.value=e),x:Re.value,y:Xe.value,items:je.value,style:(0,i.Tr)((0,d.R1)(h)),onClick:Ke},null,8,["modelValue","x","y","items","style"])):(0,o.Q3)("",!0)],40,B)],46,j)}}},q=(0,N.A)(z,[["__scopeId","data-v-6b3c6ea2"]]),J={key:0},Z=["d"],ee=["onPointerdown"],te=["d"],ne=["d"],oe=["d"],ie=["d"];var ae=n(95774);const se=(0,o.pM)({extends:l.XF.Connection,props:{isHighlighted:{default:!1},connection:{required:!0}},components:{Anchor:ae.A},setup(e){const{classes:t}=l.XF.Connection.setup(e),{graph:n}=(0,l.uU)(),{viewModel:i}=(0,l.if)(),{interfaceTypes:a}=i.value,s=a.getConnectionStyle(e.connection.from,e.connection.to),r=(0,o.EW)((()=>({...t.value,"--hover":e.isHighlighted,"--dashed":"dashed"===s.interfaceConnectionPattern,"--dotted":"dotted"===s.interfaceConnectionPattern}))),d=(0,o.EW)((()=>({"--color":s.interfaceConnectionColor}))),c=(0,L.A)(700,(t=>{i.value.editor.readonly||(t.preventDefault(),n.value.removeConnection(e.connection))})),u=(e,t)=>[(e+n.value.panning.x)*n.value.scaling,(t+n.value.panning.y)*n.value.scaling],p=(0,o.EW)((()=>{const[t,n]=u(e.x1,e.y1),[o,a]=u(e.x2,e.y2);return i.value.connectionRenderer.render(t,n,o,a,e.connection)}));return{cssClasses:r,parsedNewD:(0,o.EW)((()=>{const e=p.value;if(Array.isArray(e)&&e.length){const t=[];for(let n=0;n<e.length-1;n+=1)t.push(`M ${e[n].x} ${e[n].y} L ${e[n+1].x} ${e[n+1].y}`);return t}return e})),onMouseDown:c,onMouseCtrlDown:(t,o)=>{if(i.value.editor.readonly||"orthogonal"!==i.value.connectionRenderer.style)return;t.preventDefault();const a={x:t.offsetX/n.value.scaling-n.value.panning.x,y:t.offsetY/n.value.scaling-n.value.panning.y,id:Date.now()};n.value.addAnchor(a,e.connection,Math.trunc((o-1)/3))},style:d,hasAnchors:(0,o.EW)((()=>void 0!==e.connection.anchors&&e.connection.anchors.length&&"orthogonal"===i.value.connectionRenderer.style)),removeAnchor:t=>{i.value.editor.readonly||(n.value.events.removeAnchor.emit([e.connection,t]),e.connection.anchors.splice(t,1))}}}}),re=(0,N.A)(se,[["render",function(e,t,n,s,r,l){const d=(0,o.g2)("Anchor");return e.hasAnchors?((0,o.uX)(),(0,o.CE)("g",J,[(0,o.Lk)("path",{d:e.parsedNewD,class:"connection-wrapper baklava-connection"},null,8,Z),e.hasAnchors?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.parsedNewD,((n,s)=>((0,o.uX)(),(0,o.CE)("g",{onPointerdown:[t[0]||(t[0]=(0,a.D$)(((...t)=>e.onMouseDown&&e.onMouseDown(...t)),["left","exact"])),t[1]||(t[1]=t=>{"touch"===t.pointerType&&e.onMouseDown(t)}),(0,a.D$)((t=>e.onMouseCtrlDown(t,s)),["left","ctrl","exact"])]},[(0,o.Lk)("path",{d:n,class:"connection-wrapper baklava-connection"},null,8,te),(0,o.Lk)("path",{d:n,class:(0,i.C4)(["baklava-connection",e.cssClasses]),style:(0,i.Tr)(e.style)},null,14,ne)],40,ee)))),256)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.connection.anchors,((t,n)=>((0,o.uX)(),(0,o.Wv)(d,{key:t.id,position:t,rightclickCallback:()=>e.removeAnchor(n)},null,8,["position","rightclickCallback"])))),128))],64)):(0,o.Q3)("",!0)])):((0,o.uX)(),(0,o.CE)("g",{key:1,onPointerdown:[t[2]||(t[2]=(0,a.D$)(((...t)=>e.onMouseDown&&e.onMouseDown(...t)),["left","exact"])),t[3]||(t[3]=t=>{"touch"===t.pointerType&&e.onMouseDown(t)}),t[4]||(t[4]=(0,a.D$)((t=>e.onMouseCtrlDown(t,0)),["left","ctrl","exact"]))]},[(0,o.Lk)("path",{d:e.parsedNewD,class:"connection-wrapper baklava-connection"},null,8,oe),(0,o.Lk)("path",{d:e.parsedNewD,class:(0,i.C4)(["baklava-connection",e.cssClasses]),style:(0,i.Tr)(e.style)},null,14,ie)],32))}]]);function le(e){const t=document.getElementById(e.id),n=t?.getElementsByClassName("__port");return{node:t?.closest(".baklava-node")??null,interface:t,port:n&&n.length>0?n[0]:null}}const de=(0,o.pM)({extends:l.XF.ConnectionWrapper,props:{connection:{required:!0},isHighlighted:{default:!1}},components:{ConnectionView:re},setup(e){const t=(0,d.KR)(null),{graph:n}=(0,l.uU)();let i;const a=(0,d.KR)({x1:0,y1:0,x2:0,y2:0}),s=(0,o.EW)((()=>e.connection.isInDanger?2:0)),r=(0,o.EW)((()=>n.value.findNodeById(e.connection.from.nodeId)?.position)),c=(0,o.EW)((()=>n.value.findNodeById(e.connection.to.nodeId)?.position)),u=(0,o.EW)((()=>n.value.findNodeById(e.connection.from.nodeId))),p=(0,o.EW)((()=>n.value.findNodeById(e.connection.to.nodeId))),h=(0,o.EW)((()=>[...Object.values(u.value?.inputs??{}),...Object.values(u.value?.outputs??{})].map((e=>[e.side,e.sidePosition])))),v=(0,o.EW)((()=>[...Object.values(p.value?.inputs??{}),...Object.values(p.value?.outputs??{})].map((e=>[e.side,e.sidePosition])))),g=e=>e.node&&e.interface&&e.port?[e.node.offsetLeft+e.interface.offsetLeft+e.port.offsetLeft+e.port.clientWidth/2,e.node.offsetTop+e.interface.offsetTop+e.port.offsetTop+e.port.clientHeight/2]:[0,0],f=()=>{const t=le(e.connection.from),n=le(e.connection.to);t.node&&n.node&&(i||(i=new ResizeObserver((()=>{f()})),i.observe(t.node),i.observe(n.node)));const[o,s]=g(t),[r,l]=g(n);a.value={x1:o,y1:s,x2:r,y2:l}};return(0,o.wB)([h,v],(async()=>{await(0,o.dY)(),f()})),(0,o.wB)([r,c],(async()=>{await(0,o.dY)(),f()}),{deep:!0}),(0,o.sV)((async()=>{await(0,o.dY)(),f()})),(0,o.xo)((()=>{i&&i.disconnect()})),{d:a,state:s,containsPoint:e=>e.includes(t.value.$el.firstChild),conn:t}}}),ce=(0,N.A)(de,[["render",function(e,t,n,i,a,s){const r=(0,o.g2)("ConnectionView");return(0,o.uX)(),(0,o.Wv)(r,{ref:"conn",x1:e.d.x1,y1:e.d.y1,x2:e.d.x2,y2:e.d.y2,state:e.state,connection:e.connection,isHighlighted:e.isHighlighted},null,8,["x1","y1","x2","y2","state","connection","isHighlighted"])}]]),ue={extends:l.XF.TemporaryConnection,components:{ConnectionView:re},setup(e){const{d:t,status:n}=l.XF.TemporaryConnection.setup(e),i=(0,o.EW)((()=>{let{input:n,output:o}=t.value;return e.connection.from.isInput&&([n,o]=[o,n]),{input:n,output:o}}));return{d:t,swappedD:i,status:n}}},pe=(0,N.A)(ue,[["render",function(e,t,n,i,a,s){const r=(0,o.g2)("ConnectionView");return(0,o.uX)(),(0,o.Wv)(r,{x1:i.swappedD.input[0],y1:i.swappedD.input[1],x2:i.swappedD.output[0],y2:i.swappedD.output[1],state:i.status,connection:e.connection,"is-temporary":""},null,8,["x1","y1","x2","y2","state","connection"])}]]),he={class:"search-bar"},ve=(0,o.Lk)("div",{class:"palette-title"},[(0,o.Lk)("span",null,"Nodes browser")],-1),ge={class:"__entry_search"},fe={class:"nodes"};var ye=n(97786);const me={key:0},be=["onPointerdown"],Ee=["src"],we=["innerHTML"],Ce=["onClick"],_e={class:"__icondiv"},ke=["onClick"],xe=["onClick","onPointerdown"],Ne=["src"],Pe=["innerHTML"],Ae=["onClick"],Ie={class:"__icondiv"},Le=["innerHTML"],Te=["onPointerdown"],Se=["src"],Me=["innerHTML"],We=["onClick"],De={class:"__icondiv"},Oe={key:1,class:"__title"};var Re=n(45788),Xe=n(55647);const $e={ref:"el"},je=["href"],Ke={class:"link_item"},He=["src"],Ue=(e=>((0,o.Qi)("data-v-28f02260"),e=e(),(0,o.jt)(),e))((()=>(0,o.Lk)("br",null,null,-1))),Fe=(0,o.pM)({props:{node:{required:!0}},setup(e){const t=(0,d.KR)(null),{viewModel:n}=(0,l.if)();return{el:t,getIconPath:e=>n.value.cache[`./${e}`]??e,nodeRef:(0,d.KR)(e.node)}}}),Ge=(0,N.A)(Fe,[["render",function(e,t,n,s,r,l){return(0,o.uX)(),(0,o.Wv)(a.eB,{name:"slide-fade"},{default:(0,o.k6)((()=>[(0,o.Lk)("div",$e,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.nodeRef.URLs,(n=>((0,o.uX)(),(0,o.CE)("a",{key:n.name,href:n.url,class:"__url",target:"_blank",draggable:"false",onPointerdown:t[0]||(t[0]=(0,a.D$)((()=>{}),["left","stop"]))},[(0,o.Lk)("div",Ke,[void 0!==n.icon?((0,o.uX)(),(0,o.CE)("img",{key:0,src:e.getIconPath(n.icon),draggable:"false"},null,8,He)):(0,o.Q3)("",!0),(0,o.Lk)("span",null,(0,i.v_)(n.name),1),Ue])],40,je)))),128))],512)])),_:1})}],["__scopeId","data-v-28f02260"]]);var Be=n(72409);const Ve=e=>{const t={},n={};return e.forEach((e=>{const[t,...o]=e.split("/");Object.keys(n).includes(t)||(n[t]=[]),o.length>0&&n[t].push(o.join("/"))})),Object.entries(n).forEach((([e,n])=>{t[e]=Ve(new Set(n))})),t},Qe=e=>{const[t,n]=e;n.hitSubstring=t,void 0!==n.categoryNode&&(n.categoryNode.hitSubstring=n.categoryNode.title),void 0!==n.nodes.nodeTypes&&Object.entries(n.nodes.nodeTypes).forEach((([,e])=>{e.hitSubstring=e.title})),Object.entries(n.subcategories).forEach((e=>Qe(e)))},Ye=e=>{e.mask=!0,void 0!==e.categoryNode&&(e.categoryNode.mask=!0),void 0!==e.nodes.nodeTypes&&Object.values(e.nodes.nodeTypes).forEach((e=>{e.mask=!0})),Object.values(e.subcategories).forEach((e=>Ye(e)))},ze=(e,t,n="")=>{const o={};return Object.entries(e).forEach((([e,i])=>{var a;let s="";s=""===n?e:`${n}/${e}`;const r=null!==(a=t.find((e=>e.categoryName===s)))&&void 0!==a?a:{};if(0!==Object.keys(r).length){const n=[];Object.entries(r.nodeTypes).forEach((([e,t])=>{t.isCategory&&n.push(e)}));const a=Object.keys(r.nodeTypes),l={categoryName:r.categoryName,nodeTypes:{}};let d;a.forEach((e=>{n.includes(e)?d=r.nodeTypes[e]:l.nodeTypes[e]=r.nodeTypes[e]})),o[e]={subcategories:ze(i,t,s),nodes:l,categoryNode:d,hitSubstring:e,mask:!0}}else o[e]={subcategories:ze(i,t,s),nodes:{},categoryNode:void 0,hitSubstring:e,mask:!0}})),o},qe=(e,t,n)=>Object.entries(e).map((([e,o])=>{var i;let a=!1;const s=u().single(t,e);null!==s&&s.score>-50?(o.hitSubstring=null!==(i=u().highlight(s,"<span>","</span>"))&&void 0!==i?i:"",a=!0):o.hitSubstring=e;let r=!1;return void 0!==o.nodes.nodeTypes&&0!==Object.keys(o.nodes.nodeTypes).length&&(r=Object.values(o.nodes.nodeTypes).map((e=>{var o;const i=u().single(t,e.title);return e.mask=null!==i&&i.score>-50||a||n,e.hitSubstring=null!==i?null!==(o=u().highlight(i,"<span>","</span>"))&&void 0!==o?o:"":e.title,e.mask})).includes(!0)),o.mask=qe(o.subcategories,t,a||n)||a||r||n,o.mask})).includes(!0);let Je;const Ze=[M.dH],et=(0,o.pM)({components:{Arrow:Re.A,LinkMenu:Ge,VerticalEllipsis:Xe.A,Cross:Be.A},props:{nodeTree:{required:!0},onDragStart:{required:!0},depth:{type:Number,default:0},defaultCollapse:{type:Boolean,default:!0},tooltip:{required:!1},nodeSearch:{type:String,required:!0}},data:()=>({DOMPurify:v()}),setup(e){const{viewModel:t}=(0,l.if)(),n=e=>void 0===e.nodes.nodeTypes?0!==Object.keys(e.subcategories).length:0!==Object.keys(e.nodes.nodeTypes).length,i=(0,d.KR)(Array(Object.keys(e.nodeTree.subcategories??{}).length).fill(!e.defaultCollapse));let a=i.value;(0,o.wB)((()=>e.nodeTree),(()=>{i.value=Array(Object.keys(e.nodeTree.subcategories??{}).length).fill(!e.defaultCollapse)})),(0,o.wB)((()=>e.nodeSearch),((t,n)=>{""!==t&&""===n?(a=i.value,i.value=Array(Object.keys(e.nodeTree.subcategories??{}).length).fill(!0)):""===t&&""!==n&&(i.value=a)}));const s=(0,o.WQ)("menu"),r=M.Ay.getEditorManagerInstance(),c=(0,o.EW)((()=>r.specificationLoaded.value)),u=e=>Ze.includes(e);return{padding:(e,t=!1)=>t?"padding-left: 0":`padding-left: ${10+30*e}px`,mask:i,onMouseDown:e=>{i.value.splice(e,1,!i.value[e])},getRotation:e=>i.value[e]?"left":"right",sortedEntries:(e,t=!1)=>Object.entries(e).sort((([e,o],[i,a])=>{if(t){if(n(o)&&!n(a))return 1;if(!n(o)&&n(a))return-1}return e.toLowerCase().localeCompare(i.toLowerCase())})),getIconPath:e=>t.value.cache[`./${e}`]??e,isCategoryNode:e=>void 0!==e?.categoryNode,notEmptyCategory:n,showMenu:s,showMenuClick:e=>{s.value=s.value.hitSubstring!==e.hitSubstring&&e},closeMenu:()=>{s.value&&(s.value=!1)},specificationLoaded:c,nodeEntryClasses:e=>({__entry:!0,"__node-entry":!0,"__top-level-node-entry":u(e)}),isTopLevelNode:u}}}),tt=(0,N.A)(et,[["render",function(e,t,n,s,r,l){const d=(0,o.g2)("Cross"),c=(0,o.g2)("VerticalEllipsis"),u=(0,o.g2)("LinkMenu"),p=(0,o.g2)("Arrow"),h=(0,o.g2)("PaletteCategory",!0),v=(0,o.gN)("click-outside");return(0,o.uX)(),(0,o.CE)(o.FK,null,[(0,o.bo)((0,o.Lk)("div",null,[e.nodeTree.nodes.nodeTypes?((0,o.uX)(),(0,o.CE)("div",me,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.sortedEntries(e.nodeTree.nodes.nodeTypes),(([n,s])=>(0,o.bo)(((0,o.uX)(),(0,o.CE)("div",{style:(0,i.Tr)([{width:"100%"},e.padding(e.depth)]),class:(0,i.C4)(e.nodeEntryClasses(n)),key:n},[(0,o.Lk)("div",{onPointerdown:t=>e.onDragStart(n,s,s.iconPath),class:(0,i.C4)(e.nodeEntryClasses(n))},[e.isTopLevelNode(n)?((0,o.uX)(),(0,o.Wv)(d,{key:1,color:"white",rotate:45,class:"__title-icon"})):((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[void 0!==s.iconPath?((0,o.uX)(),(0,o.CE)("img",{key:0,class:"__title-icon",src:e.getIconPath(s.iconPath),draggable:"false"},null,8,Ee)):(0,o.Q3)("",!0)],64)),(0,o.Lk)("div",{class:"__title-label",innerHTML:e.DOMPurify.sanitize(s.hitSubstring)},null,8,we)],42,be),0!==s.URLs.length?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"__vertical_ellipsis",ref_for:!0,ref:"settings",role:"button",onPointerdown:t[0]||(t[0]=(0,a.D$)((()=>{}),["stop"])),onClick:(0,a.D$)((()=>e.showMenuClick(s)),["stop"])},[(0,o.bF)(c,{class:"smaller_svg"})],40,Ce)):(0,o.Q3)("",!0),(0,o.Lk)("div",_e,[!1!==e.showMenu&&e.showMenu.hitSubstring===s.hitSubstring?(0,o.bo)(((0,o.uX)(),(0,o.Wv)(u,{key:0,node:e.showMenu,style:{width:"18em"}},null,8,["node"])),[[v,e.closeMenu]]):(0,o.Q3)("",!0)])],6)),[[a.aG,s.mask]]))),128))])):(0,o.Q3)("",!0)],512),[[a.aG,e.nodeTree.mask]]),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.sortedEntries(e.nodeTree.subcategories,!0),(([n,s],r)=>(0,o.bo)(((0,o.uX)(),(0,o.CE)("div",{key:n},[e.notEmptyCategory(s)?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.Lk)("div",{class:"__entry __category",onClick:t=>e.onMouseDown(r),style:(0,i.Tr)(e.padding(e.depth))},[(0,o.bF)(p,{rotate:e.getRotation(r),scale:"small"},null,8,["rotate"]),e.isCategoryNode(s)?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.bo)(((0,o.uX)(),(0,o.CE)("div",{class:"__entry __node-entry",key:s.title,onClick:t=>e.onMouseDown(r),onPointerdown:t=>e.onDragStart(s.title,s.categoryNode,s.iconPath)},[void 0!==s.categoryNode.iconPath?((0,o.uX)(),(0,o.CE)("img",{key:0,class:"__title-icon",src:e.getIconPath(s.categoryNode.iconPath),draggable:"false"},null,8,Ne)):(0,o.Q3)("",!0),(0,o.Lk)("div",{class:"__title-label",innerHTML:e.DOMPurify.sanitize(s.hitSubstring)},null,8,Pe),0!==s.categoryNode.URLs.length?((0,o.uX)(),(0,o.CE)("div",{key:1,class:"__vertical_ellipsis",ref_for:!0,ref:"settings",role:"button",onPointerdown:t[1]||(t[1]=(0,a.D$)((()=>{}),["stop"])),onClick:(0,a.D$)((()=>e.showMenuClick(s)),["stop"])},[(0,o.bF)(c,{class:"smaller_svg"})],40,Ae)):(0,o.Q3)("",!0)],40,xe)),[[a.aG,s.mask]]),(0,o.Lk)("div",Ie,[!1!==e.showMenu&&e.showMenu.hitSubstring===s.hitSubstring?(0,o.bo)(((0,o.uX)(),(0,o.Wv)(u,{key:0,node:e.showMenu.categoryNode,style:{width:"18em"}},null,8,["node"])),[[v,e.closeMenu]]):(0,o.Q3)("",!0)])],64)):((0,o.uX)(),(0,o.CE)("div",{key:1,class:"__title",innerHTML:e.DOMPurify.sanitize(s.hitSubstring)},null,8,Le))],12,ke),(0,o.bo)((0,o.Lk)("div",null,[(0,o.bF)(h,{nodeTree:s,onDragStart:e.onDragStart,depth:e.depth+1,defaultCollapse:e.defaultCollapse,tooltip:e.tooltip,nodeSearch:e.nodeSearch},null,8,["nodeTree","onDragStart","depth","defaultCollapse","tooltip","nodeSearch"])],512),[[a.aG,e.mask[r]]])],64)):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[e.isCategoryNode(s)?(0,o.bo)(((0,o.uX)(),(0,o.CE)("div",{class:(0,i.C4)(e.nodeEntryClasses(s.title)),style:(0,i.Tr)(e.padding(e.depth)),key:s.title,onPointerdown:t=>e.onDragStart(s.title,s.categoryNode,s.iconPath)},[void 0!==s.categoryNode.iconPath?((0,o.uX)(),(0,o.CE)("img",{key:0,class:"__title-icon",src:e.getIconPath(s.categoryNode.iconPath),draggable:"false"},null,8,Se)):(0,o.Q3)("",!0),(0,o.Lk)("div",{class:"__title-label",innerHTML:e.DOMPurify.sanitize(s.hitSubstring)},null,8,Me),0!==s.categoryNode.URLs.length?((0,o.uX)(),(0,o.CE)("div",{key:1,class:"__vertical_ellipsis",ref_for:!0,ref:"settings",role:"button",onPointerdown:t[2]||(t[2]=(0,a.D$)((()=>{}),["stop"])),onClick:(0,a.D$)((()=>e.showMenuClick(s)),["stop"])},[(0,o.bF)(c,{class:"smaller_svg"})],40,We)):(0,o.Q3)("",!0),(0,o.Lk)("div",De,[!1!==e.showMenu&&e.showMenu.hitSubstring===s.hitSubstring?(0,o.bo)(((0,o.uX)(),(0,o.Wv)(u,{key:0,node:e.showMenu.categoryNode,style:{width:"18em"}},null,8,["node"])),[[v,e.closeMenu]]):(0,o.Q3)("",!0)])],46,Te)),[[a.aG,s.mask]]):((0,o.uX)(),(0,o.CE)("div",Oe,(0,i.v_)(s.hitSubstring),1))],64))])),[[a.aG,s.mask]]))),128))],64)}]]),nt=["src"],ot=["innerHTML"],it=(0,o.pM)({props:{title:{type:String,required:!0},iconPath:{type:String,required:!1},depth:{type:Number,required:!0}},setup(e){const{viewModel:t}=(0,l.if)(),n=e=>t.value.cache[`./${e}`]??e;return{nodeIcon:(0,o.EW)((()=>n(e.iconPath))),padding:(0,o.EW)((()=>`padding-left: ${10+20*e.depth}px`)),getIconPath:n}},computed:{titleSanitized(){return v().sanitize(this.title)}}}),at=(0,N.A)(it,[["render",function(e,t,n,a,s,r){return(0,o.uX)(),(0,o.CE)("div",{class:"__entry __node-entry __dragged",style:(0,i.Tr)(e.padding)},[void 0!==e.nodeIcon?((0,o.uX)(),(0,o.CE)("img",{key:0,class:"__title-icon",src:e.nodeIcon,draggable:"false"},null,8,nt)):(0,o.Q3)("",!0),(0,o.Lk)("div",{class:"__title-label",innerHTML:e.titleSanitized},null,8,ot)],4)}],["__scopeId","data-v-3395bfa5"]]);var st=n(73218),rt=n(53612);const lt=(0,o.pM)({components:{PaletteCategory:tt,PaletteEntry:at,Tooltip:st.A,Magnifier:rt.A},setup(){const{viewModel:e}=(0,l.if)(),{x:t,y:n}=(0,ye.RcE)(),{transform:i}=(0,l.Gy)(),a=(0,d.KR)(null),s=(0,o.WQ)("editorEl"),r=(0,d.KR)(null),c=(0,d.KR)(null);c.value={top:0,left:0,visible:!1,text:""};const u=(0,o.EW)((()=>{if(!r.value||!s?.value)return{};const{left:e,top:o}=s.value.getBoundingClientRect();return{top:n.value-o+"px",left:t.value-e+"px"}})),p=o=>{if(!document.elementsFromPoint(o.clientX,o.clientY).includes(a.value)){const o=new r.value.nodeInformation.type;e.value.displayedGraph.addNode(o);const a=s.value.getBoundingClientRect(),[l,d]=i(t.value-a.left,n.value-a.top);o.position.x=l,o.position.y=d,r.value=null,document.removeEventListener("pointerup",p),document.removeEventListener("keydown",h)}},h=e=>{"Escape"===e.key&&(r.value=null,document.removeEventListener("pointerup",p),document.removeEventListener("keydown",h))},v=(0,d.KR)(""),g=(0,d.KR)(0),f=(0,d.KR)(!1);(0,o.Gt)("menu",f);const y=(0,o.EW)((()=>function(e){const{viewModel:t}=(0,l.if)(),{editor:n}=t.value,i=Array.from(n.nodeTypes.entries()),a=new Set(i.map((([,e])=>e.category))),s={categoryName:"TopLevel",nodeTypes:{}},r=[];a.forEach((e=>{let t=i.filter((([,t])=>t.category===e));const o=Object.fromEntries(t.map((e=>{const[t]=e;return[t,n.getNodeURLs(t)]}))),a=Object.fromEntries(t.map((e=>{const[t]=e;return[t,n.getNodeIconPath(t)]}))),l=t.filter((([e,t])=>Ze.includes(e)));if(t=t.filter((([e,t])=>!Ze.includes(e))),t.length>0){const n=t.map((([e,t])=>[e,Object.assign(Object.assign({},t),{isCategory:t.isCategory,mask:!0,hitSubstring:t.title,iconPath:a[e],URLs:o[e]})]));r.push({categoryName:e,nodeTypes:Object.fromEntries(n)})}l.forEach((([e,t])=>{s.nodeTypes[e]=Object.assign(Object.assign({},t),{isCategory:t.isCategory,mask:!0,hitSubstring:t.title,iconPath:a[e],URLs:o[e]})}))}));const d=new Set(r.map((e=>e.categoryName))),c=Ve(d),u=ze(c,r);Je&&Je();const p={subcategories:u,nodes:s,categoryNode:void 0,hitSubstring:"TopLevel",mask:!0},h={All:p};return Je=(0,o.wB)(e,(e=>{""===e?(Object.entries(h).forEach((e=>Qe(e))),Object.values(h).forEach((e=>Ye(e)))):qe(h,e.toLowerCase(),!1)})),p}(v))),m=(0,o.EW)((()=>e.value.collapseSidebar));return(0,o.sV)((()=>{(0,o.EW)((()=>document.querySelector(".nodes"))).value.addEventListener("scroll",(e=>{g.value=e.target.scrollTop;const t=document.getElementsByClassName("__icondiv");for(let e=0;e<t.length;e+=1)t[e].style.translate=`0px -${g.value.toString()}px`}))})),{draggedNodeStyles:u,draggedNode:r,onDragStart:(e,t,n)=>{r.value={type:e,nodeInformation:t,iconPath:n},document.addEventListener("pointerup",p),document.addEventListener("keydown",h)},nodeTree:y,collapse:m,tooltip:c,nodeSearch:v,paletteRef:a,scroll:g}}}),dt=(0,N.A)(lt,[["render",function(e,t,n,s,r,l){const d=(0,o.g2)("Magnifier"),c=(0,o.g2)("PaletteCategory"),u=(0,o.g2)("Tooltip"),p=(0,o.g2)("PaletteEntry");return(0,o.uX)(),(0,o.CE)(o.FK,null,[(0,o.Lk)("div",{ref:"paletteRef",class:(0,i.C4)(["baklava-node-palette",{"hidden-navbar":e.$isMobile}])},[(0,o.Lk)("div",he,[ve,(0,o.Lk)("div",ge,[(0,o.bF)(d,{color:"gray"}),(0,o.bo)((0,o.Lk)("input",{class:"node-search","onUpdate:modelValue":t[0]||(t[0]=t=>e.nodeSearch=t),placeholder:"Search"},null,512),[[a.Jo,e.nodeSearch]])])]),(0,o.Lk)("div",fe,[(0,o.bF)(c,{nodeTree:e.nodeTree,onDragStart:e.onDragStart,defaultCollapse:e.collapse,tooltip:e.tooltip,nodeSearch:e.nodeSearch},null,8,["nodeTree","onDragStart","defaultCollapse","tooltip","nodeSearch"])]),(0,o.bo)((0,o.bF)(u,{text:e.tooltip.text,left:e.tooltip.left,top:e.tooltip.top-60},null,8,["text","left","top"]),[[a.aG,e.tooltip.visible]])],2),(0,o.bF)(a.eB,{name:"fade"},{default:(0,o.k6)((()=>[e.draggedNode?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"baklava-dragged-node",style:(0,i.Tr)(e.draggedNodeStyles)},[(0,o.bF)(p,{title:e.draggedNode.nodeInformation.title,iconPath:e.draggedNode.iconPath,isDragged:!0,depth:0},null,8,["title","iconPath"])],4)):(0,o.Q3)("",!0)])),_:1})],64)}]]),ct=[(0,o.Lk)("div",{class:"rectangle-selection"},null,-1)],ut=(0,o.pM)({setup(){const e=(0,d.KR)(!1),t=(0,d.KR)({x:0,y:0}),n=(0,d.KR)({x:0,y:0}),i=(0,o.EW)((()=>({xBegin:t?.value.x<n?.value.x?t?.value.x:n?.value.x,yBegin:t?.value.y<n?.value.y?t?.value.y:n?.value.y,xEnd:t?.value.x>=n?.value.x?t?.value.x:n?.value.x,yEnd:t?.value.y>=n?.value.y?t?.value.y:n?.value.y})));return{styles:(0,o.EW)((()=>({position:"absolute",visibility:e.value?"visible":"hidden",top:`${i.value.yBegin}px`,left:`${i.value.xBegin}px`,width:`${Math.abs(i.value.xEnd-i.value.xBegin)??0}px`,height:`${Math.abs(i.value.yEnd-i.value.yBegin)??0}px`}))),onPointerDown:o=>{e.value=!0,t.value={x:o.pageX,y:o.pageY},n.value={x:o.pageX,y:o.pageY}},onPointerMove:t=>{e.value&&(n.value={x:t.pageX,y:t.pageY})},onPointerUp:()=>{e.value=!1,t.value={x:0,y:0},n.value={x:0,y:0}},selecting:e,boundingRect:i}}}),pt=(0,N.A)(ut,[["render",function(e,t,n,a,s,r){return(0,o.uX)(),(0,o.CE)("div",{class:"rectangle-selection-border",style:(0,i.Tr)(e.styles)},ct,4)}]]);function ht(e,t,n){const o=document.getElementById(t.id),i=n,a=e.panning.x,s=e.panning.y,{scaling:r}=e,l=r*(a+t.position.x),d=r*(s+t.position.y+60),c=o.offsetWidth,u=o.offsetHeight;return l+.09999999999999998*l>i.xBegin&&l+c*r-.09999999999999998*l<i.xEnd&&d+.09999999999999998*d>i.yBegin&&d+u*r-.09999999999999998*d<i.yEnd}const vt=(0,o.pM)({extends:l.xn,components:{CustomNode:q,PipelineManagerConnection:ce,TemporaryConnection:pe,NodePalette:dt,RectangleSelection:pt},emits:["loadFinish"],setup(e,{emit:t}){const{el:i,counter:a,nodes:s,connections:c,selectedNodes:h,nodeContainerStyle:v,keyDown:g,keyUp:f}=l.xn.setup(e),y=(0,d.KR)([]),{graph:m}=(0,l.uU)(),b=function(){const{graph:e}=(0,l.uU)();let t=[],n=-1,i={x:0,y:0};const a=(0,o.EW)((()=>e.value.panning)),s=(0,p.A)(a),r=(t,n,o)=>{if(o<=0)return;const i=[t/e.value.scaling-e.value.panning.x,n/e.value.scaling-e.value.panning.y],a=[t/o-e.value.panning.x,n/o-e.value.panning.y],s=[a[0]-i[0],a[1]-i[1]],r=window.innerHeight,l=window.innerWidth;(2*e.value.size().graphWidth>l/o||2*e.value.size().graphHeight>r/o||o>e.value.scaling&&e.value.size().graphHeight!==-1/0)&&(e.value.scaling=o,e.value.panning.x+=s[0],e.value.panning.y+=s[1])},d=()=>({ax:t[0].clientX,ay:t[0].clientY,bx:t[1].clientX,by:t[1].clientY});return{...s,onPointerDown:e=>{if(s.onPointerDown(e),t.length<=1&&t.push(e),2===t.length){const{ax:e,ay:t,bx:o,by:a}=d(),s=e-o,r=t-a;n=Math.sqrt(s*s+r*r),i={x:e+(o-e)/2,y:t+(a-t)/2}}},onPointerMove:o=>{if(2===t.length){for(let e=0;e<t.length;e+=1)if(o.pointerId===t[e].pointerId){t[e]=o;break}const{ax:a,ay:s,bx:l,by:c}=d(),u=a-l,p=s-c,h=Math.sqrt(u*u+p*p);if(n>0){const t=e.value.scaling*(1+(h-n)/500);r(i.x,i.y,t)}n=h}else s.onPointerMove(o)},onPointerUp:e=>{s.onPointerUp(),t=t.filter((t=>t.pointerId!==e.pointerId)),n=-1},onMouseWheel:t=>{t.preventDefault();let n=t.deltaY;1===t.deltaMode&&(n*=32);const o=Math.min(e.value.scaling*(1-n/3e3),1.5);r(t.clientX,t.clientY,o)}}}(),E=function(){const{graph:e}=(0,l.uU)(),t=(0,d.KR)(null),n=(0,d.KR)(null);let i=null;return(0,o.Gt)("hoveredOver",(o=>{if(n.value=o??null,o&&t.value){t.value.to=o;const n=e.value.checkConnection(t.value.from,t.value.to);if(t.value.status=n.connectionAllowed?1:2,n.connectionAllowed){const t=n.connectionsInDanger.map((e=>e.id));e.value.connections.forEach((e=>{t.includes(e.id)&&(e.isInDanger=!0)}))}}else!o&&t.value&&(t.value.to=void 0,t.value.status=0,e.value.connections.forEach((e=>{e.isInDanger=!1})))})),{temporaryConnection:t,onMouseMove:n=>{if(t.value)if("touch"===n.pointerType){const o=document.elementFromPoint(n.clientX,n.clientY);i&&i!==o&&(i.dispatchEvent(new PointerEvent("pointerout")),i=null),o&&o.classList.contains("__port")&&(o.dispatchEvent(new PointerEvent("pointerover")),i=o),t.value.mx=n.clientX/e.value.scaling-e.value.panning.x,t.value.my=n.clientY/e.value.scaling-e.value.panning.y}else t.value.mx=n.offsetX/e.value.scaling-e.value.panning.x,t.value.my=n.offsetY/e.value.scaling-e.value.panning.y},onMouseDown:e=>{i=e.target,n.value&&(t.value={status:0,from:n.value,to:n.value},t.value.mx=void 0,t.value.my=void 0)},onMouseUp:()=>{t.value&&n.value&&e.value.addConnection(t.value.from,t.value.to),t.value=null}}}(),w=M.Ay.getEditorManagerInstance(),C=(0,d.KR)([]),_=(0,d.KR)([]),k=(0,o.EW)((()=>e.viewModel.editor.readonly)),x=(0,o.EW)((()=>e.viewModel.editor.hideHud)),N=(0,d.KR)(null),P=[],A=(0,o.EW)((()=>m.value.scaling)),I=(0,o.EW)((()=>e.viewModel.editor.searchQuery)),L=(0,d.KR)([]);let T=0;const S=(0,o.EW)((()=>({"--scale":A.value,cursor:b.dragging.value?"move":"default"}))),O=()=>{e.viewModel.displayedGraph.selectedNodes=[]},R=()=>{m.value.nodes.forEach((e=>{if(m.value.selectedNodes.includes(e))return;const t=N.value.boundingRect;ht(m.value,e,t)&&m.value.selectedNodes.push(e)}))};let X=0;const $=e=>{b.onPointerMove(e),E.onMouseMove(e),N.value.onPointerMove(e),N.value.selecting&&(m.value.selectedNodes=[],m.value.nodes.forEach((e=>{const t=N.value.boundingRect;ht(m.value,e,t)&&m.value.selectedNodes.push(e)})))},j=e=>{b.onPointerUp(e),E.onMouseUp(),new Date-T<100&&e.target===i.value&&O(),1===X&&(document.removeEventListener("pointerup",j),document.removeEventListener("pointermove",$)),X-=1},K=e=>{new Date-T>=100&&e.target===i.value&&R(),N.value.onPointerUp(),document.removeEventListener("pointerup",K),document.removeEventListener("pointermove",$)},H=()=>{m.value.selectedNodes=P.value,R(),N.value.onPointerUp(),document.removeEventListener("pointerup",H),document.removeEventListener("pointermove",$)};document.addEventListener("pointerdown",(e=>{0!==e.button||e.shiftKey||((e=>{X+=1,e.target===i.value&&b.onPointerDown(e),E.onMouseDown(e),T=new Date})(e),document.addEventListener("pointerup",j),document.addEventListener("pointermove",$)),k.value||(2===e.button&&e.ctrlKey?((e=>{N.value.onPointerDown(e),P.value=m.value.selectedNodes})(e),document.addEventListener("pointerup",H),document.addEventListener("pointermove",$)):2===e.button&&((e=>{e.target===i.value&&(O(),N.value.onPointerDown(e)),T=new Date})(e),document.addEventListener("pointerup",K),document.addEventListener("pointermove",$)))}));const U=()=>{C.value.splice(0,C.value.length)};(0,o.wB)(c.value,(()=>{U()})),(0,o.wB)(E?.temporaryConnection,(()=>{if(void 0!==(E??null)&&null!==E?.temporaryConnection)if(E?.temporaryConnection?.value?.from)for(let e=0;e<s.value.length;e+=1)[...Object.values(s.value[e].outputs)||[],...Object.values(s.value[e].inputs)||[]].forEach((e=>{var t;e.port&&e!==E.temporaryConnection.value.from&&(m.value.checkConnection(E.temporaryConnection.value.from,e).connectionAllowed||(t=e,_.value.includes(t)||_.value.push(t)))}));else _.value.splice(0,_.value.length)}));const F=(0,o.EW)((()=>e.viewModel.ignoredLayers)),G=(0,o.EW)((()=>e.viewModel.layers)),B=(0,o.EW)((()=>{const e=new Set;return G.value.forEach((t=>{t.nodeInterfaces&&F.value.has(t.name)&&t.nodeInterfaces.forEach(e.add,e)})),e})),V=(0,o.EW)((()=>{const e=new Set;return G.value.forEach((t=>{t.nodeLayers&&F.value.has(t.name)&&t.nodeLayers.forEach(e.add,e)})),e})),Q=(0,o.EW)((()=>s.value.filter((e=>!V.value.has(e.layer))))),Y=(0,o.EW)((()=>s.value.filter((e=>V.value.has(e.layer))))),z=(0,o.EW)((()=>Y.value.map((e=>e.id)))),q=(0,o.EW)((()=>c.value.filter((e=>!(e.from.type?.some((e=>B.value.has(e)))||e.to.type?.some((e=>B.value.has(e)))||z.value.includes(e.from.nodeId)||z.value.includes(e.to.nodeId)))))),J=(0,D.A)();J.backendAvailable&&((0,o.wB)(Q,(async(e,t)=>{if(!w.notifyWhenChanged)return;const n=Object.values(e).map((e=>e.id)),o=Object.values(t).map((e=>e.id)),i=[];Object.values(e).forEach((e=>{o.includes(e.id)||i.push(e.save())}));const a=[];Object.values(t).forEach((e=>{n.includes(e.id)||a.push(e.id)}));const s={graph_id:m.value.id,nodes:{added:i,deleted:a}};await J.notifyAboutChange("nodes_on_change",s)})),(0,o.wB)(q,(async(e,t)=>{if(!w.notifyWhenChanged)return;const n=Object.values(e).map((e=>e.id)),o=Object.values(t).map((e=>e.id)),i=[];Object.values(e).forEach((e=>{o.includes(e.id)||i.push({id:e.id,from:e.from.id,to:e.to.id})}));const a=[];Object.values(t).forEach((e=>{n.includes(e.id)||a.push({from:e.from.id,to:e.to.id})}));const s={graph_id:m.value.id,connections:{added:i,deleted:a}};await J.notifyAboutChange("connections_on_change",s)})));const Z=(0,o.EW)((()=>s.value.map((e=>e.title))));(0,o.wB)([I,Z],(()=>{if(void 0===I.value||""===I.value)return L.value=[],void Q.value.forEach((e=>{e.highlightedTitle=e.title,e.highlightedType=e.type}));const e=(t=I.value,Q.value.filter((e=>{let{type:n}=e;const o=n.startsWith(r.cO);o&&(n=n.slice(r.cO.length));const i=u().single(t,e.title),a=u().single(t,n);return null!==i&&i.score>-50||null!==a&&a.score>-50?(e.highlightedTitle=u().highlight(i,"<span>","</span>"),e.highlightedType=u().highlight(a,"<span>","</span>"),!o||""===e.title||null!==i):(e.highlightedTitle=e.title,e.highlightedType=e.type,!1)})));var t;const n=Q.value.filter((t=>!e.includes(t)));L.value=n}));const ee=void 0!=={NODE_ENV:"production",VUE_APP_STATIC:"true",VUE_APP_VERBOSE:"false",VUE_APP_GRAPH_DEVELOPMENT_MODE:"false",BASE_URL:""}.VUE_APP_SPECIFICATION_PATH,te=void 0!=={NODE_ENV:"production",VUE_APP_STATIC:"true",VUE_APP_VERBOSE:"false",VUE_APP_GRAPH_DEVELOPMENT_MODE:"false",BASE_URL:""}.VUE_APP_DATAFLOW_PATH;async function ne(e){let t,n=M.Ay.validateSpecification(e);return n.length?(W.A.terminalLog("error","Specification is invalid",n),n):(({errors:n,warnings:t}=await w.updateEditorSpecification(e)),Array.isArray(t)&&t.length&&W.A.terminalLog("warning","Issue when loading specification",t),Array.isArray(n)&&n.length&&W.A.terminalLog("error","Specification is invalid",n),n)}async function oe(e){const t=await w.loadDataflow(e),{errors:n}=t,{warnings:o}=t;if(Array.isArray(o)&&o.length&&W.A.terminalLog("warning","Issue when loading dataflow",o),Array.isArray(n)&&n.length){const e="Dataflow is invalid";W.A.terminalLog("error",e,n)}return n}return(0,o.sV)((async()=>{window.addEventListener("message",(async e=>{"specification"===e.data.type?await ne(e.data.content):"dataflow"===e.data.type?await oe(e.data.content):W.A.terminalLog("error","Message type is invalid")})),W.A.setShowNotification(!1),w.updateMetadata({});const o=window.location.search.replace(/&amp;/g,"&"),i=new URLSearchParams(o);if(i.has("preview")){const t="true"===i.get("preview");e.viewModel.editor.preview=t}let a;if(ee)a=n(63359)({NODE_ENV:"production",VUE_APP_STATIC:"true",VUE_APP_VERBOSE:"false",VUE_APP_GRAPH_DEVELOPMENT_MODE:"false",BASE_URL:""}.VUE_APP_SPECIFICATION_PATH);else if(i.has("spec")){const[e,t]=await(0,M.sA)(i.get("spec"));!1===e?(W.A.terminalLog("error",t),W.A.terminalLog("error",`Failed to load the specification file from: ${i.get("spec")}`)):a=t}if(void 0!==a){if(i.has("include")&&(void 0===a.include&&(a.include=[]),a.include.push(i.get("include"))),(await ne(a)).length)return W.A.restoreShowNotification(),void t("loadFinish");let e;if(te)e=n(63359)({NODE_ENV:"production",VUE_APP_STATIC:"true",VUE_APP_VERBOSE:"false",VUE_APP_GRAPH_DEVELOPMENT_MODE:"false",BASE_URL:""}.VUE_APP_DATAFLOW_PATH);else if(i.has("graph")){const[t,n]=await(0,M.sA)(i.get("graph"));!1===t?(W.A.terminalLog("error",n),W.A.terminalLog("error",`Failed to load the graph file from: ${i.get("graph")}`)):e=n}e&&await oe(e)}W.A.restoreShowNotification(),t("loadFinish")})),{el:i,counter:a,selectedNodes:h,nodeContainerStyle:v,onRightPointerUp:K,onDrop:async e=>{e.preventDefault(),e.dataTransfer.dropEffect="copy";const t=[];e.dataTransfer.items?[...e.dataTransfer.items].filter((e=>"file"===e.kind)).forEach((e=>t.push(e.getAsFile()))):t.push(...e.dataTransfer.files),t.length>1&&W.A.showToast("warning","More than one file dropped, processing only the first one");const n=new FileReader;n.addEventListener("load",(async e=>{const t=e.target.result;let n;try{n=JSON.parse(t)}catch(e){return void W.A.showToast("error","Dropped file is not in JSON format")}n.nodes?await ne(n):n.graphs?await oe(n):W.A.showToast("error","File is neither specification nor dataflow")})),n.onerror=e=>W.A.terminalLog("error","File cannot be loaded",e.message),n.readAsText(t[0])},nodes:s,keyDown:g,keyUp:f,selectNode:(t,n)=>{(n&&!n.ctrlKey||!n&&!e.viewModel.commandHandler.pressedKeys.includes("Control"))&&O(),e.viewModel.displayedGraph.selectedNodes.push(t)},rectangleSelection:N,greyedOutNodes:L,temporaryConnection:E.temporaryConnection,mouseWheel:b.onMouseWheel,dragging:b.dragging,changeHoveredConnections:e=>{const t=document.elementsFromPoint(e.clientX,e.clientY),n=y.value.filter((e=>e.containsPoint(t))),o=c.value.filter((e=>n.filter((t=>t.connection===e)).length>0)),i=c.value.filter((e=>o.filter((t=>t.from===e.from)).length>0));c.value.forEach((e=>{var t;i.includes(e)?(t=e,C.value.includes(t)||C.value.push(t)):(e=>{const t=C.value.indexOf(e);t>=0&&C.value.splice(t,1)})(e)}))},highlightConnections:C,connRefs:y,clearHighlight:U,readonly:k,hideHud:x,scale:A,visibleConnections:q,visibleNodes:Q,highlightInterfaces:_,editorStyle:S}}}),gt=(0,N.A)(vt,[["render",function(e,t,n,r,l,d){const c=(0,o.g2)("background"),u=(0,o.g2)("NodePalette"),p=(0,o.g2)("CustomNode"),h=(0,o.g2)("PipelineManagerConnection"),v=(0,o.g2)("TemporaryConnection"),g=(0,o.g2)("RectangleSelection");return(0,o.uX)(),(0,o.CE)("div",{ref:"el",tabindex:"-1",class:(0,i.C4)(["baklava-editor",{"baklava-ignore-mouse":!!e.temporaryConnection||e.dragging,"--temporary-connection":!!e.temporaryConnection}]),style:(0,i.Tr)(e.editorStyle),onWheel:t[5]||(t[5]=(0,a.D$)(((...t)=>e.mouseWheel&&e.mouseWheel(...t)),["self"])),onKeydown:t[6]||(t[6]=(...t)=>e.keyDown&&e.keyDown(...t)),onKeyup:t[7]||(t[7]=(...t)=>e.keyUp&&e.keyUp(...t)),onMouseleave:t[8]||(t[8]=t=>!e.readonly&&e.onRightPointerUp),onDrop:t[9]||(t[9]=(0,a.D$)((t=>!e.readonly&&e.onDrop(t)),["prevent"])),onDragenter:t[10]||(t[10]=(0,a.D$)((()=>{}),["prevent"])),onDragover:t[11]||(t[11]=(0,a.D$)((()=>{}),["prevent"])),oncontextmenu:"return false;"},[(0,o.RG)(e.$slots,"background",{},(()=>[(0,o.bF)(c)])),e.readonly||e.hideHud?(0,o.Q3)("",!0):(0,o.RG)(e.$slots,"palette",{key:0},(()=>[(0,o.bF)(u)])),(0,o.Lk)("div",{class:"node-container",style:(0,i.Tr)(e.nodeContainerStyle),onWheel:t[0]||(t[0]=(...t)=>e.mouseWheel&&e.mouseWheel(...t))},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.visibleNodes,(t=>((0,o.uX)(),(0,o.Wv)(p,{key:t.id+e.counter.toString(),node:t,selected:e.selectedNodes.includes(t),greyedOut:e.greyedOutNodes.includes(t),interfaces:e.highlightInterfaces,onSelect:n=>e.selectNode(t,n)},null,8,["node","selected","greyedOut","interfaces","onSelect"])))),128))],36),((0,o.uX)(),(0,o.CE)("svg",{class:"connections-container",onMouseenter:t[1]||(t[1]=(...t)=>e.changeHoveredConnections&&e.changeHoveredConnections(...t)),onMousemove:t[2]||(t[2]=(...t)=>e.changeHoveredConnections&&e.changeHoveredConnections(...t)),onMouseleave:t[3]||(t[3]=(...t)=>e.clearHighlight&&e.clearHighlight(...t)),onWheel:t[4]||(t[4]=(...t)=>e.mouseWheel&&e.mouseWheel(...t))},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.visibleConnections,(t=>((0,o.uX)(),(0,o.Wv)(h,{key:t.id+e.counter.toString(),connection:t,ref_for:!0,ref:"connRefs",isHighlighted:e.highlightConnections.includes(t)},null,8,["connection","isHighlighted"])))),128)),e.temporaryConnection?((0,o.uX)(),(0,o.Wv)(v,{key:0,name:"temporaryConnection","temporary-connection":e.temporaryConnection,connection:e.temporaryConnection},null,8,["temporary-connection","connection"])):(0,o.Q3)("",!0)],32)),(0,o.Lk)("div",s,[(0,o.bF)(g,{ref:"rectangleSelection"},null,512)])],38)}]])},63359:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=63359,e.exports=t},55825:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=55825,e.exports=t},96422:(e,t,n)=>{"use strict";n.d(t,{BW:()=>a,bf:()=>r,q6:()=>s});var o=n(63491),i=n(46171);function a(e){switch(e){case"InputInterface":case"SelectInterface":case"ListInterface":case"TextInterface":case"HexInterface":return!0;default:return!1}}function s(e,t,n,i=void 0,a=!1){const{graph:s}=(0,o.uU)();s.value.editNode(e);const r=t.sidePosition;t.side=n,void 0!==i&&(t.sidePosition=i);const l=[...Object.values(e.inputs),...Object.values(e.outputs)].find((e=>e.id!==t.id&&e.sidePosition===t.sidePosition&&e.side===t.side));if(void 0!==l)if(void 0!==i&&a)l.sidePosition=r;else{const n=void 0===i?t:l,o=[...Object.values(e.inputs),...Object.values(e.outputs)].filter((e=>e.side===n.side&&!e.hidden)).map((e=>e.sidePosition));let a=0;for(;o.includes(a);)a+=1;n.sidePosition=a}}function r(e,t=!1){if(e.type.startsWith(i.cO)&&t){const{viewModel:t}=(0,o.if)();t.value.editor.unwrapSubgraph(e)}else{const{graph:t}=(0,o.uU)();t.value.removeNode(e)}}},35851:(e,t,n)=>{"use strict";n.d(t,{A:()=>g});var o=n(46171),i=n(63491),a=n(50953),s=n(20641),r=n(42302),l=n(34250),d=n(41857),c=n(96422),u=n(97351),p=n(14121),h=n(8239),v=n(57565);class g extends o.KE{preview=!1;_hideHud=!1;get hideHud(){return this._hideHud||this.preview}set hideHud(e){this._hideHud=e}_readonly=!1;get readonly(){return this._readonly||this.preview}set readonly(e){this._readonly=e}allowLoopbacks=!1;nodeIcons=new Map;baseURLs=new Map;baseIconUrls=new Map;nodeURLs=new Map;layoutManager=new u.A;subgraphStack=[];registerGraph(e){const t=function(e){return e.events.addAnchor=new l.Hx,e.events.removeAnchor=new l.Hx,e.events.editNode=new l.Hx,e.graphNode=void 0,e.checkConnection=function(e,t){if(!e||!t)return{connectionAllowed:!1,error:"Invalid from and to references."};const n=this.findNodeById(e.nodeId),i=this.findNodeById(t.nodeId);if(n&&i&&n===i&&!this.editor.allowLoopbacks)return{connectionAllowed:!1,error:"Loopbacks are not allowed."};if("input"===e.direction&&"output"===t.direction||"input"===e.direction&&"inout"===t.direction||"inout"===e.direction&&"output"===t.direction){const n=e;e=t,t=n}if(e.isInput&&"inout"!==e.direction)return{connectionAllowed:!1,error:"Connections are only allowed from output or inout interfaces."};if(!t.isInput)return{connectionAllowed:!1,error:"Connections are only allowed to input or inout interfaces."};if(this.connections.some((n=>n.from===e&&n.to===t)))return{connectionAllowed:!1,error:"Duplicate connections are not allowed."};if(e.maxConnectionsCount>0&&e.connectionCount+1>e.maxConnectionsCount)return{connectionAllowed:!1,error:`Too many connections from an input interface '${e.id}', maximum of '${e.maxConnectionsCount}' are allowed.`};if((0===t.maxConnectionsCount||void 0===t.maxConnectionsCount)&&t.connectionCount>0)return{connectionAllowed:!1,error:`By default only one connection to an input interface '${t.id}' allowed.`};if(t.maxConnectionsCount>0&&t.connectionCount+1>t.maxConnectionsCount)return{connectionAllowed:!1,error:`Too many connections to an output interface '${t.id}', maximum of '${t.maxConnectionsCount}' are allowed.`};if(e.type&&t.type){const n="string"==typeof e.type||e.type instanceof String?[e.type]:e.type,o="string"==typeof t.type||t.type instanceof String?[t.type]:t.type;if(void 0===n.find((e=>o.includes(e))))return{connectionAllowed:!1,error:`No common types between interfaces. Interface '${e.id}' supports types '${n}' and interface '${t.id}' supports types '${o}'.`}}return this.events.checkConnection.emit({from:e,to:t}).prevented?{connectionAllowed:!1,error:`Connection between an input interface '${e.id}' and an output interface '${t.id}' was prevented`}:this.hooks.checkConnection.execute({from:e,to:t}).some((e=>!e.connectionAllowed))?{connectionAllowed:!1,errors:`Connection between an input interface '${e.id}' and an output interface '${t.id}' was prevented`}:{connectionAllowed:!0,dummyConnection:new o.pB(e,t),connectionsInDanger:[]}},e.addAnchor=function(t,n,o){const i={x:t.x,y:t.y,id:(0,r.A)()};void 0===n.anchors&&(n.anchors=[]),n.anchors.splice(o,0,i),e.events.addAnchor.emit([n,3*o+1])},e.replaceNode=function(e,t){const n=e.position,i=new(this.editor.nodeTypes.get(t).type);e.title!==e.type&&(i.title=e.title),Object.entries({...e.inputs,...e.outputs}).forEach((([e,t])=>{void 0!==t.direction?(Object.prototype.hasOwnProperty.call(i.inputs,e)&&(0,c.q6)(i,i.inputs[e],t.side,t.sidePosition),Object.prototype.hasOwnProperty.call(i.outputs,e)&&(0,c.q6)(i,i.outputs[e],t.side,t.sidePosition)):Object.prototype.hasOwnProperty.call(i.inputs,e)&&i.inputs[e].componentName===t.componentName&&(i.inputs[e].value=t.value)}));const a=[...Object.values(e.inputs),...Object.values(e.outputs)],s=this.connections.filter((e=>a.includes(e.from)||a.includes(e.to))),r=[];return Object.entries({...e.inputs,...e.outputs}).forEach((([e,t])=>{void 0!==t.direction&&s.forEach((n=>{if(Object.prototype.hasOwnProperty.call(i.inputs,e))if(n.from===t){const t=new o.Ng(i.inputs[e],n.to);t.anchors=n.anchors,r.push(t)}else if(n.to===t){const t=new o.Ng(n.from,i.inputs[e]);t.anchors=n.anchors,r.push(t)}if(Object.prototype.hasOwnProperty.call(i.outputs,e))if(n.from===t){const t=new o.Ng(i.outputs[e],n.to);t.anchors=n.anchors,r.push(t)}else if(n.to===t){const t=new o.Ng(n.from,i.outputs[e]);t.anchors=n.anchors,r.push(t)}}))})),i.position=n,(0,d.nb)(),this.removeNode(e),this.addNode(i),r.forEach((e=>this.internalAddConnection(e))),(0,d.wH)(),i},e.addNode=function(e){if(!this.events.beforeAddNode.emit(e).prevented){if(this.nodeEvents.addTarget(e.events),this.nodeHooks.addTarget(e.hooks),e.registerGraph(this),void 0!==e.template){const t=JSON.parse(JSON.stringify(e.template.save()));t.id??=(0,r.A)(),e.template=new o.b1(t,this.editor)}return this._nodes.push(e),(e=this.nodes.find((t=>t.id===e.id))).onPlaced(),this.events.addNode.emit(e),e}},e.destroy=function(){},e.load=function(t){const n=[];for(let e=this.connections.length-1;e>=0;e-=1)this.removeConnection(this.connections[e]);for(let e=this.nodes.length-1;e>=0;e-=1)this.removeNode(this.nodes[e]);return this.id=t.id??(0,r.A)(),this.name=t.name??void 0,t.nodes.forEach((e=>{void 0!==e.subgraph&&(e.name=`${o.cO}${e.name}`);const t=this.editor.nodeTypes.get(e.name);if(t){const o=new t.type,i=o.id;this.addNode(o);const a=o.load(e);Array.isArray(a)&&a.length&&n.push(...a),o.id??=i}else n.push(`Node type ${e.name} is not registered`)})),t.connections.forEach((e=>{e.id??=(0,r.A)()})),t.connections.forEach((i=>{const a=this.findNodeInterface(i.from),s=this.findNodeInterface(i.to);if(a)if(a.port)if(s)if(s.port)if(t.connections.some((e=>e.id===i.id&&(e.from!==i.from||e.to!==i.to))))n.push(`Connection of id '${i.id}' invalid. ID is already taken.`);else{const t=this.checkConnection(a,s);if(t.connectionAllowed){t.connectionsInDanger.forEach((e=>{const t=this.connections.find((t=>t.id===e.id));t&&this.removeConnection(t)}));const n=new o.Ng(t.dummyConnection.from,t.dummyConnection.to);i.anchors?.forEach(((t,o)=>{e.addAnchor(t,n,o)})),this.internalAddConnection(n)}else n.push(`Could not create connection of id '${i.id}'. ${t.error}`)}else n.push(`Connection of id '${i.id}' invalid. Destination of the connection is not an Interface`);else n.push(`Connection of id '${i.id}' invalid. Could not find interface with id '${i.to}'`);else n.push(`Connection of id '${i.id}' invalid. Source of the connection is not an Interface`);else n.push(`Connection of id '${i.id}' invalid. Could not find interface with id '${i.from}'`)})),this.hooks.load.execute(t),n},e.size=function(){const e=this.nodes.map((e=>{const t=document.getElementById(e.id);return{width:t.offsetWidth,height:t.offsetHeight,position:e.position}})),t=100,n=Math.max(...e.map((e=>e.position.x+e.width)))+t,o=Math.min(...e.map((e=>e.position.x)))-t,i=Math.max(...e.map((e=>e.position.y+e.height)))+t,a=Math.min(...e.map((e=>e.position.y)))-t;return{graphHeight:i-a,graphWidth:n-o,rightmostX:n,leftmostX:o,bottommostY:i,topmostY:a}},e.save=function(){const e={id:this.id,name:this.name,nodes:this.nodes.map((e=>e.save())),connections:this.connections.map((e=>({id:e.id,from:e.from.id,to:e.to.id,anchors:e.anchors?.map((e=>({x:e.x,y:e.y})))}))),scaling:this.scaling,panning:this.panning};return this.hooks.save.execute(e)},e.removeSelectedNodes=function(){for(let e=this.selectedNodes.length-1;e>=0;e-=1)this.removeNode(this.selectedNodes[e])},e.removeNode=function(e){if(this.nodes.includes(e)){if(this.events.beforeRemoveNode.emit(e).prevented)return;const t=[...Object.values(e.inputs),...Object.values(e.outputs)];t.forEach((e=>{e.externalName&&this.editor.privatizeInterface(this.id,e)})),this.connections.filter((e=>t.includes(e.from)||t.includes(e.to))).forEach((e=>this.removeConnection(e))),this._nodes.splice(this.nodes.indexOf(e),1),this.events.removeNode.emit(e),e.onDestroy(),this.nodeEvents.removeTarget(e.events),this.nodeHooks.removeTarget(e.hooks)}},e.removeNodeOnly=function(e){this._nodes.splice(this.nodes.indexOf(e),1),this.events.removeNode.emit(e),e.onDestroy(),this.nodeEvents.removeTarget(e),this.nodeHooks.removeTarget(e)},e.editNode=function(e){this.events.editNode.emit(e)},e.obtainExposedNames=function(){const e=[];return this._nodes.forEach((t=>{Object.values({...t.inputs,...t.outputs}).forEach((t=>{void 0!==t.externalName&&e.push(t.externalName)}))})),e},e.isIncorrectExternalName=function(e,t){const n=t.filter((t=>t===e)).length;return 0===e.length||0!==n},e.resolveNewExposedName=function(e){const t=this.obtainExposedNames();let n=1,o=e;for(;this.isIncorrectExternalName(o,t);)o=`${e}_${n}`,n+=1;return o},e}(e);super.registerGraph(t)}save(){const e=this._graph.id,t=Array.from((0,a.ux)(this.subgraphStack));t.forEach(this.backFromSubgraph.bind(this));const n=this.graph.save();n.panning=this._graph.panning,n.scaling=this._graph.scaling;const o={graphs:[]},i=e=>{void 0!==e.subgraph&&(o.graphs.push(e.graphState),e.graphState.nodes.forEach(i)),delete e.graphState};return n.nodes.forEach(i),o.graphs.length&&(o.entryGraph=e),o.graphs=[n,...o.graphs],t.forEach((([e,t])=>{const n=this.switchToSubgraph(t);if(Array.isArray(n)&&n.length)throw new Error(n)})),o}deepCleanEditor(e=!0){this.subgraphStack.forEach(this.backFromSubgraph.bind(this)),this.cleanEditor(e),this.graphName=void 0}cleanEditor(e=!0){const t=this._graph;(0,d.$4)(e);for(let e=t.connections.length-1;e>=0;e-=1)t.removeConnection(t.connections[e]);for(let e=t.nodes.length-1;e>=0;e-=1)t.removeNode(t.nodes[e]);(0,d.$4)(!1)}unregisterGraphs(){[...this.graphs].filter((e=>e.id!==this._graph.id)).forEach((e=>this.unregisterGraph(e))),this.subgraphStack=[]}unregisterNodes(){this.nodeTypes.forEach(((e,t)=>{this.unregisterNodeType(t)}))}registerNodeType(e,t){if(this.events.beforeRegisterNodeType.emit({type:e,options:t}).prevented)return;const n=new e;this._nodeTypes.set(n.type,{type:e,category:t?.category??"default",title:t?.title??n.title,isCategory:t?.isCategory??!1}),this.events.registerNodeType.emit({type:e,options:t})}async load(e,t=!1,n=!1){this.unregisterGraphs(),v.ir.clearRegistry();const o=new Set,i=t=>{const n=[];if(void 0!==t.subgraph){const a=e.graphs.filter((e=>e.id===t.subgraph));if(1!==a.length)return[`Expected exactly one template with ID ${t.name}, got ${a.length}`];if(o.has(t.subgraph))return[`Subgraph ${t.subgraph} has multiple nodes pointing to it - only unique IDs are allowed`];o.add(t.subgraph),t.graphState=structuredClone(a[0]),t.graphState.nodes.forEach((e=>{n.push(...i(e))}))}return n},a=this.readonly;this.readonly=!0;let r,l=[];if(!e.graphs.length)return["No graphs found"];if(e.entryGraph){if(r=e.graphs.find((t=>t.id===e.entryGraph)),!r)return[`No entry graph found of id '${e.entryGraph}'`]}else r=e.graphs[0];const{panning:d,scaling:c}=r,u=new Set;e.graphs.forEach((e=>{e.nodes.forEach((e=>{void 0!==e.subgraph&&u.add(e.subgraph)}))}));const p=e.graphs.find((e=>!u.has(e.id)));if(void 0===p)return["No root graph found. Make sure you graph does not have any reccurency"];try{if(p.nodes.forEach((e=>{l.push(...i(e))})),l.length)return l;e=this.hooks.load.execute(e),l=this._graph.load(p)}catch(e){return this.cleanEditor(),this.readonly=a,[e.toString()]}if(Array.isArray(l)&&l.length)return this.cleanEditor(),this.readonly=a,l;if(this.events.loaded.emit(),this.graphName=r.name,this.readonly=a,"undefined"==typeof window||n)return l;const h=(e,t)=>{if(void 0!==e?.nodes)for(let n=0;n<e.nodes.length;n+=1)if(void 0!==e.nodes[n].subgraph){if(e.nodes[n].subgraph.id===r.id)return[...t,e.nodes[n]];const o=h(e.nodes[n].subgraph,[...t,e.nodes[n]]);if(o.length)return o}return[]};return h(this._graph,[]).forEach((e=>{this.switchToSubgraph(e)})),"NoLayout"!==this.layoutManager.layoutEngine.activeAlgorithm&&(await(0,s.dY)(),await this.applyAutolayout(!1)),await(0,s.dY)(),void 0!==d&&(this._graph.panning=d),void 0!==c&&(this._graph.scaling=c),t||void 0!==c||void 0!==d||this.centerZoom(),l}privatizeInterface(e,t){if(void 0===t.externalName)return;let n=[...this.graphs].find((t=>t.id===e)),o=n.graphNode;if(t.externalName=void 0,void 0===o)return;const{graphIds:i,sharedInterface:a}=v.ir.getRegisteredInterface(t.id),s=i.findIndex((e=>e===o.graph.id));i.splice(s,i.length-s),o.updateExposedInterfaces();for(let e=s+1;e<i.length;e+=1)n=[...this.graphs].find((e=>e.id===i[s])),o=n.graphNode,o.updateExposedInterfaces();a===t&&v.ir.deleteRegisteredInterface(t.id)}exposeInterface(e,t,n=void 0){const o=[...this.graphs].find((t=>t.id===e)),i=o.graphNode;t.externalName=n??o.resolveNewExposedName(t.name),void 0!==i&&i.updateExposedInterfaces()}static editorSize(){if("undefined"==typeof document)throw new Error("The editor is in browserless mode. Cannot obtain editor size.");const e=document.getElementsByClassName("terminal-wrapper")[0]?.offsetHeight??0,t=document.getElementsByClassName("wrapper")[0]?.offsetHeight??0,n=document.getElementsByClassName("baklava-node-palette");let o=0;if(0!==n.length){const e=n[0].getBoundingClientRect();o=Math.max(e.right,0)}const i=window.innerHeight-e-t;return{editorWidth:window.innerWidth-o,editorHeight:i,sideBarWidth:o}}centerZoom(){if(!Array.isArray(this._graph.nodes)||0===this._graph.nodes.length)return;if("undefined"==typeof document)throw new Error("The editor is in browserless mode. Cannot obtain editor size.");const{editorWidth:e,editorHeight:t,sideBarWidth:n}=g.editorSize(),{graphHeight:o,graphWidth:i,leftmostX:a,topmostY:s}=this._graph.size(),r=100,l=t/(o+200),d=e/(i+200);if(d>l){const t=e/2*(1/l)-(i+200)/2;this._graph.panning={x:-(a-r-t-n/l),y:-(s-r)},this._graph.scaling=l}else{const e=t/2*(1/d)-(o+200)/2;this._graph.panning={x:-(a-r-n/d),y:-(s-r-e)},this._graph.scaling=d}}nodeURLsEmpty(){return 0===this.nodeURLs.size}getNodeURLs(e){const t=this.nodeURLs.get(e)||{},n=[];return Object.entries(t).forEach((([e,t])=>{const o={...this.baseURLs.get(e)};o.url+=t,n.push(o)})),n}getNodeIconPath(e){return this.nodeIcons.get(e)||void 0}addGraphTemplate(e,t,n,i=!1){if(this.events.beforeAddGraphTemplate.emit(e).prevented)return;if(this.nodeTypes.has(`${o.cO}${e.id}`))return;this._graphTemplates.push(e),this.graphTemplateEvents.addTarget(e.events),this.graphTemplateHooks.addTarget(e.hooks);const a=function(e,t){const n=(0,o.$G)(e);return class extends n{type=`${o.cO}${t}`;title=t;save(){const e=super.save(),t=[];return Object.values(this.inputs).concat(Object.values(this.outputs)).forEach((e=>{t.push({name:e.name,externalName:e.externalName,id:e.id,direction:e.direction,side:e.side,sidePosition:e.sidePosition})})),e.interfaces=t,delete e.inputs,delete e.outputs,e.subgraph=e.graphState.id,e.name=e.type,e.name=e.name.slice(o.cO.length),delete e.type,e.instanceName=""===e.title?void 0:e.title,delete e.title,e}load(e){this.hooks.beforeLoad.execute(e);const t=(0,p.Cy)(e.interfaces??[],[],[]);if(Array.isArray(t)&&t.length)return t;let{inputs:n,outputs:o}=t;n=Object.values(n),o=Object.values(o),delete e.graphState.interfaces,delete e.subgraph;const i=this.subgraph.load(e.graphState);return i.length?i:(this.updateExposedInterfaces(n,o),this.subgraph||i.push("Cannot load a graph node without a graph"),this.template||i.push("Unable to load graph node without graph template"),i.length?i:(this.position=e.position,this.title=e.instanceName??"",this.events.loaded.emit(this),[]))}updateExposedInterfaces(e=void 0,t=void 0){const n=(0,h.Sx)(this.subgraph.nodes,e??Object.values(this.inputs),t??Object.values(this.outputs));if(Array.isArray(n)&&n.length)throw new Error(`Internal error occurred while exposing an interface.\nReason: ${n.join(". ")}`);this.updateInterfaces(n.inputs,n.outputs)}onPlaced(){this.initialize()}initialize(){this.subgraph&&this.subgraph.destroy();const e=new o.TS(this.template.editor),t=this.prepareSubgraphInstance(),n=e.load(t);if(n.length)throw new Error(`Internal error occurred while initializing ${e.type} graph. Reason: ${n.join(". ")}`);e.template=this.template,this.subgraph=e,e.graphNode=this,this.updateExposedInterfaces([],[]),this._title=this.template.name,this.events.update.emit(null)}updateInterfaces(e,t){const n=[...e,...t],i={...this.inputs,...this.outputs};Object.entries(i).forEach((([e,t])=>{if(void 0===n.find((e=>e.id===t.id))){const n="output"===t.direction?"output":"input";this.removeInterface(n,e)}})),n.forEach((e=>{const t=Object.values(i).find((t=>t.id===e.id));if(void 0===t){const t=new o.gZ(e.name);Object.assign(t,e),v.ir.pushGraphIdToRegistry(t.id,this.graph.id),v.ir.createSharedInterface(t);const n="output"===e.direction?"output":"input";this.addInterface(n,`${e.direction}_${e.name}`,t)}else Object.assign(t,e)}))}prepareSubgraphInstance(){const e=new Map,t=t=>{const n=(0,r.A)();return e.set(t,n),n},n=t=>{const n=e.get(t);if(!n)throw new Error(`Unable to create graph from template: Could not map old id ${t} to new id`);return n},o=e=>{return n=e,o=e=>({...e,id:t(e.id)}),Object.fromEntries(Object.entries(n).map((([e,t])=>[e,o(t)])));var n,o};return{id:(0,r.A)(),nodes:this.template.nodes.map((e=>({...e,id:t(e.id),inputs:o(e.inputs),outputs:o(e.outputs)}))),connections:this.template.connections.map((e=>({id:t(e.id),from:n(e.from),to:n(e.to)})))}}}}(e,n);this.registerNodeType(a,{category:t,title:e.name,isCategory:i}),this.events.addGraphTemplate.emit(e)}switchGraph(e){if(void 0===this._switchGraph){const{switchGraph:e}=(0,i.uU)();this._switchGraph=e}(0,d.$4)(!0),this._graph=e.subgraph,this._switchGraph(e.subgraph),this.graphName=this._graph.name,(0,d.$4)(!1),(0,s.dY)().then((()=>{const e=this.graph.save();this.layoutManager.registerGraph(e),this.layoutManager.computeLayout(e).then(this.updateNodesPosition.bind(this))}))}switchToSubgraph(e){this.subgraphStack.push(e.graph),this.switchGraph(e)}backFromSubgraph(){const e=this.subgraphStack.pop();(0,d.$4)(!0),this._graph=e,this._switchGraph(this._graph),this.graphName=this._graph.name,(0,d.$4)(!1)}findInterface(e){for(let t=0;t<this.graph.nodes.length;t+=1){const n=Object.values(this.graph.nodes[t].inputs).concat(Object.values(this.graph.nodes[t].outputs)).find((t=>t.id===e));if(n)return n}return null}unwrapSubgraph(e){const t=Object.values(e.subgraph._nodes),n=t.map((e=>e.position.x)).reduce(((e,t)=>e+t),0)/t.length,o=t.map((e=>e.position.y)).reduce(((e,t)=>e+t),0)/t.length;this.graph.selectedNodes=[],t.forEach((t=>{const i=t.save(),a=this.graph.addNode(t);a&&(a.position.x+=e.position.x-n,a.position.y+=e.position.y-o,this.graph.selectedNodes.push(a),Object.values(a.inputs).concat(Object.values(a.outputs)).forEach((e=>{e.connectionCount=0})),a.load(i))}));const i=this.graph.connections.filter((t=>t.from.nodeId===e.id||t.to.nodeId===e.id));this.graph.removeNode(e),Object.values(e.subgraph.connections).concat(i).forEach((t=>{if("Connection"===t.from.name||"Connection"===t.to.name)return;const i=this.findInterface(t.from.id),a=this.findInterface(t.to.id);if(i&&a){const s=this.graph.addConnection(i,a);(t.anchors??[]).forEach(((i,a)=>{let r;r=e.subgraph.connections.includes(t)?{x:i.x+e.position.x-n,y:i.y+e.position.y-o}:{x:i.x,y:i.y},this.graph.addAnchor(r,s,a)}))}}))}isInSubgraph(){return this.subgraphStack.length>0}async applyAutolayout(e=!0){const t=this.graph.save();e&&t.nodes.forEach((e=>{e.position=void 0})),this.layoutManager.registerGraph(t);const n=await this.layoutManager.computeLayout(t);this.updateNodesPosition(n)}updateNodesPosition(e){e.nodes.forEach((e=>{this.graph.nodes.filter((t=>e.id===t.id))[0].position=e.position}))}updateCurrentSubgraphName(e){this._graph.name=e}}},57759:(e,t,n)=>{"use strict";n.d(t,{L:()=>s,i:()=>a});const o={},i=(e,t)=>({beforeMount:(n,i)=>{const a={timeout:null,newEvent:null,longPress:!1,moveEvents:0};o[n]={pointerdown:t=>{"touch"===t.pointerType&&null===a.timeout&&(a.moveEvents=0,a.longPress=!1,e(n,i,t,a),a.timeout=setTimeout((()=>{a.longPress=!0}),i.arg??500))},pointermove:()=>{a.moveEvents+=1},pointerup:e=>{"touch"===e.pointerType&&(a.longPress&&a.moveEvents<10&&t(n,i,e,a),a.timeout&&(clearTimeout(a.timeout),a.timeout=null))}},n.addEventListener("pointerdown",o[n].pointerdown),n.addEventListener("pointermove",o[n].pointermove),n.addEventListener("pointerup",o[n].pointerup)},unmounted:e=>{e.removeEventListener("pointerdown",o[e].pointerdown),e.removeEventListener("pointermove",o[e].pointermove),e.removeEventListener("pointerup",o[e].pointerup)}}),a=i(((e,t,n,o)=>{o.newEvent=n}),((e,t,n,o)=>{setTimeout((()=>t.value(o.newEvent)),50)})),s=i(((e,t,n,o)=>{o.newEvent=new PointerEvent("pointerdown",{button:2,clientX:n.clientX,clientY:n.clientY,screenX:n.screenX,screenY:n.screenY,pointerType:"mouse",relatedTarget:n.relatedTarget})}),((e,t,n,o)=>{setTimeout((()=>{e.dispatchEvent(o.newEvent)}),50)}))}}]);
//# sourceMappingURL=index-7574f2c7.61f9ad5c.js.map