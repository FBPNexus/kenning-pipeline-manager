"use strict";(self.webpackChunkpipeline_manager=self.webpackChunkpipeline_manager||[]).push([[197],{41857:(e,t,i)=>{i.d(t,{$4:()=>h,W6:()=>g,nb:()=>p,wH:()=>f});var n=i(50953),o=i(20641),r=i(42302);const a=(0,n.KR)(!1),s=(0,n.KR)("");class c{constructor(e,t,i=(0,r.A)()){Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"transactionId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topic",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.type=e,this.topic=t,this.transactionId=i}add(e){throw new Error(`Method add has thrown an error for topic: ${this.topic}`)}remove(e){throw new Error(`Method remove has thrown an error for topic: ${this.topic}`)}edit(e){throw new Error(`Method edit has thrown an error for topic: ${this.topic}`)}}class d extends c{constructor(e,t,i=(0,r.A)()){""===i&&(i=(0,r.A)()),super(e,t,i),Object.defineProperty(this,"nodeTuple",{enumerable:!0,configurable:!0,writable:!0,value:[]})}add(e){void 0!==this.nodeTuple[0]&&e.value.addNode(this.nodeTuple[0]).load(this.nodeTuple[1])}remove(e){const t=e.value.nodes.find((e=>e.id===this.topic));void 0!==t&&(this.nodeTuple=[t,t.save()],e.value.removeNode(t))}edit(e){if(void 0!==this.nodeTuple[0]){const t=[...Object.values(this.nodeTuple[0].inputs),...Object.values(this.nodeTuple[0].outputs)],i=e.value.connections.filter((e=>t.includes(e.from)||t.includes(e.to)));e.value.removeNode(this.nodeTuple[0]);const n=e.value.addNode(this.nodeTuple[0]),o=this.nodeTuple[1];this.nodeTuple=[this.nodeTuple[0],this.nodeTuple[0].save()],n.load(o),i.forEach((t=>{e.value.addConnection(t.from,t.to)}))}}}class l extends c{constructor(e,t,i=(0,r.A)()){""===i&&(i=(0,r.A)()),super(e,t,i),Object.defineProperty(this,"conn",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}add(e){if(void 0!==this.conn){const t=e.value.findNodeById(this.conn.from.nodeId),i=e.value.findNodeById(this.conn.to.nodeId);if(!t||!i)return;const n=[...Object.values(t.inputs),...Object.values(t.outputs)].filter((e=>e.port)).find((e=>e.id===this.conn.from.id)),o=[...Object.values(i.inputs),...Object.values(i.outputs)].filter((e=>e.port)).find((e=>e.id===this.conn.to.id));if(!n||!o)return;const r=e.value.addConnection(n,o);if(void 0===r)return;r.id=this.conn.id}}remove(e){const t=e.value.connections.find((e=>e.id===this.topic));void 0!==t&&(this.conn=t,e.value.removeConnection(t))}}class u extends c{constructor(e,t,i=(0,r.A)()){""===i&&(i=(0,r.A)()),super(e,t,i),Object.defineProperty(this,"anchor",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}add(e){if(void 0!==this.anchor){const t=e.value.connections.find((e=>e.from.id===this.anchor[0].from.id&&e.to.id===this.anchor[0].to.id&&e.id===this.anchor[0].id));void 0!==t&&void 0===t.anchors&&(t.anchors=[]),t.anchors.splice(this.anchor[2],0,this.anchor[1])}}remove(e){if(void 0!==this.anchor){const t=e.value.connections.find((e=>e.from===this.anchor[0].from&&e.to===this.anchor[0].to));void 0!==t&&t.anchors.splice(this.anchor[2],1)}}}function h(e){a.value=e}function p(e=(0,r.A)()){if(""===s.value)return s.value=e,e}function f(){s.value=""}function g(e,t){const i=Symbol("CustomHistoryToken"),r=new Map,c=new Map;let h="ThisShouldNotAppearInHistoryMaps",g="ThisShouldNotAppearInHistoryMaps";const m=(e,t)=>{e.events.addNode.unsubscribe(t),e.events.removeNode.unsubscribe(t),e.events.editNode.unsubscribe(t),e.events.addConnection.unsubscribe(t),e.events.removeConnection.unsubscribe(t),e.events.addAnchor.unsubscribe(t),e.events.removeAnchor.unsubscribe(t)},y=(e,t,n=!1)=>{if(t&&m(t,i),e){if(g=h,h=e.id,void 0===r.get(h)&&r.set(h,[]),void 0===c.get(h)&&c.set(h,[]),n){const e=c.get(g);e&&c.set(h,e);const t=r.get(g);t&&r.set(h,t)}e.events.addNode.subscribe(i,(t=>{if(!a.value){const i=r.get(e.id);if(!i)return;i.push(new d("add",t.id.toString(),s.value)),c.set(e.id,[])}})),e.events.removeNode.subscribe(i,(t=>{if(!a.value){const i=r.get(e.id);if(!i)return;const n=new d("rem",t.id.toString(),s.value);i.push(n),n.nodeTuple=[t,t.save()],c.set(e.id,[])}})),e.events.editNode.subscribe(i,(t=>{if(!a.value){const i=r.get(e.id);if(!i)return;const n=new d("edit",t.id.toString(),s.value);i.push(n),n.nodeTuple=[t,t.save()],c.set(e.id,[])}})),e.events.addConnection.subscribe(i,(t=>{if(!a.value){const i=r.get(e.id);if(!i)return;i.push(new l("add",t.id.toString(),s.value)),c.set(e.id,[])}})),e.events.removeConnection.subscribe(i,(t=>{var i;if(!a.value){const n=""!==s.value;n||p();const o=r.get(e.id);if(!o)return;(null!==(i=t.anchors)&&void 0!==i?i:[]).slice().reverse().forEach((i=>{e.events.removeAnchor.emit([t,t.anchors.indexOf(i)])}));const a=new l("rem",t.id.toString(),s.value);o.push(a),a.conn=t,c.set(e.id,[]),n||f()}})),e.events.addAnchor.subscribe(i,(t=>{if(!a.value){const i=r.get(e.id);if(!i)return;const n=Math.trunc((t[1]-1)/3),o=t[0],a=new u("add",o.anchors[n].id.toString(),s.value);i.push(a),a.anchor=[o,o.anchors[n],n],c.set(e.id,[])}})),e.events.removeAnchor.subscribe(i,(t=>{if(!a.value){const i=r.get(e.id);if(!i)return;const n=t[1],o=t[0],a=new u("rem",o.anchors[n].id.toString(),s.value);i.push(a),a.anchor=[o,o.anchors[n],n],c.set(e.id,[])}}))}};(0,o.wB)(e,((e,t)=>y(e,t)),{flush:"post",immediate:!0});const v=(t,i)=>{const n=t.pop();void 0!==n&&(a.value=!0,"add"===n.type?(n.type="rem",n.remove(e)):"rem"===n.type?(n.type="add",n.add(e)):"edit"===n.type&&(n.type="edit",n.edit(e)),i.push(n),t.length>0&&t[t.length-1].transactionId===n.transactionId&&v(t,i),a.value=!1,e.value.selectedNodes.splice(0,e.value.selectedNodes.length))};return t.registerCommand("undo",{canExecute:()=>!0,execute:()=>{const e=r.get(h);if(e&&0!==e.length){const t=c.get(h);e&&t&&v(e,t)}}}),t.registerCommand("redo",{canExecute:()=>!0,execute:()=>{const e=r.get(h),t=c.get(h);e&&t&&0!==t.length&&v(t,e)}}),t.registerCommand("START_TRANSACTION",{canExecute:()=>""===s.value,execute:()=>p}),t.registerCommand("COMMIT_TRANSACTION",{canExecute:()=>""!==s.value,execute:()=>f}),t.registerHotkey(["Control","z"],"undo"),t.registerHotkey(["Control","y"],"redo"),(0,n.Kh)({max_steps:200,graphSwitch:y,unsubscribeFromGraphEvents:m})}},881:(e,t,i)=>{i.d(t,{A:()=>r});class n{constructor(e){Object.defineProperty(this,"procedureName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pr_inProgress",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.procedureName=e}get progressBar(){return document.querySelector(`#navbar-button-${this.procedureName} > .progress-bar`)}get inProgress(){return this.pr_inProgress}set inProgress(e){const{progressBar:t}=this;t&&(e||t.classList.remove("animate"),t.style.width="0%"),this.pr_inProgress=e,void 0!==this.hook&&this.hook()}}class o extends Map{constructor(e){super(),Object.defineProperty(this,"defaultFactory",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.defaultFactory=e}get(e){return super.has(e)||super.set(e,this.defaultFactory(e)),super.get(e)}}const r=new class extends o{constructor(){super(...arguments),Object.defineProperty(this,"hook",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}get(e){if(!super.has(e)){const t=this.defaultFactory(e);t.hook=this.hook,super.set(e,t)}return super.get(e)}setHook(e){this.hook=e,this.forEach((t=>{t.hook=e}))}}((e=>new n(e)))},57565:(e,t,i)=>{i.d(t,{ir:()=>n});const n=new class{constructor(){Object.defineProperty(this,"exposedInterfaces",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}clearRegistry(){this.exposedInterfaces.clear()}pushGraphIdToRegistry(e,t){const i=this.exposedInterfaces.get(e);if(!i)throw new Error(`Interface with id ${e} not found in the register.`);i.graphIds.push(t)}createSharedInterface(e){const t=this.exposedInterfaces.get(e.id);if(!t)throw new Error(`'Interface with id ${e.id} not found in the register.`);Object.defineProperty(e,"maxConnectionsCount",{get:()=>t.sharedInterface.maxConnectionsCount,set(e){t.sharedInterface.maxConnectionsCount=e}}),Object.defineProperty(e,"connectionCount",{get:()=>t.sharedInterface.connectionCount,set(e){t.sharedInterface.connectionCount=e}}),Object.defineProperty(e,"type",{get:()=>t.sharedInterface.type})}isRegistered(e){return this.exposedInterfaces.has(e)}getRegisteredInterface(e){if(!this.exposedInterfaces.has(e))throw new Error(`Interface of id ${e} is not registered.`);return this.exposedInterfaces.get(e)}deleteRegisteredInterface(e){if(!this.exposedInterfaces.has(e))throw new Error(`Interface of id ${e} is not registered.`);return this.exposedInterfaces.delete(e)}registerInterface(e,t){if(this.exposedInterfaces.has(e.id))throw new Error(`Trying to register an interface of id ${e.id}, but it is already registered.`);this.exposedInterfaces.set(e.id,{sharedInterface:e,sharedInterfaceGraphId:t,graphIds:[]})}}},45825:(e,t,i)=>{i.d(t,{Q:()=>r,i:()=>o});var n=i(63491);function o(e){return t=>Math.round(t/e.value)*e.value}function r(e){const{graph:t}=(0,n.uU)();return(i,n,o)=>{const r=t.value.nodes.filter((e=>e.id!==n&&!o.includes(e.id))).map((t=>t.position[e])).filter((e=>Math.abs(i-e)<100));return 0!==r.length?Math.min(...r):void 0}}},6565:(e,t,i)=>{i.d(t,{dH:()=>_,Ay:()=>T,sA:()=>V});var n=i(63282),o=i(94541),r=i(25504),a=i(9459),s=i(63491),c=i(46171),d=i(50953),l=i(41857),u=i(20641),h=i(42302),p=i(96422);const f="COPY",g="DELETE",m="UNHIGHLIGHT",y="PASTE";var v=i(35851);class w{types=new Map;defaultStyle={interfaceConnectionPattern:"solid",interfaceConnectionColor:"#FFFFFF",interfaceColor:"#00E58D"};constructor(e){e.hooks.renderInterface.subscribe(this,(({intf:e,el:t})=>{if(e.type){const i=this.normalizeType(e.type).find((e=>void 0!==this.types[e]?.interfaceColor));if(void 0!==i){const e=this.types[i].interfaceColor,n=t.querySelector(".__port:not(.greyedout_arrow)");if(null!==n)n.style.backgroundColor=e;else{const e=t.querySelector(".__port");null!==e&&(e.style.backgroundColor=getComputedStyle(e).getPropertyValue("$gray-500"))}}}return{intf:e,el:t}}))}normalizeType(e){return"string"==typeof e||e instanceof String?[e]:e}getConnectionStyle(e,t){const i=this.normalizeType(e?.type),n=this.normalizeType(t?.type);if(void 0===e?.type)return this.defaultStyle;if(void 0===t?.type){const e=i.find((e=>void 0!==this.types[e]));return{...this.defaultStyle,...this.types[e]}}const o=i.filter((e=>n.includes(e)));if(Array.isArray(o)&&o.length>1)return this.defaultStyle;const r=o.find((e=>void 0!==this.types[e]));return{...this.defaultStyle,...this.types[r]}}readInterfaceTypes(e){this.types={},e?.interfaces&&Object.entries(e.interfaces).forEach((([e,t])=>{this.types[e]={...t,name:e}}))}}var b=i(8239),$=i(85022),x=i(75572),O=i(41686),S=i(78873),A=i(38703);function E(e,t,i){const{nodeId:n}=e.from,o=document.getElementById(n);return((o?o.offsetTop+o.offsetHeight:0)+i.y)*t}function I(e,t,i,n,o){return[Math.sqrt(Math.abs((e-i)*(e-i)+(e-i)*(t-n)/o)),Math.sqrt(Math.abs((t-n)*(t-n)+(t-n)*(e-i)*o))]}class N{constructor(e,t,i,n,o){this.x1=e,this.y1=t,this.x2=i,this.y2=n,this.from=o.from,o.to&&(this.to=o.to,("input"===this.from.direction&&"output"===this.to.direction||"input"===this.from.direction&&"inout"===this.to.direction||"inout"===this.from.direction&&"output"===this.to.direction)&&([this.x1,this.x2,this.y1,this.y2]=[this.x2,this.x1,this.y2,this.y1],[this.from,this.to]=[this.to,this.from]))}}class C{style="curved";viewModel=null;randomizedOffset=!1;getShift(e,t,i,n){const o=i.findNodeById(e.nodeId),r=i.findNodeById(t.nodeId),a=(e.sidePosition+t.sidePosition)/2;if(this.randomizedOffset){const i=[...Object.values(o.inputs),...Object.values(o.outputs)].filter((t=>t.side===e.side&&t.port)),s=[...Object.values(r.inputs),...Object.values(r.outputs)].filter((e=>e.side===t.side&&e.port));return 15*((([...t.id].reduce(((e,t)=>e+t.charCodeAt(0)),0)??0)^([...e.id].reduce(((e,t)=>e+t.charCodeAt(0)),0)??0))%(i.length+s.length)+a)*n}return 15*a*n}curvedRender(e,t,i,n,o){const r=new N(e,t,i,n,o),a=.3*Math.abs(r.x1-r.x2);if(r.to){if("right"===r.from.side&&"left"===r.to.side)return`M ${r.x1} ${r.y1} C ${r.x1+a} ${r.y1}, ${r.x2-a} ${r.y2}, ${r.x2} ${r.y2}`;if("left"===r.from.side&&"right"===r.to.side)return`M ${r.x1} ${r.y1} C ${r.x1-a} ${r.y1}, ${r.x2+a} ${r.y2}, ${r.x2} ${r.y2}`;if("right"===r.from.side&&"right"===r.to.side){const e=Math.max(r.x1+a,r.x2+a);return`M ${r.x1} ${r.y1} C ${e} ${r.y1}, ${e} ${r.y2}, ${r.x2} ${r.y2}`}if("left"===r.from.side&&"left"===r.to.side){const e=Math.min(r.x1-a,r.x2-a);return`M ${r.x1} ${r.y1} C ${e} ${r.y1}, ${e} ${r.y2}, ${r.x2} ${r.y2}`}}return"right"===r.from.side?`M ${r.x1} ${r.y1} C ${r.x1+a} ${r.y1}, ${r.x2-a} ${r.y2}, ${r.x2} ${r.y2}`:"left"===r.from.side?`M ${r.x1} ${r.y1} C ${r.x1-a} ${r.y1}, ${r.x2+a} ${r.y2}, ${r.x2} ${r.y2}`:void 0}curvedRenderLoopback(e,t,i,n,o){const r=this.viewModel.displayedGraph,a=new N(e,t,i,n,o),s=10*r.scaling;if(a.from.id===a.to.id){const e=this.getShift(a.from,a.to,r,r.scaling)+30*r.scaling,t="right"===a.from.side?a.x1+e:a.x1-e;return`M ${a.x1} ${a.y1}\n            A ${s} ${s/2} 0 0 0 ${t} ${a.y1}\n            A ${s} ${s/2} 0 0 0 ${a.x1} ${a.y1}`}if("left"===a.from.side&&"left"===a.to.side){const e=s,t=Math.abs(a.y1-a.y2)/2,i=a.y1>a.y2?1:0;return`M ${a.x1} ${a.y1}\n            A ${e} ${t} 0 0 ${i} ${a.x2} ${a.y2}`}if("right"===a.from.side&&"right"===a.to.side){const e=s,t=Math.abs(a.y1-a.y2)/2,i=a.y1>a.y2?0:1;return`M ${a.x1} ${a.y1}\n            A ${e} ${t} 0 0 ${i} ${a.x2} ${a.y2}`}const c=this.getShift(a.from,a.to,r,r.scaling)+30*r.scaling,d="left"===a.from.side?a.x1:a.x2,l="right"===a.to.side?a.x2:a.x1,u="left"===a.from.side?a.y1:a.y2,h="right"===a.to.side?a.y2:a.y1,p=E(o,r.scaling,r.panning),f=p+c,g=l-c,m=(f+h)/2,[y,v]=I(l,f,g,m,1),w=(l+d)/2,b=p,[$,x]=I(l,f,w,b,1),O=d+c,S=(f+u)/2,[A,C]=I(d,f,O,S,-1);return`M ${l} ${h}\n        A ${y} ${v} 0 0 1 ${l} ${f}\n        A ${$} ${x} 0 0 1 ${d} ${f}\n        A ${A} ${C} 0 0 1 ${d} ${u}`}orthogonalRender(e,t,i,n,o){const r=this.viewModel.displayedGraph,a=new N(e,t,i,n,o);if(void 0!==o.anchors&&o.anchors.length){const e=o.anchors.map((e=>{return{x:((t=e).x+r.panning.x)*r.scaling,y:(t.y+r.panning.y)*r.scaling};var t})),t=[{x:a.x1,y:a.y1}];let i=a.from.side;if("right"===i?t.push({x:a.x1+10,y:a.y1}):"left"===i&&t.push({x:a.x1-10,y:a.y1}),i="horizontal",e.forEach((e=>{"vertical"===i?(t.push({x:t[t.length-1].x+(e.x-t[t.length-1].x)/2,y:t[t.length-1].y}),t.push({x:t[t.length-2].x+(e.x-t[t.length-2].x)/2,y:e.y}),t.push({x:e.x,y:e.y}),i="horizontal"):(t.push({x:t[t.length-1].x,y:t[t.length-1].y+(e.y-t[t.length-1].y)/2}),t.push({x:e.x,y:t[t.length-2].y+(e.y-t[t.length-2].y)/2}),t.push({x:e.x,y:e.y}),i="vertical")})),"vertical"===i)t.push({x:t[t.length-1].x+(a.x2-t[t.length-1].x)/2,y:t[t.length-1].y}),t.push({x:t[t.length-2].x+(a.x2-t[t.length-2].x)/2,y:a.y2}),t.push({x:a.x2,y:a.y2});else{t.push({x:t[t.length-1].x,y:t[t.length-1].y+(a.y2-t[t.length-1].y)/2});let e=0;e="left"===a.to.side?10:-10,t.push({x:a.x2-e,y:t[t.length-2].y+(a.y2-t[t.length-2].y)/2}),t.push({x:a.x2-e,y:a.y2}),t.push({x:a.x2,y:a.y2})}return t}const s=30*r.scaling,c=(a.x1+a.x2)/2;if(o.to){const e=this.getShift(a.from,a.to,r,r.scaling);if("right"===a.from.side&&"left"===a.to.side){const t=Math.max(a.x1,c)+e+s,i=t<a.x2-e-s?a.x1+e+s:t,n=a.x2-e-s;return t>=a.x2-e-s&&(i>a.x2-s||n<a.x1-s)?`M ${a.x1} ${a.y1}\n                    H ${i}\n                    V ${(a.y1+a.y2)/2}\n                    H ${n}\n                    V ${a.y2}\n                    H ${a.x2}`:`M ${a.x1} ${a.y1} H ${t} V ${a.y2} H ${a.x2}`}if("left"===a.from.side&&"right"===a.to.side){const t=Math.max(a.x2,c)+e+s,i=t<a.x1-e-s?a.x2+e+s:t,n=a.x1-e-s;return t>=a.x1-e-s&&(i>a.x1-s||n<a.x2-s)?`M ${a.x2} ${a.y2}\n                    H ${i}\n                    V ${(a.y1+a.y2)/2}\n                    H ${n}\n                    V ${a.y1}\n                    H ${a.x1}`:`M ${a.x2} ${a.y2} H ${t} V ${a.y1} H ${a.x1}`}if("right"===a.from.side&&"right"===a.to.side)return`M ${a.x1} ${a.y1} H ${Math.max(a.x1,a.x2,c)+e+s} V ${a.y2} H ${a.x2}`;if("left"===a.from.side&&"left"===a.to.side)return`M ${a.x1} ${a.y1} H ${Math.min(a.x1,a.x2,c)-e-s} V ${a.y2} H ${a.x2}`}return`M ${a.x1} ${a.y1} H ${c} V ${a.y2} H ${a.x2}`}orthogonalRenderLoopback(e,t,i,n,o){const r=this.viewModel.displayedGraph,a=new N(e,t,i,n,o),s=this.getShift(a.from,a.to,r,r.scaling)+30*r.scaling;if(void 0!==o.anchors&&o.anchors.length){const e=o.anchors.map((e=>({x:(e.x+r.panning.x)*r.scaling,y:(e.y+r.panning.y)*r.scaling}))),t=[{x:a.x1,y:a.y1}],i="right"===a.from.side?s:-s;return t.push({x:a.x1+i,y:a.y1}),e.forEach((e=>{t.push({x:t[t.length-1].x,y:e.y}),t.push({x:e.x,y:e.y}),t.push({x:e.x,y:e.y})})),t.push({x:t[t.length-1].x,y:a.y2}),t.push({x:a.x2+i,y:a.y2}),t.push({x:a.x2,y:a.y2}),t}const c=E(o,r.scaling,r.panning)+s;return"right"===a.from.side&&"left"===a.to.side?`M ${a.x1} ${a.y1}\n            h ${s}\n            V ${c} H ${a.x2-s} V ${a.y2} H ${a.x2}`:"left"===a.from.side&&"right"===a.to.side?`M ${a.x2} ${a.y2}\n            h ${s}\n            V ${c} H ${a.x1-s} V ${a.y1} H ${a.x1}`:"right"===a.from.side&&"right"===a.to.side?`M ${a.x2} ${a.y2}\n            h ${s}\n            V ${a.y1} H ${a.x1}`:"left"===a.from.side&&"left"===a.to.side?`M ${a.x2} ${a.y2}\n            h ${-s}\n            V ${a.y1} H ${a.x1}`:void 0}constructor(e,t,i=!1){this.viewModel=e,this.style=t,this.randomizedOffset=i}render(e,t,i,n,o){const r=this.isLoopback(o)?"Loopback":"";return this[`${this.style}Render${r}`](e,t,i,n,o)}isLoopback(e){return!!e.to&&e.from.nodeId===e.to.nodeId}}class k{static instance=void 0;currentSpecification=void 0;unresolvedSpecification=void 0;constructor(){if(void 0!==k.instance)throw new Error("Error - use Specification.getInstance()")}static getInstance(){return k.instance||(k.instance=new k),k.instance}getNodeSpecification(e){if(void 0!==this.currentSpecification)return e.startsWith(c.cO)?this.currentSpecification.graphs.find((t=>t.name===e.slice(c.cO.length))):this.currentSpecification.nodes.find((t=>t.name===e))}}class j{constructor(){Object.entries(O.properties).forEach((([e,t])=>{this[e]=t.default}))}}const P="Graphs",M="New Graph Node",_=`${c.cO}${M}`;async function V(e){const t=function(e){let t="{}";"undefined"!=typeof document&&(t=`${document.location.href.split("/").slice(0,-1).join("/")}/{}`);const i={NODE_ENV:"production",VUE_APP_STATIC:"true",VUE_APP_VERBOSE:"false",VUE_APP_GRAPH_DEVELOPMENT_MODE:"false",BASE_URL:""}.VUE_APP_JSON_URL_SUBSTITUTES??`{"https": "https://{}", "http": "http://{}", "relative": "${t}"}`,n=JSON.parse(i),o=e.split("//");if(o.length<2)return;const r=o[0].substring(0,o[0].length-1),a=o.slice(1).join("");return Object.keys(n).includes(r)?n[r].replace("{}",a):void 0}(e);if(void 0===t)return[!1,`Could not download the resource from:  ${e}.`];let i;try{i=await fetch(t,{mode:"cors"})}catch(e){return[!1,e.message]}try{return[!0,await i.json()]}catch(e){return[!1,e.message]}}class T{static instance;defaultMetadata=new j;editor=new v.A;baklavaView=(0,s.AP)(this.editor);specificationLoaded=(0,d.KR)(!1);specification=k.getInstance();updatedMetadata={};constructor(){this.editor.unregisterNodes(),this.baklavaView.connectionRenderer=new C(this.baklavaView,this.defaultMetadata.connectionStyle,this.defaultMetadata.randomizedOffset),this.baklavaView.editor.layoutManager.useAlgorithm(this.defaultMetadata.layout),this.baklavaView.interfaceTypes=new w(this.baklavaView),this.baklavaView.layers=this.defaultMetadata.layers,this.baklavaView.collapseSidebar=this.defaultMetadata.collapseSidebar,this.baklavaView.movementStep=this.defaultMetadata.movementStep,this.baklavaView.editor.allowLoopbacks=this.defaultMetadata.allowLoopbacks,this.baklavaView.navbarItems=this.defaultMetadata.navbarItems,this.baklavaView.cache={},this.baklavaView.logLevel=this.defaultMetadata.logLevel,this.specificationVersion=$.version,this.baklavaView.commandHandler=(0,s.TE)(),this.baklavaView.history=null,this.baklavaView.history=(0,l.W6)((0,d.ux)(this.baklavaView).displayedGraph,this.baklavaView.commandHandler),this.baklavaView.clipboard=function(e,t,i){const n=Symbol("ClipboardToken"),o=(0,d.KR)(""),r=(0,d.KR)(""),a=(0,d.KR)(0),v=(0,u.EW)((()=>!o.value)),w=(e,t,i)=>{for(let n=0;n<e.length;n+=1){let o;if(i&&"input"!==i||(o=Object.values(e[n].inputs).find((e=>e.id===t))),o||i&&"output"!==i||(o=Object.values(e[n].outputs).find((e=>e.id===t))),o)return o}};return i.registerCommand(g,{canExecute:()=>e.value.selectedNodes.length>0,execute:()=>{const{viewModel:t}=(0,s.if)();t.value.editor.readonly||((0,l.nb)(),e.value.selectedNodes.forEach((e=>{(0,p.bf)(e)})),(0,l.wH)())}}),i.registerHotkey(["Delete"],g),i.registerCommand(m,{canExecute:()=>!0,execute:()=>{e.value.selectedNodes=[]}}),i.registerHotkey(["Escape"],m),i.registerCommand(f,{canExecute:()=>!0,execute:()=>{const t=e.value.selectedNodes.flatMap((e=>[...Object.values(e.inputs),...Object.values(e.outputs)])),i=e.value.connections.filter((e=>t.includes(e.from)||t.includes(e.to))).map((e=>({from:e.from.id,to:e.to.id})));r.value=JSON.stringify(i),o.value=JSON.stringify(e.value.selectedNodes.map((e=>e.save()))),a.value=0}}),i.registerHotkey(["Control","c"],f),i.registerCommand(y,{canExecute:()=>!v.value,execute:()=>{var d,l;const{viewModel:u}=(0,s.if)();if(v.value||u.value.editor.readonly)return;const p=null!==(d=u.value.movementStep)&&void 0!==d?d:1,f=new Map,g=JSON.parse(o.value),m=JSON.parse(r.value),y=[],b=[],$=e.value;i.executeCommand("START_TRANSACTION");for(let i=0;i<g.length;i+=1){let o;if(o=void 0!==(null===(l=g[i])||void 0===l?void 0:l.subgraph)?t.value.nodeTypes.get(`${c.cO}${g[i].name}`):t.value.nodeTypes.get(g[i].name),!o)return;let r=new o.type;y.push(r),r.hooks.beforeLoad.subscribe(n,(e=>{const t=e;return t.position&&(a.value+=1,t.position.x+=a.value*Math.max(40,p),t.position.y+=a.value*Math.max(40,p)),void 0!==g[i].graphState&&g[i].graphState.nodes.forEach((e=>{void 0!==e.type&&(e.name=e.type)})),r.hooks.beforeLoad.unsubscribe(n),t})),r=$.addNode(r);const s=e=>{const t=(0,h.A)();f.set(e.id,t),e.id=t},d=e=>{s(e),void 0!==e.graphState?(s(e.graphState),e.graphState.nodes.forEach((e=>{d(e)})),e.interfaces.forEach((e=>{var t;e.id=null!==(t=f.get(e.id))&&void 0!==t?t:e.id,void 0!==e.externalName&&(e.externalName=$.resolveNewExposedName(e.externalName))})),e.graphState.connections.forEach((e=>{if(void 0===f.get(e.from)||void 0===f.get(e.to))throw new Error(`Error when executing copy and paste. Connection from interface ${e.from} to ${e.to} is invalid`);e.from=f.get(e.from),e.to=f.get(e.to)}))):e.interfaces.forEach((e=>{s(e),void 0!==e.externalName&&(e.externalName=$.resolveNewExposedName(e.externalName))}))};d(g[i]),r.load(Object.assign(Object.assign({},g[i]),{id:r.id})),void 0!==e.value.graphNode&&e.value.graphNode.updateExposedInterfaces()}for(let e=0;e<m.length;e+=1){const t=f.get(m[e].from),i=f.get(m[e].to);if(t&&i){const e=w(y,t,"output"),n=w(y,i,"input");if(e&&n){const t=$.addConnection(e,n);t&&b.push(t)}}}return i.executeCommand("COMMIT_TRANSACTION"),{newNodes:y,newConnections:b}}}),i.registerHotkey(["Control","v"],y),i.registerCommand("CLEAR_CLIPBOARD",{canExecute:()=>!0,execute:()=>{o.value="",r.value=""}}),(0,d.Kh)({isEmpty:v})}((0,d.ux)(this.baklavaView).displayedGraph,(0,d.KR)(this.baklavaView.editor),this.baklavaView.commandHandler)}async updateEditorSpecification(e,t=!1){if(!e)return["No specification passed"];if("string"==typeof e||e instanceof String)try{e=a.parse(e)}catch(e){return{errors:[e],warnings:[]}}this.specificationLoaded&&this.clearEditorManagerState();const i=[],n=[],{version:o}=e;if(this.specification.currentSpecification||(void 0===o?i.push(`Loaded specification has no version assigned. Please update the specification to version ${this.specificationVersion}.`):o!==this.specificationVersion&&i.push(`The specification format version (${o}) differs from the current specification format version (${this.specificationVersion}). It may result in an unexpected behaviour.`)),this.specification.unresolvedSpecification=JSON.parse(JSON.stringify(e)),this.specification.currentSpecification=e,!t){this.globalVisitedSpecs=new Set;const{specification:t,errors:o}=await this.downloadNestedImports(e);if(n.push(...o),n.length)return{errors:n,warnings:i};if(void 0!==t.includeGraphs){const{graphs:e,errors:o}=await T.includeGraphs(t.includeGraphs);if(n.push(...o),n.length)return{errors:n,warnings:i};t.graphs=[...t.graphs??[],...e]}else t.graphs??=[];const{metadata:r}=t;if(n.push(...this.updateMetadata(r,!1,!0)),n.length)return{errors:n,warnings:i};const{errors:a,warnings:s}=await this.updateGraphSpecification(t);n.push(...a),i.push(...s)}return 0===n.length?this.specificationLoaded=!0:this.clearEditorManagerState(),{errors:n,warnings:i}}clearEditorManagerState(){this.baklavaView.editor.unregisterGraphs(),this.baklavaView.editor.deepCleanEditor(),this.baklavaView.editor.unregisterNodes(),this.specificationLoaded=!1,this.specification.currentSpecification={},this.specification.unresolvedSpecification={}}async downloadNestedImports(e,t=new Set){const i=[],n=[],o=new Set,r=e.include??[];return await Promise.all(r.map((async e=>{if(o.has(e))i.push(`Specification is included multiple times, skipping ${e}`);else if(t.has(e))i.push(`Circular dependency detected in included specification ${e}`);else if(o.add(e),!this.globalVisitedSpecs.has(e)){this.globalVisitedSpecs.add(e);const[o,r]=await V(e);!1===o?i.push(`Could not load the included specification from ${e}. Reason: ${r}`):n.push({specification:r,trace:new Set([...t,e])})}}))),i.length||await Promise.all(n.map((async({specification:t,trace:n})=>{const{specification:o,errors:r}=await this.downloadNestedImports(t,n);i.push(...r),e=T.mergeObjects(e,o)}))),{specification:e,errors:i}}static async includeGraphs(e){const t=[],i=[];if(0===e.length)return{graphs:i,errors:t};if(e.length!==new Set(e).size)return t.push("Duplicate subgraph includes detected. Aborting."),{graphs:i,errors:t};const n=[];if(await Promise.all(e.map((async e=>{const[i,o]=await V(e.url);!1!==i?n.push(o):t.push(`Could not load the included dataflow from '${e.url}'. Reason: ${o}`)}))),t.length)return{graphs:i,errors:t};for(let o=0;o<e.length;o+=1){const r=n[o],a=e[o];if(1!==r.graphs.length){t.push(`Only single graph dataflows are supported. Aborting loading subgraph include from ${a.url}.`);continue}const s=r.graphs[0];s.name=a.name??s.name,void 0!==s.name?void 0===i.find((e=>e.name===s.name))?(s.category=a.category,i.push(s)):t.push(`Included graph from ${a.url} has a duplicate name`):t.push(`Included subgraph from ${a.url} does not have a name defined.`)}return{graphs:i,errors:t}}registerDefaultNodes(){const e=[],t=[];if(this.editor.nodeTypes.has(_))return e.push(`Node name '${M}' is reserved by the editor, but it was included in the specification. Please change the name of the graph node to avoid conflicts.`),{errors:e,warnings:t};const i=(0,b.$o)([],[],M,this.baklavaView.editor);return Array.isArray(i)&&i.length?e.push(...i):this.baklavaView.editor.addGraphTemplate(i,P,M),{errors:e,warnings:t}}async updateGraphSpecification(e){const t=[];if(!e)return{errors:["No specification passed"],warnings:t};const{nodes:i,graphs:n,metadata:o}=e;let r=[];try{const e=this.preprocessNodes(i);r=this.resolveInheritance(e)}catch(e){return{errors:[e.message],warnings:t}}const a=[];if(a.push(...this.validateResolvedSpecification({graphs:n,nodes:r,metadata:o})),a.length)return{errors:a,warnings:t};if(this.specification.currentSpecification.nodes=JSON.parse(JSON.stringify(r)),this.specification.currentSpecification.graphs=JSON.parse(JSON.stringify(n)),r.forEach((e=>{(e.extends??[]).forEach((t=>{const i=r.find((e=>e.name===t));void 0!==i&&(void 0===i.extending&&(i.extending=[]),i.extending.push(e.name))}))})),r.forEach((e=>{const t=new Set;(e.extends??[]).forEach((e=>{const i=r.find((t=>t.name===e));void 0!==i&&i.extending.forEach((e=>t.add(e)))})),t.delete(e.name),e.siblings=Array.from(t)})),r.forEach((e=>{e.extends&&(e.extends=e.extends.filter((e=>void 0!==r.find((t=>t.name===e)))))})),r.forEach((e=>{const t=(0,b.Wo)(e.name,e.layer,e.interfaces??[],e.properties??[],e.interfaceGroups??[],e.defaultInterfaceGroups??[],o?.twoColumn??!1,e.description??"",e.extends??[],e.extending??[],e.siblings??[],e.width??300);if(Array.isArray(t)&&t.length)a.push(...t);else{if(this.baklavaView.editor.registerNodeType(t,{title:e.name,category:e.category,isCategory:e.isCategory??!1}),"icon"in e)if("string"==typeof e.icon)this.baklavaView.editor.nodeIcons.set(e.name,e.icon);else{const t=Object.keys(e.icon)[0],i=Object.values(e.icon)[0],n=this.baklavaView.editor.baseIconUrls.get(t);this.baklavaView.editor.nodeIcons.set(e.name,`${n}/${i}`)}"urls"in e&&Object.entries(e.urls).forEach((([t,i])=>{this.baklavaView.editor.nodeURLs.has(e.name)||this.baklavaView.editor.nodeURLs.set(e.name,{}),this.baklavaView.editor.nodeURLs.get(e.name)[t]=i}))}})),a.length)return{errors:a,warnings:t};if(void 0!==n)for(const i of n){const n=(0,b.$o)(i.nodes,i.connections,i.name,this.baklavaView.editor);if(Array.isArray(n)&&n.length){a.push(...n);continue}this.baklavaView.editor.addGraphTemplate(n,i.category??P,i.name);const o=JSON.parse(JSON.stringify(i));Object.prototype.hasOwnProperty.call(o,"category")&&delete o.category;const{errors:r,warnings:s}=await this.loadDataflow({graphs:[o],version:e.version},!0,!0);this.baklavaView.editor.deepCleanEditor(),this.baklavaView.editor.unregisterGraphs(),t.push(...s.map((e=>`Graph '${i.name}' is invalid: ${e}`))),a.push(...r.map((e=>`Graph '${i.name}' is invalid: ${e}`)))}const s=[...new Set(t)],{errors:c,warnings:d}=this.registerDefaultNodes();return a.push(...c),s.push(...d),{errors:a,warnings:s}}preprocessNodes(e){return e.forEach((e=>{if(e.isCategory){const t=e.category.split("/").at(-1);if(void 0!==e.name&&e.name!==t)throw new Error(`Node '${e.name}' is a category node and has a name defined different than ${t}`);e.name=t}})),e}updateMetadata(e=void 0,t=!1,i=!1){let n;return i&&(this.updatedMetadata={}),void 0!==e&&(e={...this.updatedMetadata,...e},n=JSON.parse(JSON.stringify(e))),void 0===e&&this.specification.currentSpecification&&(e=this.specification.currentSpecification.metadata??{}),e?(t&&(e=T.mergeObjects(JSON.parse(JSON.stringify(this.specification.currentSpecification?.metadata??{})),e)),this.baklavaView.interfaceTypes.readInterfaceTypes(e),e&&"urls"in e&&Object.entries(e.urls).forEach((([e,t])=>{this.baklavaView.editor.baseURLs.set(e,t)})),e&&"icons"in e&&Object.entries(e.icons).forEach((([e,t])=>{this.baklavaView.editor.baseIconUrls.set(e,t)})),e&&"navbarItems"in e&&(this.baklavaView.navbarItems=JSON.parse(JSON.stringify(e.navbarItems))),this.baklavaView.editor.readonly=e?.readonly??this.defaultMetadata.readonly,this.baklavaView.editor.hideHud=e?.hideHud??this.defaultMetadata.hideHud,this.editor.allowLoopbacks=e?.allowLoopbacks??this.defaultMetadata.allowLoopbacks,this.baklavaView.twoColumn=e?.twoColumn??this.defaultMetadata.twoColumn,this.baklavaView.connectionRenderer.style=e?.connectionStyle??this.defaultMetadata.connectionStyle,this.baklavaView.movementStep=e?.movementStep??this.defaultMetadata.movementStep,this.baklavaView.settings.background.gridSize=e?.backgroundSize??this.defaultMetadata.backgroundSize,this.baklavaView.connectionRenderer.randomizedOffset=e?.randomizedOffset??this.defaultMetadata.randomizedOffset,this.baklavaView.ignoredLayers=new Set,this.baklavaView.layers=e?.layers??this.defaultMetadata.layers,this.baklavaView.collapseSidebar=e?.collapseSidebar??this.defaultMetadata.collapseSidebar,this.baklavaView.editor.layoutManager.useAlgorithm(e?.layout??this.defaultMetadata.layout),this.baklavaView.logLevel=e?.logLevel??this.defaultMetadata.logLevel,n&&(this.updatedMetadata=n),[]):["No specification to load provided."]}resolveInheritance(e){const t=JSON.parse(JSON.stringify(e)),i=e=>"object"==typeof e&&null!==e&&!Array.isArray(e),n=e=>Array.isArray(e),o=(e,t)=>{const r={...structuredClone(t)};return["abstract","isCategory"].forEach((e=>{delete r[e]})),i(e)&&i(t)&&Object.keys(e).forEach((a=>{if(i(e[a]))r[a]=a in r?o(e[a],t[a]):e[a];else if(n(e[a])&&n(t[a]))if("extends"===a)r[a]=e[a];else{const i=Object.fromEntries(t[a].map(((e,t)=>[e.name,t])));e[a].forEach((n=>{if(n.name&&n.name in i){const o=i[n.name];if(!n.override)throw new Error(`'${e.name}' node cannot override '${n.name}' property of '${t.name}' node`);r[a][o]={...t[a][o],...n},delete r[a][o].override}else r[a].push(n)}))}else r[a]=e[a]})),r},r={},a=t=>{if(t in r)return r[t];let i,n=e.find((e=>e.name===t));if(!n.extends)return r[t]=n,n;if(new Set(n.extends).size!==n.extends.length)throw new Error(`Repeated class in "extends" list of "${n.name}" node`);return n.extends.forEach((e=>{i=a(e),n=o(n,i)})),r[t]=n,n};return t.filter((e=>!e.abstract)).map((e=>a(e.name)))}saveSpecification(){return JSON.parse(JSON.stringify(this.specification.unresolvedSpecification))}saveDataflow(e,t,i){const n=this.baklavaView.editor.save();return n.version=this.specificationVersion,i||n.graphs.forEach((e=>{delete e.panning,delete e.scaling})),void 0===n.metadata&&(n.metadata={}),[[e,"readonly"],[t,"hideHud"],[this.editor.allowLoopbacks,"allowLoopbacks"],[this.baklavaView.twoColumn,"twoColumn"],[this.baklavaView.connectionRenderer.style,"connectionStyle"],[this.baklavaView.movementStep,"movementStep"],[this.baklavaView.settings.background.gridSize,"backgroundSize"],[this.baklavaView.connectionRenderer.randomizedOffset,"randomizedOffset"]].forEach((([e,t])=>{const i=this.specification.currentSpecification?.metadata??{},o=this.defaultMetadata;e!==(i[t]??o[t])&&(n.metadata[t]=e)})),0===Object.keys(n.metadata).length&&delete n.metadata,n}async loadDataflow(e,t=!1,i=!1){let{notifyWhenChanged:n}=this;this.updateMetadata({notifyWhenChanged:!1},!0,!0);try{const o=T.validateDataflow(e);if(o.length)return{errors:o,warnings:[]};try{("string"==typeof e||e instanceof String)&&(e=a.parse(e));const o=e.version,r=[];if(void 0===o?r.push(`Current format specification version is ${this.specificationVersion}. It may result in an unexpected behaviour`):o!==this.specificationVersion&&r.push(`Dataflow format specification version (${o}) differs from the current format specification version (${this.specificationVersion}). It may result in unexpected behaviour.`),"metadata"in e&&void 0!==this.specification.currentSpecification){const t=T.validateMetadata(e.metadata);if(Array.isArray(t)&&t.length)return{errors:t,warnings:r};n=e.metadata.notifyWhenChanged??n,this.updateMetadata({...e.metadata,notifyWhenChanged:!1},!0,!0)}void 0!==this.baklavaView.displayedGraph&&this.baklavaView.history.unsubscribeFromGraphEvents(this.baklavaView.displayedGraph,Symbol("HistoryToken"));const s={errors:await this.baklavaView.editor.load(e,t,i),warnings:r};return this.baklavaView.history.graphSwitch(this.baklavaView.displayedGraph,this.baklavaView.displayedGraph),s}catch(e){return{errors:["Unrecognized format. Make sure that the passed dataflow is correct.",e.toString()],warnings:[]}}}finally{this.updateMetadata({notifyWhenChanged:n},!0)}}static getEditorManagerInstance(){return T.instance||(T.instance=new T),T.instance}static mergeObjects(e,t){return t=t??{},void 0===e||0===Object.keys(e).length?t:(Object.entries(t).forEach((([t,i])=>{Array.isArray(i)&&Array.isArray(e[t])?e[t].push(...i):"object"==typeof i&&"object"==typeof e[t]?e[t]=T.mergeObjects(e[t],i):e[t]=i})),e)}static validateJSONWithSchema(e,t,i={}){const s=new o({allowUnionTypes:!0,formats:{hex:/^0x[a-fA-F0-9]+$/},schemas:[$,x,O,S,A],...i});s.addKeyword("version");const c=s.compile(t),d="string"==typeof e||e instanceof String;let l;try{l=d?a.parse(e):e}catch(e){return[`Not a proper JSON file: ${e.toString()}`]}return c(l)?[]:c.errors.map((i=>{const o=`${t.$id.split("_").slice(0,-1).join("_")}${i.instancePath}`;let a="";if(d){const t=r.parse(e),n=t.pointers[i.instancePath].value.line+1,o=t.pointers[i.instancePath].valueEnd.line+1;a=n===o?`Line ${n} -`:`Lines ${n}-${o} -`}switch(i.keyword){case"enum":return`${a} ${o} ${i.message} - ${(0,n.stringify)(i.params.allowedValues)}`;case"additionalProperties":return`${a} ${o} ${i.message} - ${(0,n.stringify)(i.params.additionalProperty)}`;case"const":return`${a} ${o} ${i.message} - ${(0,n.stringify)(i.params.allowedValue)}`;case"unevaluatedProperties":return`${a} ${o} ${i.message} - ${(0,n.stringify)(i.params.unevaluatedProperty)}}`;case"not":case"oneOf":return"";default:return`${a} ${o} ${i.message}`}})).filter((e=>""!==e))}validateResolvedSpecification(e){const t=T.validateSpecification(e,x);if(t.length)return t;const{nodes:i,graphs:n}=e,o=i.filter((e=>e.isCategory)),r={},a=[];o.forEach((e=>{e.name in r?a.push(`Category '${e.category}' has multiple nodes defining it.`):r[e.name]=e.category.split("/").slice(0,-1).join("/")}));const s=new Set;return i.forEach((e=>{const t=e.category.split("/");for(let i=t.length-1;i>=0;i-=1){const n=t[i],o=t.slice(0,i).join("/");if(n in r&&e.name!==n&&o===r[n]){void 0!==e.extends&&e.extends.includes(n)||a.push(`Node '${e.name}' does not extend its category node '${n}'.`);break}}for(let t=0;t<(e.extends??[]).length;t+=1){const i=e.extends[t];if(i in r){const t=""!==r[i]?`${r[i]}/${i}`:i;if(!e.category.includes(t)){a.push(`Node '${e.name}' extends from a category node '${i}' but is not in its category`);break}}}s.has(e.name)&&a.push(`Node '${e.name}' is defined multiple times`),s.add(e.name)})),void 0!==n&&n.forEach((e=>{s.has(e.name)&&a.push(`Graph node name '${e.name}' is defined multiple times`),s.add(e.name)})),a}static validateSpecification(e,t=$){return T.validateJSONWithSchema(e,t)}static validateMetadata(e){return T.validateJSONWithSchema(e,O)}static validateDataflow(e){return T.validateJSONWithSchema(e,S)}isInsideSubgraph(){return this.baklavaView.displayedGraph!==this.baklavaView.editor.graph}returnFromSubgraph(){this.baklavaView.editor.backFromSubgraph(this.baklavaView.displayedGraph)}updateSubgraphName(e){this.editor.updateCurrentSubgraphName(e)}get notifyWhenChanged(){return this.updatedMetadata.notifyWhenChanged??this.specification.currentSpecification?.metadata?.notifyWhenChanged??this.defaultMetadata.notifyWhenChanged}}},97351:(e,t,i)=>{i.d(t,{A:()=>l});var n=i(44726),o=i(71095),r=i(65111);class a{availableAlgorithms=[];constructor(){if(this.constructor===a)throw new Error("Can't initialize base class instance")}chooseAlgorithm(e){if(!this.availableAlgorithms.includes(e))throw new Error(`Could not find ${e} in ${this.constructor.name} engine.\n                Available algorithms: ${this.availableAlgorithms}`);this.activeAlgorithm=e}async calculate(e){throw new Error("Method calculate() must be implemented by layout engine")}}class s extends a{constructor(){if(super(),this.availableAlgorithms=[this.constructor.name],this.activeAlgorithm=this.constructor.name,this.chooseAlgorithm=void 0,this.constructor===s)throw new Error("Can't initialize base class instance")}}n.use(r),n.use(o);class c extends a{availableAlgorithms=["cola","dagre-network-simplex","dagre-tight-tree","dagre-longest-path","random","grid","circle","concentric","breadthfirst","cose"];async calculate(e){const t=n({elements:{nodes:e.nodes.map((e=>({data:{id:e.id,width:e.width,height:e.height}}))),edges:e.connections.map((e=>({data:{id:e.id,source:e.from,target:e.to}})))},style:[{selector:"node",style:{shape:"rectangle",width:"data(width)",height:"data(height)"}}],styleEnabled:!0}),i={name:this.activeAlgorithm};switch(this.activeAlgorithm){case"random":i.boundingBox={x1:0,y1:0,w:2e3,h:2e3};break;case"grid":i.avoidOverlapPadding=150;break;case"cose":i.nodeOverlap=1e3,i.idealEdgeLength=e=>300;break;case"cola":i.nodeSpacing=e=>150;break;case"dagre-network-simplex":case"dagre-tight-tree":case"dagre-longest-path":{const[e,...t]=this.activeAlgorithm.split("-");i.nodeSep=50,i.rankSep=100,i.ranker=t.join("-"),i.name=e;break}}const o=t.layout(i);return o.run(),["cose","cola"].includes(this.activeAlgorithm)&&await o.promiseOn("layoutstop"),{...e,nodes:t.nodes().map((e=>({id:e.id(),position:{x:e.position().x-e.width()/2,y:e.position().y-e.height()/2}})))}}}class d extends s{availableAlgorithms=["NoLayout"];activeAlgorithm="NoLayout";calculate(e){const t=e.nodes.map((e=>({...e,position:{x:0,y:0}})));return{...e,nodes:t}}}class l{layoutEngine=void 0;usedAlgorithm=void 0;graph=void 0;availableEngines={NoLayout:new d,CytoscapeEngine:new c};constructor(){this.useAlgorithm("NoLayout")}useAlgorithm(e){const[t,i]=e.split(" - "),n=this.availableEngines[t];if(void 0===n)throw new Error(`Could not parse the ${e} autolayout algorithm`);this.layoutEngine=n,void 0!==i&&this.layoutEngine.chooseAlgorithm(i),this.usedAlgorithm=e}getAvailableAlgorithms(){return Object.entries(this.availableEngines).map((([e,t])=>1!==t.availableAlgorithms.length?t.availableAlgorithms.map((t=>`${e} - ${t}`)):e)).flat()}registerGraph(e){this.graph=function(e){const t=new Map;e.nodes.forEach((e=>{e.interfaces.forEach((i=>t.set(i.id,e.id)))}));const i=e.nodes.filter((e=>void 0===e.position)).map((e=>({id:e.id}))),n=e.connections.filter((e=>i.filter((i=>i.id===t.get(e.from))).length>0&&i.filter((i=>i.id===t.get(e.to))).length>0)).map((e=>({id:e.id,from:t.get(e.from),to:t.get(e.to)})));return{nodes:i,connections:n}}(e)}async computeLayout(e){return this.updateDimensions(),function(e,t){const i=new Map;return e.nodes.forEach((e=>i.set(e.id,e.position))),t.nodes=t.nodes.map((e=>({...e,position:i.has(e.id)?i.get(e.id):e.position}))),t}(await this.runEngine(this.graph),e)}async runEngine(e){return this.layoutEngine.calculate(e)}updateDimensions(){this.graph.nodes=this.graph.nodes.map((e=>{const t=document.getElementById(e.id);return{...e,width:t.offsetWidth,height:t.offsetHeight}}))}}},8239:(e,t,i)=>{i.d(t,{$o:()=>y,Sx:()=>m,Wo:()=>g});var n=i(63491),o=i(46171),r=i(96422),a=i(14121),s=i(3455),c=i(56761),d=i(66254),l=i(36568),u=i(57565);function h(e){const t={},i=new Set,n=[];return e.forEach((e=>{if(void 0!==e.group){const t=h(e.group);Array.isArray(t)&&t.length&&n.push(...t),Object.entries(t).forEach((([t])=>{if(i.has(t)){const i=t.slice(t.indexOf("_")+1);n.push(`Property named '${i}' in a group property '${e.name}' is a duplicate.`)}i.add(t)})),e.group=t}i.has(`property_${e.name}`)&&n.push(`Property named '${e.name}' is a duplicate.`),t[`property_${e.name}`]={...e},i.add(`property_${e.name}`)})),n.length?n:t}function p(e){const t=JSON.parse(JSON.stringify(e));if(void 0!==t.interfaces){const e=(0,a.Cy)(t.interfaces,[],[]);if(Array.isArray(e)&&e.length)return e;const{inputs:i,outputs:n}=e;t.inputs=i,t.outputs=n,delete t.interfaces}if(void 0!==t.properties){const e=h(t.properties);if(Array.isArray(e)&&e.length)return e;t.inputs={...t.inputs,...e},delete t.properties}if(void 0!==t.enabledInterfaceGroups){const e={};t.enabledInterfaceGroups.forEach((t=>{e[`${t.direction}_${t.name}`]={...t}})),t.enabledInterfaceGroups=e}else t.enabledInterfaceGroups={};return t.title=t.instanceName??"",delete t.instanceName,t.parsed=!0,t}class f extends o.bP{inputs={};outputs={};type=void 0;constructor(e,t,i,n,o,r="",a=[],s=[],c=[],d=300){super(),this.description=r,this.extends=a,this.extending=s,this.siblings=c,this.layer=t,this.title=e,this.twoColumn=o,this.type=e,this.width=d,Object.keys(i).forEach((e=>{const t=i[e]();this.addInput(e,t)})),Object.keys(n).forEach((e=>{const t=n[e]();this.addOutput(e,t)}))}updateDynamicInterfaces(e){const t=[],{value:i}=e,{interfaceType:n,interfaceMaxConnectionsCount:o}=this.inputs[`property_${e.name}`],r=e.name.split(" "),s=r[r.length-2],c=e.name.slice(0,-1*(a.Yg.length+2+s.length)),d={left:[],right:[]},l={...this.inputs,...this.outputs};Object.entries(l).forEach((([e,t])=>{e.startsWith("property_")||d[t.side].push(t.sidePosition)}));for(let e=0;e<i;e+=1){const i=`${c}[${e}]`,r=`${s}_${i}`,a={name:i,direction:s},l="output"===s?this.outputs:this.inputs;if(r in l&&(a.externalName=l[r].externalName,a.side=l[r].side,a.sidePosition=l[r].sidePosition),!Object.prototype.hasOwnProperty.call(a,"sidePosition")&&!Object.prototype.hasOwnProperty.call(a,"side")){const e="output"===s?"right":"left";let t=d[e].sort(((e,t)=>e-t)).findIndex(((e,t)=>e!==t));-1===t&&(t=0===d[e].length?0:Math.max(...d[e])+1),a.sidePosition=t,a.side=e,a.type=n,a.maxConnectionCount=o,d[a.side].push(t)}t.push(a)}const u=(0,a.Cy)(t,[],[]);if(Array.isArray(u)&&u.length)throw new Error(`Internal error, node ${this.type} invalid. Reason: ${u.join(" ")}`);const{inputs:h,outputs:p}=u,f=this.graph.nodes.find((e=>e.id===this.id));this.updateInterfaces.bind(f)(h,p,!1,[`${s}_${c}`])}toggleInterfaceGroup(e,t){e.hidden||t||this.graphInstance.connections.filter((t=>t.from===e||t.to===e)).forEach((e=>{this.graphInstance.removeConnection(e)})),t&&(0,r.q6)(this,e,e.side),e.hidden=!t}save(){const e=super.save(),t=[],i=[],n=[];return Object.entries({...this.inputs,...this.outputs}).forEach((e=>{const[o,r]=e;r.port?r.hidden||(r.interfaces&&n.push({name:o.slice(r.direction.length+1),direction:r.direction}),i.push({name:o.slice(r.direction.length+1),externalName:r.externalName,id:r.id,direction:r.direction,side:r.side,sidePosition:r.sidePosition})):t.push({name:o.slice(9),id:r.id,value:void 0===r.value?null:r.value})})),delete e.inputs,delete e.outputs,e.interfaces=i,e.properties=t,e.enabledInterfaceGroups=n,e.name=e.type,delete e.type,e.instanceName=""===e.title?void 0:e.title,delete e.title,e}updateInterfaces(e,t,i=!0,n=void 0){const r=[];return Object.entries(this.inputs).forEach((([t,i])=>{void 0!==i.direction&&(Object.keys(e).includes(t)||void 0!==n&&!n.some((e=>t.startsWith(e)))||(r.push(`Interface '${i.name}' of direction '${i.direction}' removed as it was not found in the dataflow.`),this.graph.editor.privatizeInterface(this.graph.id,i),this.removeInput(t)))})),Object.entries(e).forEach((([e,t])=>{if(void 0===t.direction)return;const n=Object.entries(this.inputs).find((([i,n])=>i===e&&n.direction===t.direction));if(void 0===n){const i=new o.gZ(e);r.push(`Interface '${t.name}' of direction '${t.direction}' created as it was not found in the specification.`),Object.assign(i,t),this.addInterface(i.direction,e,i)}else i&&Object.assign(n[1],t)})),Object.entries(this.outputs).forEach((([e,i])=>{void 0!==i.direction&&(Object.keys(t).includes(e)||void 0!==n&&!n.some((t=>e.startsWith(t)))||(r.push(`Interface '${i.name}' of direction '${i.direction}' removed as it was not found in the dataflow.`),this.graph.editor.privatizeInterface(this.graph.id,i),this.removeOutput(e)))})),Object.entries(t).forEach((([e,t])=>{const n=Object.entries(this.outputs).find((([i,n])=>i===e&&n.direction===t.direction));if(void 0===n){const i=new o.gZ(e);r.push(`Interface '${t.name}' of direction '${t.direction}' created as it was not found in the specification.`),Object.assign(i,t),this.addInterface(i.direction,e,i)}else i&&Object.assign(n[1],t)})),r}updateProperties(e){const t=[];return Object.entries(this.inputs).forEach((([i,n])=>{void 0===n.direction&&(Object.keys(e).includes(i)||(t.push(`Property '${n.name}' removed as it was not found in the dataflow.`),this.removeInput(i)))})),Object.entries(e).forEach((([e,i])=>{if(void 0===i.direction&&void 0===Object.entries(this.inputs).find((([t])=>t===e))){const n=new s.A(i.name,i.value).setPort(!1);n.componentName="InputInterface",t.push(`Property '${i.name}' created as it was not found in the specification.`),Object.assign(n,i),this.addInput(e,n)}})),t}load(e){let t;if(Object.prototype.hasOwnProperty.call(e,"parsed")&&e.parsed)t=e;else if(t=p(e),Array.isArray(t)&&t.length)return t.map((e=>`Node ${this.type} of id: ${this.id} invalid. ${e}`));let i=[];if(Object.entries(t.inputs).forEach((([e,t])=>{e.startsWith("property_")&&e.startsWith("property_")&&e.endsWith(`${a.Yg}`)&&this.updateDynamicInterfaces(t)})),i=function(e,t,i){let n=[];return Object.keys({...e.inputs,...e.outputs}).forEach((o=>{const r=o.slice(o.indexOf("_")+1),a=o.slice(0,o.indexOf("_"));if(Object.prototype.hasOwnProperty.call(t,o)||Object.prototype.hasOwnProperty.call(i,o)){if("property"===a){const i=e.inputs[o].value,a=t[o].type;if(((e,t)=>{switch(e){case"constant":case"select":return!0;case"text":case"hex":return"string"==typeof t;case"number":case"integer":case"slider":return"number"==typeof t;case"bool":return"boolean"==typeof t;case"list":return Array.isArray(t);default:return!1}})(a,i))if("select"!==a||t[o].items.includes(i)){if("list"===a){const{dtype:e}=t[o],a=i.filter((t=>typeof t!==e));a.length>0&&n.push(`Property '${r}' value mismatch. Items: '${a.join(" ")}' are not of '${e}' dtype.`)}}else n.push(`Property '${r}' value mismatch. ${i} not found in ${t[o].items}`);else n.push(`Property '${r}' type mismatch. ${a} expected, ${typeof i} found.`)}}else"property"===a?n.push(`Property named '${r}' not found in specification!`):n.push(`Interface named '${r}' of direction '${a}' not found in specification!`)})),Object.keys(e.enabledInterfaceGroups).forEach((e=>{if(!Object.prototype.hasOwnProperty.call(t,e)&&!Object.prototype.hasOwnProperty.call(i,e)){const t=e.slice(0,e.indexOf("_")),i=e.slice(e.indexOf("_")+1);n.push(`Interface group named '${i}' of direction '${t}' not found in specification!`)}})),n&&n.length||(n=(0,a.W9)(Object.keys(e.enabledInterfaceGroups),t,i)),n}(t,this.inputs,this.outputs),Array.isArray(i)&&i.length)return i.map((e=>`Node ${this.type} of id: ${this.id} invalid. ${e}`));super.load(t),Object.keys(t.enabledInterfaceGroups).length&&Object.entries({...this.inputs,...this.outputs}).forEach((([,e])=>{void 0!==e.interfaces&&(e.hidden=!0)})),Object.entries(t.enabledInterfaceGroups).forEach((([e,t])=>{"input"===t.direction||"inout"===t.direction?this.inputs[e].hidden=!1:"output"===t.direction&&(this.outputs[e].hidden=!1)}));const n={left:[],right:[]},o={...t.inputs,...t.outputs};Object.entries(o).forEach((([e,t])=>{"input"===t.direction||"inout"===t.direction?(this.inputs[e].side=t.side,this.inputs[e].sidePosition=t.sidePosition,this.inputs[e].externalName=t.externalName,n[t.side].push(t.sidePosition)):"output"===t.direction&&(this.outputs[e].side=t.side,this.outputs[e].sidePosition=t.sidePosition,this.outputs[e].externalName=t.externalName,n[t.side].push(t.sidePosition))}));const r=e=>{Object.entries(e).forEach((([e,t])=>{if(e.startsWith("property_"))return;if(e in o)return;if(!n[t.side].includes(t.sidePosition))return;const i=Math.max(...n[t.side]);t.sidePosition=i+1,n[t.side].push(i+1)}))};return r(this.inputs),r(this.outputs),void 0===e.position&&(this.position=void 0),i}onDestroy(){[...Object.values(this.inputs),...Object.values(this.outputs)].forEach((e=>{Object.values(e.events).forEach((t=>{t.unsubscribe(e)}))}))}}function g(e,t,i,r,u,p,g,m="",y=[],v=[],w=[],b=300){const $=(0,a.vS)(i);if(!$.success)return $.value.map((t=>`Node ${e} invalid. ${t}`));const x=(0,a.Cy)(i,u,p);if(Array.isArray(x)&&x.length)return x.map((t=>`Node ${e} invalid. ${t}`));function O(e){return()=>{const t=new o.gZ(e.name);return Object.assign(t,e),t}}const S=Object.fromEntries(Object.entries(x.inputs).map((([e,t])=>[e,O(t)]))),A=Object.fromEntries(Object.entries(x.outputs).map((([e,t])=>[e,O(t)]))),E=h([...r,...$.value]);if(Array.isArray(E)&&E.length)return E.map((t=>`Node ${e} invalid. ${t}`));const I=function(e){const t=(e,t=!1)=>{const i=e.name,o=e.type;let r,a=e.default;switch(o){case"constant":r=new n.lo(i,a).setPort(!1),r.componentName="TextInterface";break;case"text":r=new s.A(i,a).setPort(!1),r.componentName="InputInterface";break;case"number":r=new n.jW(i,a,e.min,e.max).setPort(!1),r.componentName="NumberInterface";break;case"integer":r=new n.qO(i,a,e.min,e.max).setPort(!1),r.componentName="IntegerInterface";break;case"hex":r=new l.A(i,a.toLowerCase(),e.min?BigInt(e.min):NaN,e.max?BigInt(e.max):NaN).setPort(!1),r.componentName="HexInterface";break;case"select":{const t=e.values.map((e=>e.toString()));r=new n.mk(i,a,t).setPort(!1),r.componentName="SelectInterface"}break;case"bool":r=new n.b(i,a).setPort(!1),r.componentName="CheckboxInterface";break;case"slider":void 0===a&&(a=e.min),r=new d.A(i,a,e.min,e.max,e.step).setPort(!1),r.componentName="SliderInterface";break;case"list":null===a&&(a=[]),r=new c.A(i,a,e.dtype).setPort(!1),r.componentName="ListInterface";break;default:console.error(o," input type is not recognized.")}return void 0!==r&&(r.hidden=t,r.type=o,void 0!==e.interfaceMaxConnectionsCount&&(r.interfaceMaxConnectionsCount=e.interfaceMaxConnectionsCount),void 0!==e.interfaceType&&(r.interfaceType=e.interfaceType)),r},i={};return Object.entries(e).forEach((([e,n])=>{void 0!==n.group?(i[e]=()=>{const e=t(n);return e.group=Object.keys(n.group),e},Object.entries(n.group).forEach((([e,n])=>{i[e]=()=>t(n)}))):i[e]=()=>t(n)})),i}(E),N={...S,...I};return class extends f{constructor(){super(e,t,N,A,g,m,y,v,w,b)}}}function m(e,t=[],i=[]){const n=["input_","inout_","output_"],o=[...e.map((e=>Object.entries({...e.inputs,...e.outputs}))).flat()].filter((([e])=>n.some((t=>e.startsWith(t))))).filter((([,e])=>e.externalName)),r=Object.create(null),s=[];o.forEach((([,e])=>{r[e.externalName]=(r[e.externalName]??0)+1,1===r[e.externalName]?s.push(e):s.push(`Interface '${e.externalName}' is repeated ${r[e.externalName]} times.`)}));const c=s.filter((e=>"string"==typeof e));if(c.length)return c;const d=[];s.forEach((n=>{const o=e[0].graph.id;u.ir.isRegistered(n.id)&&u.ir.getRegisteredInterface(n.id).sharedInterface!==n&&u.ir.getRegisteredInterface(n.id).sharedInterface.id===n.id&&u.ir.getRegisteredInterface(n.id).sharedInterfaceGraphId===o&&u.ir.deleteRegisteredInterface(n.id),u.ir.isRegistered(n.id)||u.ir.registerInterface(n,o);const r="output"===n.direction?i:t,a=r.findIndex((e=>e.id===n.id));-1===a?d.push({name:n.externalName,id:n.id,externalName:void 0,side:n.side,direction:n.direction,sidePosition:void 0}):(r[a].name=n.externalName,d.push(r[a]))}));const l=(0,a.i0)(d,{});return Array.isArray(l)&&l.length?l:{inputs:Object.values(l.inputs),outputs:Object.values(l.outputs)}}function y(e,t,i,n){const r=e.map((e=>p(e))),a=r.filter((e=>"string"==typeof e));if(a.length)return a;const s={name:i,nodes:r,connections:t,inputs:[],outputs:[]};return new o.b1(s,n)}},96335:(e,t,i)=>{i.d(t,{A:()=>oe});var n={};i.r(n),i.d(n,{connections_change:()=>E,graph_change:()=>I,graph_get:()=>x,metadata_change:()=>j,node_get:()=>C,nodes_change:()=>A,notification_send:()=>V,position_change:()=>S,progress_change:()=>k,properties_change:()=>O,properties_get:()=>N,specification_change:()=>T,terminal_add:()=>M,terminal_write:()=>_,viewport_center:()=>P});var o=i(13773),r=i(86049);const a=(window.location.protocol,null);var s=i(15215),c=i(94541),d=i.n(c),l=i(55729),u=i(93617),h=i(28316),p=i(30468),f=i(63491),g=i(881),m=i(6565),y=i(35127);const v=m.Ay.getEditorManagerInstance();function w(e){const{viewModel:t}=(0,f.if)(),i=[...t.value.editor.graphs].find((t=>t.id===e));if(void 0===i)throw new Error(`Graph with id '${e}' does not exist.`);return i}function b(e,t){const i=w(e).nodes.find((e=>e.id===t));if(void 0===i)throw new Error(`Node with id '${t}' does not exist.`);return i}function $(e,t,i){let n;if(void 0!==t){if(n=Object.values(e.inputs).find((e=>e.id===t)),void 0===n||void 0!==n.side)throw new Error(`Property with id '${t}' does not exist.`)}else if(n=Object.values(e.inputs).find((e=>e.name===i)),void 0===n||void 0!==n.side)throw new Error(`Property with name '${i}' does not exist.`);return n}function x(){return{dataflow:v.saveDataflow()}}function O(e){const t=b(e.graph_id,e.node_id);for(const i of e.properties)$(t,i.id,i.name);for(const i of e.properties)$(t,i.id,i.name).value=i.new_value}function S(e){const t=b(e.graph_id,e.node_id);t.position.x=e.position.x,t.position.y=e.position.y}function A(e){return(0,s.sH)(this,void 0,void 0,(function*(){const{viewModel:t}=(0,f.if)(),i=w(e.graph_id);e.nodes.added.forEach((e=>{const n=t.value.editor.nodeTypes.get(e.name);if(!n)throw new Error(`Node type not found for name ${e.name}`);{const t=new n.type;t.id=e.id,i.addNode(t);const o=t.load(e);if(Array.isArray(o)&&o.length)throw new Error(o.join("\n"))}})),e.nodes.deleted.forEach((t=>{var n;const o=b(e.graph_id,t);null===(n=e.remove_with_connections)||void 0===n||n?i.removeNode(o):i.removeNodeOnly(o)}))}))}function E(e){return(0,s.sH)(this,void 0,void 0,(function*(){const t=w(e.graph_id);e.connections.added.forEach((e=>{const i=t.findNodeInterface(e.from);if(!i)throw new Error(`Interface with id ${e.from} does not exist`);const n=t.findNodeInterface(e.to);if(!n)throw new Error(`Interface with id ${e.to} does not exist`);if(!t.addConnection(i,n))throw new Error(`Connection from ${e.from} to ${e.to} cannot be created`)})),e.connections.deleted.forEach((i=>{t.removeConnection(function(e,t,i){const n=w(e).connections.find((e=>e.from.id===t&&e.to.id===i));if(void 0===n)throw new Error(`Connection from ${t} to ${i} does not exist.`);return n}(e.graph_id,i.from,i.to))}))}))}function I(e){v.loadDataflow(e.dataflow)}function N(e){return(0,s.sH)(this,void 0,void 0,(function*(){const t=b(e.graph_id,e.node_id),i=[];if(void 0===e.properties){for(const e of Object.values(t.inputs))void 0===e.side&&i.push({id:e.id,name:e.name,value:e.value});return i}for(const n of e.properties){const e=$(t,n.id,n.name);i.push({id:e.id,name:e.name,value:e.value})}return i}))}function C(e){return(0,s.sH)(this,void 0,void 0,(function*(){return{node:b(e.graph_id,e.node_id).save()}}))}function k(e){const t=g.A.get(e.method);if(!t.inProgress)throw new Error("No run in progress");if(!t.progressBar)throw new Error(`Progress bar does not exist for method: ${e.method}`);if(-1!==e.progress){if(e.progress>100||e.progress<0)throw new Error(`Progress has to be in [0, 100] or -1. Received: ${e.progress}`);t.progressBar.style.width=`${e.progress}%`,t.progressBar.classList.remove("animate")}else t.progressBar.classList.add("animate")}function j(e){v.updateMetadata(e.metadata,!0)}function P(){v.baklavaView.editor.centerZoom()}function M(e){if(!1===y.iP.createTerminalInstance(e.name,e.readonly))throw new Error(`Terminal instance of name '${e.name}' already exists`)}function _(e){e.name in y.iP.logs||y.iP.createTerminalInstance(e.name),y.iP.add(e.message,e.name)}function V(e){u.A.terminalLog(e.type,e.title,e.details)}function T(e){oe().updateSpecification(e.specification)}const L=/^custom_.*$/,R="dataflow_run";o.JSONRPCServerAndClient;const H=new(d())({schemas:[h],allowUnionTypes:!0,strict:!0}),J=p.cj,G=p.s,q=p.ji;let W;try{[J,G,q].forEach((e=>{Object.entries(e).forEach((([e,t])=>{var i;W=e,H.compile(t.params),H.compile(null!==(i=t.returns)&&void 0!==i?i:{})}))}))}catch(e){throw new Error(`Procedures specification schema '${W}' is incorrect: ${e}`)}const D=(e,t,i)=>(0,s.sH)(void 0,void 0,void 0,(function*(){var n;if(!(t.method in J)){if(void 0!==t.id)return(0,o.createJSONRPCErrorResponse)(t.id,1,"Requested method does not exist");throw new Error("Requested method does not exist")}const r=J[t.method];if(!H.validate(r.params,null!==(n=t.params)&&void 0!==n?n:{})){if(void 0!==t.id)return(0,o.createJSONRPCErrorResponse)(t.id,1,"Request does not match specification");throw new Error("Request does not match specification")}const a=yield e(t,i);if(void 0===t.id)return null;if(void 0!==(null==a?void 0:a.result)&&null!==r.returns&&!H.validate(r.returns,a.result)){if(void 0!==t.id)return(0,o.createJSONRPCErrorResponse)(t.id,1,"Response does not match specification");throw new Error("Response does not match specification")}return a}));let z=1;const B=()=>z++,U={"Access-Control-Allow-Origin":"http://localhost","Access-Control-Allow-Headers":"Origin, X-Requested-With, Content-Type, Accept"},F=new Map,K=262144;let Y,Z;const Q={get jsonRPC(){return Z||function(){a&&(Y=(0,l.io)(a,{extraHeaders:U}),Z=new o.JSONRPCServerAndClient(new o.JSONRPCServer,new o.JSONRPCClient((e=>(0,s.sH)(this,void 0,void 0,(function*(){var t,i;const n=L.test(e.method)?R:e.method;if(!(n in q)&&!(n in G))throw new Error("Requested method not known");if(Y.disconnected)return Promise.reject(new Error("WebSocket is disconnected. Make sure the communication server is available."));const o=n in q?q:G,r=o[n];if(!H.validate(r.params,null!==(t=e.params)&&void 0!==t?t:{}))return Promise.reject(new Error("Request does not match specification"));e.id&&F.set(e.id,r);const a=o===G?"backend-api":"external-api",s=JSON.stringify(e);try{if(s.length>K){const t=null!==(i=e.id)&&void 0!==i?i:crypto.randomUUID();for(let e=0;e<s.length;e+=K)Y.emit(a,{id:t,chunk:s.substring(e,Math.min(e+K,s.length)),end:e+K>=s.length})}else Y.emit(a,e)}catch(e){return Promise.reject(e)}return Promise.resolve()}))),B)),Z.server.applyMiddleware(D),Object.entries(n).forEach((([e,t])=>{"function"==typeof t&&e in J?Z.addMethod(e,t):"function"==typeof t&&u.A.showToast("warning",`Function ${e} was not registered as RPC method`)})),Y.on("connect",(()=>u.A.terminalLog("info","Initialized connection with communication server",null))),Y.on("disconnect",(()=>{u.A.terminalLog("warning","Connection with communication server disrupted",null),Z.rejectAllPendingRequests("WebSocket disconnected")})),Y.on("api",(e=>(0,s.sH)(this,void 0,void 0,(function*(){const t=yield Z.server.receive(e);if(t)try{const e=yield Y.emitWithAck("external-api",t);void 0===e||e||u.A.terminalLog("error","Response to external app was not send",null)}catch(t){u.A.terminalLog("error",`Response to ${e.method} request cannot be send`,t)}})))),Y.on("api-response",(e=>{var t;e.result&&e.id&&(null===(t=F.get(e.id))||void 0===t?void 0:t.returns)&&!H.validate(F.get(e.id).returns,e.result)?Z.client.receive((0,o.createJSONRPCErrorResponse)(e.id,1,"Response does not match specification")):Z.client.receive(e)})),Z.customMethodRegex=L,Z.customMethodReplace=R)}(),Z}}.jsonRPC,X={};function ee(e){0===e.type?u.A.terminalLog("info",e.content):1===e.type?u.A.terminalLog("error",`Error occurred: ${e.content}`,e.content):3===e.type&&u.A.terminalLog("warning",`Warning: ${e.content}`,e.content)}function te({errors:e,warnings:t},i,n){return Array.isArray(t)&&t.length&&u.A.terminalLog("warning",n,t),!(!Array.isArray(e)||!e.length||(u.A.terminalLog("error",i,e),0))}class ie{externalApplicationConnected=!1;backendAvailable=null!==a;editorManager=m.Ay.getEditorManagerInstance();idStatusInterval=null;timeoutStatusInterval=1500;appCapabilities={};async updateConnectionStatus(){try{const e=await Q.request("status_get");!e.status.connected&&this.externalApplicationConnected&&u.A.terminalLog("warning","External application was disconnected"),this.externalApplicationConnected!==e.status.connected&&(document.querySelector(".progress-bar").style.width="0%",g.A.forEach(((e,t)=>{g.A.get(t).inProgress=!1}))),this.externalApplicationConnected=e.status.connected}catch(e){this.externalApplicationConnected=!1}}async openTCP(){try{return await Q.request("external_app_connect"),this.externalApplicationConnected=!0,null}catch(e){return this.externalApplicationConnected=!1,[-3!==(e.code??-1)?"warning":"info",e.message]}}async requestSpecification(){let e="Unknown error";try{const t=await Q.request("specification_get");if(0===t.type){const e=t.content;await this.updateSpecification(e),u.A.terminalLog("info","Specification loaded successfully")}else 3===t.type?(e=t.content,u.A.terminalLog("warning",e)):1===t.type&&(e=t.content,u.A.terminalLog("error",e))}catch(t){e=t.message,u.A.terminalLog("error",e)}}async updateSpecification(e){if(te(m.Ay.validateSpecification(e),"Warnings when validating specification","Specification is invalid"))return;const t=this.editorManager.saveDataflow();if(te(await this.editorManager.updateEditorSpecification(e),"Warnings when loading specification","Errors when loading specification"))return;const i=await this.editorManager.loadDataflow(t,!0);i.errors.length&&u.A.terminalLog("error","Dataflow doesn't match the updated specification",i.errors)}async requestAppCapabilities(){try{const e=await Q.request("app_capabilities_get");this.appCapabilities={...X,...e}}catch(e){this.appCapabilities={...X},u.A.terminalLog("warning","Application capabilities cannot be retrieved, using defaults",e.message)}}async requestDataflowExport(){const e=this.editorManager.saveDataflow();if(!e)return!1;let t;try{t=await Q.request("dataflow_export",{dataflow:e})}catch(e){return t=e.message,u.A.terminalLog("error",t),!1}return 0===t.type?t:(1===t.type?u.A.terminalLog("error",`Error occurred: ${t.content}`,t.content):3===t.type&&u.A.terminalLog("warning",`Warning: ${t.content}`,t.content),!1)}async requestDataflowAction(e){const t=this.editorManager.saveDataflow(),i=g.A.get(e);if(!t)return;const n=Q.customMethodRegex.test(e)?Q.customMethodReplace:e;if("dataflow_run"===n){if(i.inProgress)return void u.A.showToast("error","Previous run has not finished, cannot process this request");u.A.showToast("info","Running dataflow")}let o;i.inProgress=!0;try{o=n.startsWith("dataflow_")?await Q.request(e,{dataflow:t}):await Q.request(n)}catch(e){return o=e.message,u.A.terminalLog("error","Cannot create a request",o),void(i.inProgress=!1)}ee(o),i.inProgress=!1}async requestDataflowStop(e){if(g.A.get(e).inProgress)try{ee(await Q.request("dataflow_stop",{method:e}))}catch(e){u.A.terminalLog("error",e.message)}else u.A.showToast("error","Nothing to stop, no ongoing jobs running")}async importDataflow(){const e=document.getElementById("request-dataflow-button").files[0];if(!e)return;const t=new FileReader,i=(0,r.charset)(e.type),n=new Promise((e=>{t.onloadend=()=>{e(i?t.result:t.result.replace(/data:.*;base64,/,""))}}));i?t.readAsText(e,i):t.readAsDataURL(e);const o=await n;if(o)try{const t=await Q.request("dataflow_import",{external_application_dataflow:o,mime:e.type,base64:!i});if(0===t.type){const{errors:e,warnings:i}=await this.editorManager.loadDataflow(t.content);Array.isArray(e)&&e.length?u.A.terminalLog("error","Dataflow is invalid",e):Array.isArray(i)&&i.length?u.A.terminalLog("warning","Dataflow imported with warning",i):u.A.showToast("info","Imported dataflow")}else if(1===t.type){const e=t.content;u.A.terminalLog("error",`Error occurred: ${t.content}`,e)}else 3===t.type&&u.A.terminalLog("warning",`Warning: ${t.content}`,"Imported dataflow")}catch(e){const t=e.message;u.A.terminalLog("error",t)}else u.A.showToast("error","File cannot be loaded")}async notifyAboutChange(e,t){if(this.backendAvailable&&this.externalApplicationConnected&&this.editorManager.notifyWhenChanged)try{await Q.request(e,t)}catch(e){u.A.terminalLog("warning","Error when notifing about change",e.message)}}async requestTerminalRead(e,t){if(this.backendAvailable&&this.externalApplicationConnected)try{await Q.request("terminal_read",{name:e,message:t})}catch(e){u.A.terminalLog("warning","Error when sending terminal input",e.message)}}async checkConnectionStatus(){for(;this.interval;)await this.updateConnectionStatus(),this.externalApplicationConnected||(g.A.forEach(((e,t)=>{g.A.get(t).inProgress=!1})),await this.initializeConnection(!1)),await new Promise((e=>setTimeout(e,this.timeoutStatusInterval)))}startStatusInterval(){null===this.idStatusInterval&&(this.interval=!0,this.idStatusInterval=this.checkConnectionStatus())}async initializeConnection(e=!0){if(e&&await this.updateConnectionStatus(),!this.externalApplicationConnected){do{u.A.terminalLog("info","Trying to establish connection with external application"),null!==await this.openTCP()?await new Promise((e=>setTimeout(e,this.timeoutStatusInterval))):u.A.terminalLog("info","External application connected successfully")}while(!this.externalApplicationConnected);this.timeoutStatusInterval=1500}if(this.externalApplicationConnected&&await Promise.all([this.requestSpecification(),this.requestAppCapabilities()]),this.externalApplicationConnected)try{await Q.request("frontend_on_connect")}catch(e){e.code!==o.JSONRPCErrorCode.MethodNotFound&&-2!==e.code&&u.A.terminalLog("warning",e.message,e.data)}}}let ne;function oe(){return ne||(ne=new ie),ne}},41426:(e,t,i)=>{function n(e,t){const i=e;let n=-i;return e=>{Date.now()-n<i&&t(e),n=Date.now()}}i.d(t,{A:()=>n})},5292:(e,t,i)=>{i.d(t,{q:()=>c});let n,o=0,r=0;const a=e=>{const{clientY:t}=e;t>61&&n(r+(o-t))},s=()=>{const e=document.querySelector(".terminal-wrapper");document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",s),e.style["pointer-events"]=""},c=e=>t=>{const i=document.querySelector(".terminal-wrapper");n=e,o=t.clientY;const c=window.getComputedStyle(i);r=parseInt(c.height,10),document.addEventListener("mousemove",a),document.addEventListener("mouseup",s),i.style["pointer-events"]="none"}},14121:(e,t,i)=>{i.d(t,{Cy:()=>u,Sb:()=>s,W9:()=>c,Yg:()=>o,i0:()=>d,vS:()=>l});const n="inout",o="count";function r(e,t,i=void 0){const n={};return Object.assign(n,e),n.name=i??e.name,void 0!==n.type&&(n.type="string"==typeof e.type||e.type instanceof String?[e.type]:e.type),n.componentName="NodeInterface",n.hidden=t,n.originalSide=n.side,n.originalSidePosition=n.sidePosition,n}function a(e,t=!1){const i=[],o={input:{},inout:{},output:{}};e.forEach((e=>{if(Object.prototype.hasOwnProperty.call(e,"dynamic"))return;const r=JSON.parse(JSON.stringify(e)),a=e.direction??n;if(r.direction=a,void 0!==e.array){const[t,n]=e.array;for(let s=t;s<n;s+=1){const t=`${e.name}[${s}]`;void 0!==o[a][t]&&i.push(`Interface named '${t}' of direction '${a}' is a duplicate.`),r.externalName=e.externalName?`${e.externalName}[${s}]`:void 0,o[a][t]=JSON.parse(JSON.stringify(r))}}else void 0!==o[a][e.name]&&i.push(`Interface named '${e.name}' of direction '${a}' is a duplicate.`),o[a][e.name]=r;if(t){const e=[];r.interfaces.forEach((t=>{const i=t.direction??n;if(void 0!==t.array){const[n,o]=t.array;for(let r=n;r<o;r+=1){const n=`${i}_${t.name}[${r}]`;e.push(n)}}else{const n=`${i}_${t.name}`;e.push(n)}})),r.interfaces=e}}));const r=Object.fromEntries(Object.entries(o.inout).filter((([e,t])=>{const r=t.direction??n,a=Object.keys(o.output).includes(e)||Object.keys(o.input).includes(e);return a&&i.push(`Interface named '${e}' of direction '${r}' is a duplicate. There already exists an input or output of this name.`),!a})));return o.inout=r,o.input={...o.input,...o.inout},delete o.inout,o.input=Object.fromEntries(Object.entries(o.input).map((([e,t])=>[`${t.direction}_${e}`,t]))),o.output=Object.fromEntries(Object.entries(o.output).map((([e,t])=>[`${t.direction}_${e}`,t]))),i.length?i:o}function s(e,t,i){const n=[],o=new Set;return e.forEach((e=>{const r=t[e]?.interfaces??i[e]?.interfaces,a=e.slice(0,e.indexOf("_")),s=e.slice(e.indexOf("_")+1);r.forEach((e=>{if(o.has(e)){const t=e.slice(0,e.indexOf("_")),i=e.slice(e.indexOf("_")+1);n.push([i,t,s,a])}else o.add(e)}))})),n}function c(e,t,i){const n=s(e,t,i),o=[];return n.forEach((([e,t,i,n])=>{o.push(`Interface of name '${e}' and direction '${t}' has been reused by interface group named '${i}' of direction '${n}'. Make sure your interface groups are disjoint.`)})),o}function d(e,t){const i={left:{},right:{}},n=[];Object.entries({...e,...t}).forEach((([e,t])=>{"right"===t.side||void 0===t.side&&"output"===t.direction?(i.right[e]={...t},i.right[e].side="right"):("left"===t.side||void 0===t.side&&"output"!==t.direction)&&(i.left[e]={...t},i.left[e].side="left")}));const o=e=>e.slice(e.indexOf("_")+1),r=new Set,a=new Set;if(Object.entries(i.left).forEach((([e,t])=>{void 0!==t.sidePosition&&(r.has(t.sidePosition)&&n.push(`Interface named '${o(e)}' of direction '${t.direction}' has invalid sidePosition value '${t.sidePosition}'. There already exists an input or output with this sidePosition.`),r.add(t.sidePosition))})),Object.entries(i.right).forEach((([e,t])=>{void 0!==t.sidePosition&&(a.has(t.sidePosition)&&n.push(`Interface named '${o(e)}' of direction '${t.direction}' has invalid sidePosition value '${t.sidePosition}'. There already exists an input or output with this sidePosition.`),a.add(t.sidePosition))})),n.length)return n;let s=0,c=0;return Object.entries(i.left).forEach((([,e])=>{e.sidePosition=(e=>{if(void 0===e.sidePosition){for(;r.has(s);)s+=1;return r.add(s),s}return e.sidePosition})(e)})),Object.entries(i.right).forEach((([,e])=>{e.sidePosition=(e=>{if(void 0===e.sidePosition){for(;a.has(c);)c+=1;return a.add(c),c}return e.sidePosition})(e)})),{inputs:Object.fromEntries(Object.entries({...i.left,...i.right}).filter((([,e])=>"output"!==e.direction))),outputs:Object.fromEntries(Object.entries({...i.left,...i.right}).filter((([,e])=>"output"===e.direction)))}}function l(e){const t=[],i=[];return e.forEach((e=>{Object.prototype.hasOwnProperty.call(e,"dynamic")&&(Array.isArray(e.dynamic)&&2===e.dynamic.length&&Number.isInteger(e.dynamic[0])&&Number.isInteger(e.dynamic[1])?i.push({name:`${e.name} ${e.direction} ${o}`,type:"integer",min:e.dynamic[0],max:e.dynamic[1],default:e.dynamic[0],interfaceType:e.type,interfaceMaxConnectionCount:e.maxConnectionCount}):!0===e.dynamic?i.push({name:`${e.name} ${e.direction} ${o}`,type:"integer",min:0,default:0,interfaceType:e.type,interfaceMaxConnectionCount:e.maxConnectionCount}):t.push(`Interface '${e.name}' has invalid 'dynamic' attribute. It should be either a boolean or an array with two integer elements.`))})),t.length?{success:!1,value:t}:{success:!0,value:i}}function u(e,t,i){let o=[];const s=a(e);if(Array.isArray(s)&&s.length)return s;if(t.forEach((e=>{const t=e.direction??n;e.interfaces.forEach((i=>{const r=i.direction??n;if(void 0!==i.array){const[n,a]=i.array;for(let c=n;c<a;c+=1){const n=`${r}_${i.name}[${c}]`;Object.keys({...s.input,...s.output}).includes(n)||o.push(`Interface named '${i.name}[${c}]' of direction '${r}' used for interface group '${e.name}' of direction '${t}' does not exist.`)}}else{const n=`${r}_${i.name}`;Object.keys({...s.input,...s.output}).includes(n)||o.push(`Interface named '${i.name}' of direction '${r}' used for interface group '${e.name}' of direction '${t}' does not exist.`)}}))})),o.length)return o;const l=a(t,!0);if(Array.isArray(l)&&l.length)return l;const u=new Set;Object.values({...l.input,...l.output}).forEach((e=>{e.interfaces.forEach((e=>u.add(e)))}));const h=i.map((e=>`${e.direction??n}_${e.name}`));if(o=c(h,{...l.input,...s.input},{...l.output,...s.output}),o.length)return o;s.input=Object.fromEntries(Object.entries(s.input).filter((([e])=>!u.has(e)))),s.output=Object.fromEntries(Object.entries(s.output).filter((([e])=>!u.has(e))));const p=d({...s.input,...l.input},{...s.output,...l.output});if(Array.isArray(p)&&p.length)return p;const f=e=>e.slice(e.indexOf("_")+1),g={inputs:{},outputs:{}};return Object.entries(p.inputs).forEach((([e,t])=>{void 0!==t.interfaces?g.inputs[e]=r(t,!h.includes(e),f(e)):g.inputs[e]=r(t,!1,f(e))})),Object.entries(p.outputs).forEach((([e,t])=>{void 0!==t.interfaces?g.outputs[e]=r(t,!h.includes(e),f(e)):g.outputs[e]=r(t,!1,f(e))})),g}},93617:(e,t,i)=>{i.d(t,{A:()=>d,E:()=>c});var n=i(85246),o=i(35127),r=i(33305),a=i(6565);const s=(0,n.bO)({timeout:5e3,position:n.II.BOTTOM_RIGHT,icon:!1,closeButton:!1}),c={info:0,warning:1,error:2};class d{static NotificationHandler=!0;static defaultShowOption=!0;static setShowNotification(e){d.showNotifications=e}static setShowOption(e){d.defaultShowOption=e}static restoreShowNotification(){d.showNotifications=d.defaultShowOption}static showToast(e,t){const i={component:r.A,props:{type:e,message:t}};if(c[e]>=c[a.Ay.getEditorManagerInstance().baklavaView.logLevel?.toLowerCase()]&&d.showNotifications)s(i);else{const e=document.querySelector("#navbar-bell>.indicator");e&&(e.classList.remove("animate"),setTimeout((()=>e.classList.add("animate")),300))}o.xv.add({type:e,message:t})}static terminalLog(e,t,i){d.showToast(e,t),o.iP.addParsed(t,i)}}},35127:(e,t,i)=>{i.d(t,{d:()=>l,iP:()=>u,xv:()=>d});var n=i(50953);const o=(()=>{try{const e=Math.random().toString(36),t=Math.random().toString(36);return localStorage.setItem(e,t),localStorage.removeItem(e),!0}catch{return!1}})(),r=new Map,a=e=>o?localStorage.getItem(e):r.get(e)??null,s=(e,t)=>{o?localStorage.setItem(e,t):r.set(e,t)},c=e=>{o?localStorage.removeItem(e):r.delete(e)},d=(0,n.Kh)({notifications:JSON.parse(a("notifications"))||[],add(e){this.notifications.push(e),s("notifications",JSON.stringify(this.notifications))},remove(){c("notifications"),this.notifications=[]},removeOne(e){const t=this.notifications.filter(((t,i)=>e!==i));s("notifications",JSON.stringify(t)),this.notifications=t}}),l="Terminal",u=(0,n.Kh)({logs:{Terminal:JSON.parse(a("logs"))||[]},readOnly:{Terminal:!0},add(e,t=l){this.logs[t].push(e),t===l&&s("logs",JSON.stringify(this.logs[t]))},isReadOnly(e=l){return this.readOnly[e]},addParsed(e,t,i=l){let n=e;t?(("string"==typeof t||t instanceof String)&&(t=[t]),n+=":",t.forEach((e=>{n+="\n",n+="    ",n+=e}))):n+=".",this.add(n,i)},remove(e=l){e===l&&c("logs"),this.logs[e]=[]},createTerminalInstance(e,t=!0){return!Object.keys(this.logs).includes(e)&&(this.logs[e]=[],this.readOnly[e]=t,!0)}})}}]);
//# sourceMappingURL=index-a5943e60.640f9dac.js.map